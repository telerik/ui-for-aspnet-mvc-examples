/*
* Kendo UI Complete v2013.2.716 (http://kendoui.com)
* Copyright 2013 Telerik AD. All rights reserved.
*
* Kendo UI Complete commercial licenses may be obtained at
* https://www.kendoui.com/purchase/license-agreement/kendo-ui-complete-commercial.aspx
* If you do not own a commercial license, this file shall be governed by the trial license terms.
*/


("function"==typeof define&&define.amd?define:function(e,t){return t()})(["./kendo.dropdownlist.min","./kendo.editable.min","./kendo.multiselect.min","./kendo.window.min","./kendo.datepicker.min","./kendo.scheduler.recurrence.min","./kendo.scheduler.view.min","./kendo.scheduler.dayview.min","./kendo.scheduler.agendaview.min","./kendo.scheduler.monthview.min"],function(){!function(e,t){function i(e,t){var i,n=t.model.fields[t.field].validation;n&&(i=n.dateCompare,i&&S(i)&&i.message&&(e[h.attr("dateCompare-msg")]=i.message))}function n(e,t){return function(i){return i=e(i),r(i,"apply",t),i||[]}}function a(e,t){return function(i){return i&&("[object Array]"===I.call(i)||i instanceof h.data.ObservableArray||(i=[i])),r(i,"remove",t,!0),i=e(i),i||[]}}function r(e,t,i,n){var a,r,o;for(e=e||[],r=0,o=e.length;o>r;r++)a=e[r],(a.startTimezone||a.endTimezone||i)&&(a.start=h.timezone[t](a.start,a.startTimezone||a.endTimezone||i),a.end=h.timezone[t](a.end,a.endTimezone||a.startTimezone||i)),n&&delete a.uid;return e}function o(e,t){for(var i,n=e.length,a=0;n>a;a++)if(i=e[a],i.uid===t)return i}function d(e){var t,i,n,a,r;return e.filter("[name=end]").length&&(t=e.closest(".k-scheduler-edit-form"),i=t.find("[name=start]:visible"),n=t.find("[name=end]:visible"),n.length&&i.length&&(a=h.widgetInstance(i,h.ui),r=h.widgetInstance(n,h.ui),a&&r))?a.value()<=r.value():!0}function s(e){return delete e.name,delete e.prefix,delete e.remove,delete e.edit,e}function l(e){var t,i,n=[];for(t=0,i=e.length;i>t;t++)n.push(e[t].toJSON());return n}function c(t){return function(i){e(h.format('<select data-{0}bind="value: {1}">',h.ns,t.field)).appendTo(i).kendoDropDownList({dataTextField:t.dataTextField,dataValueField:t.dataValueField,dataSource:t.dataSource,valuePrimitive:t.valuePrimitive,optionLabel:"None",template:h.format('<span class="k-scheduler-mark" style="background-color:#= data.{0}?{0}:"none" #"></span>#={1}#',t.dataColorField,t.dataTextField)})}}function u(t){return function(i){e(h.format('<select data-{0}bind="value: {1}">',h.ns,t.field)).appendTo(i).kendoMultiSelect({dataTextField:t.dataTextField,dataValueField:t.dataValueField,dataSource:t.dataSource,valuePrimitive:t.valuePrimitive,itemTemplate:h.format('<span class="k-scheduler-mark" style="background-color:#= data.{0}?{0}:"none" #"></span>#={1}#',t.dataColorField,t.dataTextField),tagTemplate:h.format('<span class="k-scheduler-mark" style="background-color:#= data.{0}?{0}:"none" #"></span>#={1}#',t.dataColorField,t.dataTextField)})}}var v,p,f,m,h=window.kendo,g=h.date,w=g.getDate,_=h.recurrence,k=h.keys,y=h.ui,T=y.Widget,z="string",b=y.Popup,D=y.Calendar,S=e.isPlainObject,x=e.extend,E=e.proxy,I=Object.prototype.toString,C=e.isArray,H=".kendoScheduler",R="click",V="change",F="cancel",B="remove",P="save",A="add",M="edit",N=w(new Date),W="yyyyMMddTHHmmssZ",O="Are you sure you want to delete this event?",K="Do you want to delete only this event occurrence or the whole series?",j="Do you want to edit only this event occurrence or the whole series?",q='<a class="k-button #=className#" #=attr# href="\\#">#=text#</a>',L=h.template('<div class="k-floatwrap k-header k-scheduler-toolbar k-secondary"><ul class="k-reset k-header k-toolbar k-scheduler-navigation"><li class="k-state-default k-nav-today"><a href="\\#" class="k-link">${messages.today}</a></li><li class="k-state-default k-nav-prev"><a href="\\#" class="k-link"><span class="k-icon k-i-arrow-w"></span></a></li><li class="k-state-default k-nav-next"><a href="\\#" class="k-link"><span class="k-icon k-i-arrow-e"></span></a></li><li class="k-state-default k-nav-current"><a href="\\#" class="k-link"><span class="k-icon k-i-calendar"></span><span data-#=ns#bind="text: formattedDate"></span></a></li></ul><ul class="k-reset k-header k-toolbar k-scheduler-views">#for(var view in views){#<li class="k-state-default k-view-#=view#" data-#=ns#name="#=view#"><a href="\\#" class="k-link">${views[view].title}</a></li>#}#</ul></div>'),U=function(t,n){var a={name:n.field};i(a,n),e('<input type="text" required '+h.attr("type")+'="date"'+" "+h.attr("role")+'="datetimepicker" '+h.attr("bind")+'="value:'+n.field+',invisible:isAllDay" />').attr(a).appendTo(t),e('<input type="text" required '+h.attr("type")+'="date"'+" "+h.attr("role")+'="datepicker" '+h.attr("bind")+'="value:'+n.field+',visible:isAllDay" />').attr(a).appendTo(t),e("<span "+h.attr("bind")+'="text: '+n.field+'Timezone"></span>').appendTo(t),"end"===n.field&&e("<span "+h.attr("bind")+'="text: startTimezone, invisible: endTimezone"></span>').appendTo(t),e("<span "+h.attr("for")+'="'+n.field+'" class="k-invalid-msg"/>').hide().appendTo(t)},J=h.date.getMilliseconds,Q=function(t,i){e("<div "+h.attr("bind")+'="value:'+i.field+'" />').attr({name:i.field}).appendTo(t).kendoRecurrenceEditor({start:i.model.start,timezone:i.timezone,messages:i.messages})},Y=function(t,i){e('<a href="#" class="k-button">'+i.messages.timezoneEditorButton+"<a/>").click(i.click).appendTo(t)},$=function(t,i){e("<div "+h.attr("bind")+'="value:'+i.field+'" />').attr({name:i.field}).toggle(i.visible).appendTo(t).kendoTimezoneEditor()},Z=h.Class.extend({init:function(t,i){var r=t.timezone;this.reader=i,i.model&&(this.model=i.model),this.timezone=r,this.data=n(e.proxy(this.data,this),r),this.serialize=a(e.proxy(this.serialize,this),r)},errors:function(e){return this.reader.errors(e)},parse:function(e){return this.reader.parse(e)},data:function(e){return this.reader.data(e)},total:function(e){return this.reader.total(e)},groups:function(e){return this.reader.groups(e)},aggregates:function(e){return this.reader.aggregates(e)},serialize:function(e){return this.reader.serialize(e)}}),G=h.data.Model.define({init:function(e){var t=this;h.data.Model.fn.init.call(t,e)},toJSON:function(){var e=h.data.Model.fn.toJSON.call(this);return e.uid=this.uid,e},set:function(e,t){var i,n,a,r=this.isAllDay||!1;h.data.Model.fn.set.call(this,e,t),"isAllDay"==e&&t!=r&&(i=h.date.getDate(this.start),n=new Date(this.end),a=h.date.getMilliseconds(n),0===a&&t&&(a=h.date.MS_PER_DAY),this.set("start",i),t===!0?(h.date.setTime(n,-a),i>n&&(n=i)):h.date.setTime(n,h.date.MS_PER_DAY-a),this.set("end",n))},id:"id",fields:{id:{type:"number"},title:{defaultValue:"",type:"string"},start:{type:"date",validation:{required:!0}},startTimezone:{type:"string"},end:{type:"date",validation:{required:!0,dateCompare:{value:d,message:"End date should be greater than or equal to the start date"}}},endTimezone:{type:"string"},recurrenceRule:{defaultValue:"",type:"string"},recurrenceException:{defaultValue:"",type:"string"},isAllDay:{type:"boolean",defaultValue:!1},description:{type:"string"}}}),X=h.data.DataSource.extend({init:function(e){h.data.DataSource.fn.init.call(this,x(!0,{},{schema:{modelBase:G,model:G}},e)),this.reader=new Z(this.options.schema,this.reader)}});X.create=function(e){e=e&&e.push?{data:e}:e;var t=e||{},i=t.data;if(t.data=i,!(t instanceof X)&&t instanceof h.data.DataSource)throw Error("Incorrect DataSource type. Only SchedulerDataSource instances are supported");return t instanceof X?t:new X(t)},x(!0,h.data,{SchedulerDataSource:X,SchedulerDataReader:Z,SchedulerEvent:G}),v={update:{text:"Save",className:"k-scheduler-update"},canceledit:{text:"Cancel",className:"k-scheduler-cancel"},destroy:{text:"Delete",imageClass:"k-delete",className:"k-grid-delete",iconClass:"k-icon"}},p=T.extend({init:function(t,i){var n=this;T.fn.init.call(n,t,i),n.options.views&&n.options.views.length||(n.options.views=["day","week"]),n.resources=[],n._initModel(),n._wrapper(),n._views(),n._toolbar(),n._dataSource(),n._resources(),n._resizeHandler=E(n._resize,n),n.wrapper.on("mousedown"+H+" selectstart"+H,function(e){e.preventDefault()}),n.options.editable&&n.options.editable.resize!==!1&&n._resizable(),n.options.editable&&n.options.editable.move!==!1&&n._movable(),e(window).on("resize"+H,n._resizeHandler),n.options.messages&&n.options.messages.recurrence&&(_.options=n.options.messages.recurrence),n._selectable()},_selectable:function(){var t=this,i=h.support.mobileOS?"touchend":"mousedown";t.options.selectable&&(t._tabindex(),t.wrapper.on(i,".k-scheduler-header-all-day td, .k-scheduler-content td, .k-event",function(e){t._createSelection(e.currentTarget),t.wrapper.focus()}),t.wrapper.on("focus"+H,function(){t._selection||t._createSelection(e(".k-scheduler-content").find("td:first")),t.view().select(t._selection)}),t.wrapper.on("focusout"+H,function(){t.view().clearSelection(),t._ctrlKey=t._shiftKey=!1}),t.wrapper.on("keydown"+H,E(t._keydown,t)),t.wrapper.on("keyup"+H,function(e){t._ctrlKey=e.ctrlKey,t._shiftKey=e.shiftKey}))},_viewByIndex:function(e){var t,i=this.views;for(t in i){if(!e)return t;e--}},_keydown:function(e){var t,i=this,n=e.keyCode,a=i.view(),r=a.options.editable,o=i._selection,d=e.shiftKey;i._ctrlKey=e.ctrlKey,i._shiftKey=e.shiftKey,n===k.TAB?a.moveToEvent(o,d)&&(a.select(o),e.preventDefault()):r&&n===k.ENTER?o.events.length?r.update!==!1&&i.editEvent(o.events[0]):r.create!==!1&&i.addEvent(o):n===k.DELETE?i.removeEvent(o.events[0]):n>=49&&57>=n?i.view(i._viewByIndex(n-49)):a.move(o,n,d)&&(t=o.start,a.isInRange(t)?a.select(o):i.date(t),e.preventDefault()),i._adjustSelectedDate()},_createSelection:function(t){var i,n,a;this._selection&&(this._ctrlKey||this._shiftKey)||(this._selection={events:[],groupIndex:0}),t=e(t),a=this._selection,i=t.attr(h.attr("uid")),n=this.view().selectionByElement(t),n&&(a.groupIndex=n.groupIndex),i&&(n=o(this._data,i)),n&&n.uid&&(i=[n.uid]),this._updateSelection(n,i),this._adjustSelectedDate()},_updateSelection:function(e,t){var i,n,a=this._selection;e&&a&&(this._shiftKey&&a.start&&a.end?(i=e.end<a.end,n=this.view(),a.end=new Date(e.end),i&&n._timeSlotInterval&&h.date.setTime(a.end,-n._timeSlotInterval())):(a.start=new Date(e.start.getTime()),a.end=new Date(e.end.getTime())),a.isAllDay=e.isAllDay,a.index=e.index,a.events=this._ctrlKey?a.events.concat(t||[]):t||[])},options:{name:"Scheduler",date:N,editable:!0,autoBind:!0,timezone:"",messages:{today:"Today",save:"Save",cancel:"Cancel",destroy:"Delete",views:{day:"Day",week:"Week",agenda:"Agenda",month:"Month"},recurrenceMessages:{deleteWindowTitle:"Delete Recurring Item",deleteWindowOccurrence:"Delete current occurrence",deleteWindowSeries:"Delete the series",editWindowTitle:"Edit Recurring Item",editWindowOccurrence:"Edit current occurrence",editWindowSeries:"Edit the series"},editor:{title:"Title",start:"Start",end:"End",allDayEvent:"All day event",description:"Description",repeat:"Repeat",timezone:" ",startTimezone:"Start timezone",endTimezone:"End timezone",separateTimezones:"Use separate start and end time zones",timezoneEditorTitle:"Timezones",timezoneEditorButton:"Time zone",editorTitle:"Event"}},height:null,width:null,resources:[],group:{resources:[],direction:"horizontal"},views:[],selectable:!1},events:[B,M,F,P,"dataBinding","dataBound"],destroy:function(){var t,i=this;T.fn.destroy.call(i),i.dataSource&&i.dataSource.unbind(V,i._refreshHandler),i.calendar&&(i.calendar.destroy(),i.popup.destroy()),i.view()&&i.view().destroy(),i._destroyEditable(),t=i.element.add(i.wrapper).add(i.toolbar).add(i.popup),t.off(H),e(window).off("resize"+H,i._resizeHandler),h.destroy(i.wrapper)},setDataSource:function(e){this.options.dataSource=e,this._dataSource(),this.options.autoBind&&e.fetch()},items:function(){return this.wrapper.children(".k-event, .k-task")},_movable:function(){var t,i,n,a=this;a._moveDraggable=new h.ui.Draggable(a.element,{distance:0,filter:".k-event",dragstart:function(e){var r=e.currentTarget,d=r.attr(h.attr("uid")),s=a.view();n=o(a._data,d),t=s._slotByPosition(e.x.location,e.y.location),i=t},drag:function(e){var r=a.view(),o=r._slotByPosition(e.x.location,e.y.location);o&&(i=o,r._updateMoveHint(n,t,i))},dragend:function(){var r,o,d,s,l,c;a.view()._removeMoveHint(),r=i.start.getTime()-t.start.getTime(),o=n.end.getTime()-n.start.getTime(),d=new Date(n.start.getTime()),h.date.setTime(d,r),s=new Date(d.getTime()),h.date.setTime(s,o),l=a.view()._resourceBySlot(i),c=a.view()._resourceBySlot(t),(n.start.getTime()!=d.getTime()||n.end.getTime()!=s.getTime()||h.stringify(l)!=h.stringify(c))&&a._updateEvent(null,n,e.extend({start:d,end:s},l))},dragcancel:function(){a.view()._removeMoveHint()}})},_resizable:function(){function t(e){var t,i={"k-resize-e":"east","k-resize-w":"west","k-resize-n":"north","k-resize-s":"south"};for(t in i)if(e.hasClass(t))return i[t]}var i,n,a,r=this;r._resizeDraggable=new h.ui.Draggable(r.element,{distance:0,filter:".k-resize-handle",dragstart:function(t){var d,s,l,c=e(t.currentTarget),u=c.closest(".k-event"),v=u.attr(h.attr("uid"));a=o(r._data,v),d=r.view(),s=this.element.find(h.format(".k-event[{0}={1}]",h.attr("uid"),v)),u=s.first(),l=u.offset(),i=d._slotByPosition(l.left,l.top),u=s.last(),l=u.offset(),l.left+=u[0].clientWidth,l.top+=u[0].clientHeight,n=d._slotByPosition(l.left,l.top)},drag:function(o){var d,s=e(o.currentTarget),l=t(s),c=r.view(),u=c._slotByPosition(o.x.location,o.y.location);u&&(d=!1,"south"==l?i.groupIndex==u.groupIndex&&u.end-a.start>=c._timeSlotInterval()&&(n=u,d=!0):"north"==l?n.groupIndex==u.groupIndex&&a.end-u.start>=c._timeSlotInterval()&&(i=u,d=!0):"east"==l?i.groupIndex==u.groupIndex&&h.date.getDate(u.end).getTime()>=h.date.getDate(a.start).getTime()&&(n=u,d=!0):"west"==l&&n.groupIndex==u.groupIndex&&h.date.getDate(a.end).getTime()>=h.date.getDate(u.start).getTime()&&(i=u,d=!0),d&&c._updateResizeHint(l,i,n))},dragend:function(o){var d=e(o.currentTarget),s=new Date(a.start.getTime()),l=new Date(a.end.getTime()),c=t(d);r.view()._removeResizeHint(),"south"==c?l=n.end:"north"==c?s=i.start:"east"==c?(l=h.date.getDate(n.end),a.isAllDay||(l=h.date.addDays(l,1))):"west"==c&&(s=new Date(i.start.getTime()),s.setHours(0),s.setMinutes(0)),(a.start.getTime()!=s.getTime()||a.end.getTime()!=l.getTime())&&r._updateEvent(c,a,{start:s,end:l})},dragcancel:function(){r.view()._removeResizeHint()}})},_updateEvent:function(e,t,i){var n=this,a=function(e){e.recurrenceId&&n._removeExceptionDate(e);for(var t in i)e.set(t,i[t]);e.recurrenceId&&n._addExceptionDate(e),n.trigger(P,{model:e})||(n._updateSelection(e),n.dataSource.sync())},r=function(e){return e.recurrenceRule?n.dataSource.getByUid(e.uid):n.dataSource.get(e.recurrenceId)},o=function(){var n,o,d=r(t);("south"==e||"north"==e)&&(i.start&&(n=h.date.getDate(d.start),h.date.setTime(n,J(i.start)),i.start=n),i.end&&(o=h.date.getDate(d.end),h.date.setTime(o,J(i.end)),i.end=o)),a(d)},d=function(){var e,a=r(t),o=a.toJSON();delete o[a.idField],delete o.recurrenceRule,delete o.id,o.recurrenceId=a.id,o.start=t.start,o.end=t.end,o=n.dataSource.add(o),n._addExceptionDate(o);for(e in i)o.set(e,i[e]);n.trigger(P,{model:o})||(n._updateSelection(t),n.dataSource.sync())},s=n.options.messages.recurrenceMessages;t.recurrenceRule||t.recurrenceId&&!t.id?n.showDialog({title:s.editWindowTitle,text:s.editRecurring?s.editRecurring:j,buttons:[{text:s.editWindowOccurrence,click:d},{text:s.editWindowSeries,click:o}]}):a(n.dataSource.getByUid(t.uid))},_modelForContainer:function(t){t=e(t).closest("["+h.attr("uid")+"]");var i=t.attr(h.attr("uid"));return this.dataSource.getByUid(i)},showDialog:function(t){var i,n,a=h.format("<div class='k-popup-edit-form'><div class='k-edit-form-container'><p class='k-popup-message'>{0}</p>",t.text),r=this;for(a+='<div class="k-edit-buttons k-state-default">',i=0;i<t.buttons.length;i++)a+=r._createButton(t.buttons[i]);a+="</div></div></div>",n=e(a).appendTo(r.wrapper).eq(0).on("click",".k-button",function(i){i.preventDefault(),n.close();var a=e(i.currentTarget).index();t.buttons[a].click()}).kendoWindow({modal:!0,resizable:!1,draggable:!1,title:t.title,visible:!1,close:function(){this.destroy(),r.focus()}}).getKendoWindow(),n.center().open()},focus:function(){this.wrapper.focus()},_confirmation:function(e){var t,i,n=this.options.editable;n===!0||n.confirmation?(t=this.options.messages,i=typeof n.confirmation===z?n.confirmation:O,this.showDialog({text:i,title:"Delete Event",buttons:[{name:"destroy",text:t.destroy,click:function(){e()}},{name:"canceledit",text:t.cancel,click:function(){e(!0)}}]})):e()},addEvent:function(e){var t,i;(this.editable&&this.editable.end()||!this.editable)&&(this.cancelEvent(),t=this.dataSource,i=t._createNewModel(),i instanceof h.data.Model?i.accept(e):i=x({title:""},i,e),i=this.dataSource.add(i),i&&this.editEvent(i.uid))},saveEvent:function(){var e=this,t=e._editContainer,i=e._modelForContainer(t),n=e.editable;t&&n&&n.end()&&!e.trigger(P,{container:t,model:i})&&e.dataSource.sync()},cancelEvent:function(){var e,t=this,i=t._editContainer;i&&(e=t._modelForContainer(i),t._removeExceptionDate(e),t.dataSource.cancelChanges(e),t._destroyEditable())},editEvent:function(e){var t=this,i="string"==typeof e?t.dataSource.getByUid(e):e;t.cancelEvent(),!i||i.recurrenceRule||i.id&&i.recurrenceId?t._editRecurringDialog(i,e):t._editEvent(i)},_editEvent:function(e){var t,i=this;i._createPopupEditor(e),t=i._editContainer,t.on(R+H,"a.k-scheduler-cancel",function(n){n.preventDefault(),n.stopPropagation(),i.trigger(F,{container:t,event:e})||i.cancelEvent()}),t.on(R+H,"a.k-scheduler-update",function(e){e.preventDefault(),e.stopPropagation(),i.saveEvent()})},_createButton:function(e){var t=e.template||q,i=typeof e===z?e:e.name||e.text,n={className:"k-scheduler-"+(i||"").replace(/\s/g,""),text:i,attr:""};if(!(i||S(e)&&e.template))throw Error("Custom commands should have name specified");return S(e)?(e.className&&(e.className+=" "+n.className),"edit"===i&&S(e.text)&&(e=x(!0,{},e),e.text=e.text.edit),n=x(!0,n,v[i],e)):n=x(!0,n,v[i]),h.template(t)(n)},_revertTimezones:function(e){e.set("startTimezone",this._startTimezone),e.set("endTimezone",this._endTimezone)},_createTimezonePopup:function(t,i){var n,a=this,r=a._editContainer.find(".k-scheduler-timezones"),o=r.find(".k-timezone-toggle"),d=r.find(".k-edit-label:last").add(r.find(".k-edit-field:last")),s=r.find(".k-scheduler-savetimezone"),l=r.find(".k-scheduler-canceltimezone"),c=a._timezonePopup;a._startTimezone=t.startTimezone,a._endTimezone=t.endTimezone,c||(a._timezonePopup=c=r.kendoWindow({modal:!0,resizable:!1,draggable:!0,title:a.options.messages.editor.timezoneEditorTitle,visible:!1,close:function(e){e.userTriggered&&a._revertTimezones(t),i&&i.focus()}}),o.click(function(){d.toggle(e(this).prop("checked")),t.set("endTimezone","")}),s.click(function(e){e.preventDefault(),n.close()}),l.click(function(e){e.preventDefault(),a._revertTimezones(t),n.close()})),o.prop("checked",t.endTimezone),d.toggle(t.endTimezone),n=c.data("kendoWindow"),n.center().open()},_createPopupEditor:function(i){var n,a,r,o,d,s,l,v,p,f=this,m=f.options.editable,g="<div "+h.attr("uid")+'="'+i.uid+'" class="k-popup-edit-form k-scheduler-edit-form"><div class="k-edit-form-container">',w=m.template,_=f.options.messages,k=_.save,y=_.cancel,T=function(e){e.preventDefault(),f._createTimezonePopup(i,this)},b=[{field:"title",title:_.editor.title},{field:"start",title:_.editor.start,editor:U},{field:"end",title:_.editor.end,editor:U},{field:"isAllDay",title:_.editor.allDayEvent}],D=S(m)?m.window:{},E=x({},h.Template,f.options.templateSettings),I=E.paramName,C=i.startTime,H=i.endTime,R=[];if(w)typeof w===z&&(w=window.unescape(w)),g+=h.template(w,E)(i);else{h.timezone.windows_zones&&(b.push({field:"timezone",title:_.editor.timezone,editor:Y,click:T,messages:_.editor}),b.push({field:"startTimezone",title:_.editor.startTimezone,editor:$}),b.push({field:"endTimezone",title:_.editor.endTimezone,editor:$})),i.recurrenceId||(a=i.startTimezone||i.endTimezone||this.dataSource.reader.timezone,b.push({field:"recurrenceRule",title:_.editor.repeat,editor:Q,timezone:a,messages:_.recurrenceEditor})),"description"in i&&b.push({field:"description",title:_.editor.description,editor:'<textarea name="description" class="k-textbox"/>'});for(r=0;r<f.resources.length;r++)o=f.resources[r],b.push({field:o.field,title:o.title,editor:o.multiple?u(o):c(o)});for(d=0,s=b.length;s>d;d++)l=b[d],"startTimezone"===l.field&&(g+='<div class="k-popup-edit-form k-scheduler-edit-form k-scheduler-timezones" style="display:none">',g+='<div class="k-edit-form-container">',g+='<div class="k-edit-label"></div>',g+='<div class="k-edit-field"><label><input class="k-timezone-toggle" type="checkbox" />'+_.editor.separateTimezones+"</label></div>"),g+='<div class="k-edit-label"><label for="'+l.field+'">'+(l.title||l.field||"")+"</label></div>",!i.editable||i.editable(l.field)?(R.push(l),g+="<div "+h.attr("container-for")+'="'+l.field+'" class="k-edit-field"></div>'):(v="#:",l.field?(l=h.expr(l.field,I),v+=l+"==null?'':"+l):v+="''",v+="#",v=h.template(v,E),g+='<div class="k-edit-field">'+v(i)+"</div>"),"endTimezone"===l.field&&(g+='<div class="k-edit-buttons k-state-default">',g+=f._createButton({name:"savetimezone",text:_.save})+f._createButton({name:"canceltimezone",text:_.cancel}),g+="</div></div></div>")}g+='<div class="k-edit-buttons k-state-default">',g+=f._createButton({name:"update",text:k,attr:n})+f._createButton({name:"canceledit",text:y,attr:n}),g+="</div></div></div>",p=f._editContainer=e(g).appendTo(f.wrapper).eq(0).kendoWindow(x({modal:!0,resizable:!1,draggable:!0,title:_.editor.editorTitle,visible:!1,close:function(e){if(e.userTriggered){if(f.trigger(F,{container:p,event:i}))return e.preventDefault(),t;i.startTime=C,i.endTime=H,f.cancelEvent(),f.focus()}}},D)),delete i.startTime,delete i.endTime,f.editable=f._editContainer.kendoEditable({fields:R,model:i,clearContainer:!1,validateOnBlur:!0}).data("kendoEditable"),f.trigger(M,{container:p,event:i})?f.cancelEvent():p.data("kendoWindow").center().open()},_editRecurringDialog:function(e,t){var i,n,a,r,d,s=this;(e||(e=o(s._data,t)))&&(a=function(){e.id&&e.recurrenceId?s._editEvent(e):(e.recurrenceId||(i=e.id,n=e.idField,e.toJSON&&(e=e.toJSON()),delete e[n],delete e.recurrenceRule,delete e.id,e.uid=h.guid(),e.recurrenceId=i),s._addExceptionDate(e),s.addEvent(e))},r=function(){e.recurrenceId&&(e=s.dataSource.get(e.recurrenceId)),s._removeExceptions(e),e.set("recurrenceException",""),s._editEvent(e)},d=s.options.messages.recurrenceMessages,s.showDialog({title:d.editWindowTitle,text:d.editRecurring?d.editRecurring:j,buttons:[{text:d.editWindowOccurrence,click:a},{text:d.editWindowSeries,click:r}]}))},_addExceptionDate:function(e){var t=this.dataSource.get(e.recurrenceId),i=e.startTimezone||e.endTimezone||this.dataSource.reader.timezone,n=t.recurrenceException||"",a=e.start;_.isException(n,a,i)||(a=h.timezone.convert(a,i||a.getTimezoneOffset(),"Etc/UTC"),n+=h.toString(a,W)+";",t.set("recurrenceException",n))},_removeExceptionDate:function(e){var t,i,n,a=e.startTimezone||e.endTimezone||this.dataSource.reader.timezone,r=e.start;e.recurrenceId&&(t=this.dataSource.get(e.recurrenceId),r=h.timezone.convert(r,a||r.getTimezoneOffset(),"Etc/UTC"),t&&(i=h.toString(r,W)+";",n=t.recurrenceException.replace(i,""),t.set("recurrenceException",n)))},_destroyEditable:function(){var e=this,t=function(){e.editable&&(e.editable.destroy(),e.editable=null,e._editContainer=null)};e.editable&&(e._timezonePopup&&e._timezonePopup.data("kendoWindow")&&(e._timezonePopup.data("kendoWindow").destroy(),e._timezonePopup=null),e._editContainer.data("kendoWindow").bind("deactivate",t).close())},removeEvent:function(e){var t="string"==typeof e?this.dataSource.getByUid(e):e,i=this;!t||t.recurrenceRule||t.id&&t.recurrenceId?i._deleteRecurringDialog(t,e):i._removeEvent(t)},_removeEvent:function(e,t){var i=this;i._confirmation(function(n){n?i._removeExceptionDate(e):i.trigger(B,{event:e})||(t&&i._removeExceptions(e),i.dataSource.remove(e)&&i.dataSource.sync())})},_deleteRecurringDialog:function(e,t){var i,n,a,r,d,s=this,l=!e;(!l||(e=o(s._data,t)))&&(a=function(){e.recurrenceId||(i=e.id,n=e.idField,e=e.toJSON(),delete e[n],delete e.recurrenceRule,delete e.id,e.uid=h.guid(),e.recurrenceId=i),s._addExceptionDate(e),s._removeEvent(e)},r=function(){e.recurrenceId&&(e=s.dataSource.get(e.recurrenceId)),s._removeEvent(e,!0)},d=s.options.messages.recurrenceMessages,s.showDialog({title:d.deleteWindowTitle,text:d.deleteRecurring?d.deleteRecurring:K,buttons:[{text:d.deleteWindowOccurrence,click:a},{text:d.deleteWindowSeries,click:r}]}))},_removeExceptions:function(e){for(var t,i=this.dataSource,n=i.data(),a=n.length,r=0,o=e.id;a>r;r++)t=n[r],t.recurrenceId===o&&(i.remove(t),a-=1,r-=1)},_unbindView:function(e){e.destroy()},_bindView:function(e){var t=this;t.options.editable&&(t._viewRemoveHandler&&e.unbind(B,t._viewRemoveHandler),t._viewRemoveHandler=function(e){t.removeEvent(e.uid)},e.bind(B,t._viewRemoveHandler),t._viewAddHandler&&e.unbind(A,t._viewAddHandler),t._viewAddHandler=function(e){t.addEvent(e.eventInfo)},e.bind(A,this._viewAddHandler),t._viewEditHandler&&e.unbind(M,t._viewEditHandler),t._viewEditHandler=function(e){t.editEvent(e.uid)},e.bind(M,this._viewEditHandler),t._viewNavigateHandler&&e.unbind("navigate",t._viewNavigateHandler),t._viewNavigateHandler=function(e){e.view&&(t._selectView(e.view),t.date(e.date))},e.bind("navigate",t._viewNavigateHandler),t._viewActivateHandler=function(){var e=this;t._selection&&(e.moveSelectionToPeriod(t._selection),e.select(t._selection),t._adjustSelectedDate())},e.bind("activate",t._viewActivateHandler))},_selectView:function(e){var t=this;e&&t.views[e]&&(t._selectedView&&t._unbindView(t._selectedView),t._selectedView=t._renderView(e),t._selectedViewName=e,t.toolbar.find(".k-scheduler-views li").removeClass("k-state-selected").end().find(".k-view-"+e).addClass("k-state-selected"))},view:function(e){var i=this;return e?(i._selectView(e),i.rebind(),t):i._selectedView},_renderView:function(e){var t=this._initializeView(e);return this._bindView(t),this._model.set("formattedDate",t.dateForTitle()),t},_resize:function(){this.refresh()},_adjustSelectedDate:function(){var e=this._model.selectedDate,t=this._selection,i=t.start;i&&!h.date.isInDateRange(e,w(i),w(t.end))&&e.setFullYear(i.getFullYear(),i.getMonth(),i.getDate())},_initializeView:function(e){var t,i,n=this.views[e];if(n){if(t=S(n),i=n.type,typeof i===z&&(i=h.getter(n.type)(window)),!i)throw Error("There is no such view");n=new i(this.wrapper,s(x(!0,{},this.options,t?n:{},{resources:this.resources,date:this.date()})))}return n},_views:function(){var e,t,i,n,a,r,o,d,s=this.options.views;for(this.views={},o=0,d=s.length;d>o;o++)e=s[o],n=S(e),n?(r=a=e.type?e.type:e,typeof r!==z&&(a=e.title)):r=a=e,t=f[a],t&&(e.type=t.type,t.title=this.options.messages.views[a],"day"===t.type?t.messages={allDay:this.options.messages.allDay}:"agenda"===t.type&&(t.messages={event:this.options.messages.event,date:this.options.messages.date,time:this.options.messages.time})),e=x({title:a},t,n?e:{}),a&&(this.views[a]=e,(!i||e.selected)&&(i=a));i&&(this._selectedViewName=i)},rebind:function(){this.dataSource.fetch()},_dataSource:function(){var e=this,t=e.options,i=t.dataSource;i=C(i)?{data:i}:i,!t.timezone||i instanceof X||(i=x(!0,i,{schema:{timezone:t.timezone}})),e.dataSource&&e._refreshHandler?e.dataSource.unbind(V,e._refreshHandler):e._refreshHandler=E(e.refresh,e),e.dataSource=h.data.SchedulerDataSource.create(i).bind(V,e._refreshHandler)},_resources:function(){var t,i,n,a,r,o=this,d=o.options.resources;for(t=0;t<d.length;t++){if(i=d[t],n=i.field,a=i.dataSource,!n||!a)throw Error('The "field" and "dataSource" options of the scheduler resource are mandatory.');o.resources.push({field:n,name:i.name||n,title:i.title||n,dataTextField:i.dataTextField||"text",dataValueField:i.dataValueField||"value",dataColorField:i.dataColorField||"color",valuePrimitive:null!=i.valuePrimitive?i.valuePrimitive:!0,multiple:i.multiple||!1,dataSource:h.data.DataSource.create(a)})}r=e.map(o.resources,function(e){return e.dataSource.fetch()}),e.when.apply(null,r).then(function(){o.options.autoBind?o.view(o._selectedViewName):o._selectView(o._selectedViewName)})},_initModel:function(){var e=this;e._model=h.observable({selectedDate:this.options.date,formattedDate:""}),e._model.bind("change",function(t){"selectedDate"===t.field&&e.view(e._selectedViewName)})},_wrapper:function(){var e=this,t=e.options.height;e.wrapper=e.element,e.wrapper.addClass("k-widget k-scheduler k-floatwrap"),t&&e.wrapper.css("height",t)},date:function(e){return null!=e&&this._model.set("selectedDate",e),w(this._model.get("selectedDate"))},_toolbar:function(){var i=this,n=i.options,a=e(L({messages:n.messages,ns:h.ns,views:i.views}));i.wrapper.append(a),i.toolbar=a,h.bind(i.toolbar,i._model),a.on(R+H,".k-scheduler-navigation li",function(n){var a=e(this),r=new Date(i.date());if(n.preventDefault(),a.hasClass("k-nav-today"))r=new Date;else if(a.hasClass("k-nav-next"))r=i.view().nextDate();else if(a.hasClass("k-nav-prev"))r=i.view().previousDate();else if(a.hasClass("k-nav-current"))return i._showCalendar(),t;i.date(r)}),a.on(R+H,".k-scheduler-views li",function(t){i.view(e(this).attr(h.attr("name"))),t.preventDefault()}),a.find("li").hover(function(){e(this).addClass("k-state-hover")},function(){e(this).removeClass("k-state-hover")})},_showCalendar:function(){var t=this,i=t.toolbar.find(".k-nav-current"),n=e('<div class="k-calendar-container"><div class="k-scheduler-calendar"/></div>');t.popup||(t.popup=new b(n,{anchor:i,activate:function(){t.calendar||(t.calendar=new D(this.element.find(".k-scheduler-calendar"),{change:function(){t.date(this.value()),t.popup.close()}})),t.calendar.value(t.date())},copyAnchorStyles:!1})),t.popup.open()},_expandEvents:function(e,t){var i=t.endDate(),n=t.endTime;return _?(i=new Date(i),n?i.setHours(n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()):i.setHours(23,59,59,999),e=_.expandAll(e,t.startDate(),i,this.dataSource.reader.timezone)):e=l(e),e},_createFilter:function(e,t){var i=h.date.MS_PER_DAY,n={};return e&&t&&(n={logic:"or",filters:[{logic:"and",filters:[{field:"start",operator:"gte",value:e},{field:"end",operator:"gte",value:e},{field:"start",operator:"lte",value:new Date(t.getTime()+i-1)}]},{logic:"and",filters:[{field:"start",operator:"lte",value:new Date(e.getTime()+i-1)},{field:"end",operator:"gte",value:e}]}]}),n},refresh:function(e){var t=this.view(),i=this.dataSource.view();e&&"itemchange"===e.action&&this.editable||(this.trigger("dataBinding"),this._destroyEditable(),this._data=i=this._expandEvents(i,t),i=new h.data.Query(i).filter(this._createFilter(t.startDate(),t.endDate())).toArray(),t.render(i),this.trigger("dataBound"))}}),f={day:{type:"kendo.ui.DayView"},week:{type:"kendo.ui.WeekView"},agenda:{type:"kendo.ui.AgendaView"},month:{type:"kendo.ui.MonthView"}},y.plugin(p),m=T.extend({init:function(e,t){var i=this,n=h.timezone.windows_zones;if(!n||!h.timezone.zones_titles)throw Error("kendo.timezones.min.js is not included.");T.fn.init.call(i,e,t),i.wrapper=i.element,i._zonesQuery=new h.data.Query(n),i._zoneTitleId=h.guid(),i._zoneTitlePicker(),i._zonePicker(),i.value(i.options.value)},options:{name:"TimezoneEditor",value:"",optionLabel:"No timezone"},events:["change"],_zoneTitlePicker:function(){var t=this,i=e('<input id="'+t._zoneTitleId+'"/>').appendTo(t.wrapper);t._zoneTitle=new h.ui.DropDownList(i,{dataSource:h.timezone.zones_titles,dataValueField:"other_zone",dataTextField:"name",optionLabel:t.options.optionLabel,cascade:function(){this.value()||t._zone.wrapper.hide()}})},_zonePicker:function(){var t=this,i=e("<input />").appendTo(this.wrapper);t._zone=new h.ui.DropDownList(i,{dataValueField:"zone",dataTextField:"territory",dataSource:t._zonesQuery.data,cascadeFrom:t._zoneTitleId,cascade:function(){t._value=this.value(),t.trigger("change")},dataBound:function(){t._value=this.value(),this.wrapper.toggle(this.dataSource.view().length>1)}}),t._zone.wrapper.hide()},destroy:function(){T.fn.destroy.call(this),this._moveDraggable&&this._moveDraggable.destroy(),this._resizeDraggable&&this._resizeDraggable.destroy(),h.destroy(this.wrapper)},value:function(e){var i,n=this;return e===t?n._value:(i=n._zonesQuery.filter({field:"zone",operator:"eq",value:e}).data[0],i?(n._zoneTitle.value(i.other_zone),n._zone.value(i.zone)):n._zoneTitle.value(""),t)
}}),y.plugin(m)}(window.kendo.jQuery)});