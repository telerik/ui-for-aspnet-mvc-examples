/*
* Kendo UI Complete v2013.2.716 (http://kendoui.com)
* Copyright 2013 Telerik AD. All rights reserved.
*
* Kendo UI Complete commercial licenses may be obtained at
* https://www.kendoui.com/purchase/license-agreement/kendo-ui-complete-commercial.aspx
* If you do not own a commercial license, this file shall be governed by the trial license terms.
*/


("function"==typeof define&&define.amd?define:function(t,e){return e()})(["./kendo.scheduler.view.min"],function(){!function(t){function e(t){var e=new Date(1980,1,1,0,0,0);return f(e,D(t)),e}function s(t,e,s){var n,i=e.getTime(),o=s.getTime();return n=t.getTime(),n>=i&&o>=n}function n(t,e,s){return t>e&&s>t}function i(t,e,s){var n,i,o;for(n=0;n<t.length;n++)for(i=0;i<t[n].slots.length;i++)if(o=t[n].slots[i],e>=o.offsetLeft&&e<o.offsetLeft+o.clientWidth&&s>=o.offsetTop&&s<o.offsetTop+o.clientHeight)return o}function o(t,e,s){for(var n,i=0,o=e.length,a=[];o>i;i++)n=e[i],s(t[n.start])&&a.push(n);return a}function a(t){t.className=t.className.replace(H,"")+" k-state-selected"}function r(t,e){return t.valuePrimitive&&(e=d.getter(t.dataValueField)(e)),e}function l(e,s,n){return s&&s.length?(s=s[s.length-1],e=t.map(e,function(t){return t.element.data("uid")}),t.inArray(s,e)+(n?-1:1)):n&&s?s.length-1:0}var d=window.kendo,h=d.ui,u=d.keys,c=d.date.addDays,f=d.date.setTime,p=h.SchedulerView,_=t.extend,m=t.proxy,g=d.date.getDate,v=d.date.MS_PER_MINUTE,y=d.date.MS_PER_DAY,D=d.date.getMilliseconds,T=".kendoMultiDayView",I=d.template('<div title="(#=kendo.format("{0:t} - {1:t}", start, end)#): #=title#"><dl><dt>#=kendo.format("{0:t} - {1:t}", start, end)#</dt><dd>${title}</dd></dl></div>'),k=d.template('<div title="(#=kendo.format("{0:t}", start)#): #=title#"><dl><dd>${title}</dd></dl></div>'),w=d.template("<span class='k-link k-nav-day'>#=kendo.toString(date, 'ddd M/dd')#</span>"),x='<div class="k-event" data-#=ns#uid="#=uid#"#if (resources[0]) { #style="background-color:#=resources[0].color #"#}#><span class="k-event-actions"># if(data.tail || data.middle) {#<span class="k-icon k-i-arrow-w"></span>#}## if(data.id && data.recurrenceId) {#<span class="k-icon k-i-exception"></span># } else if(data.recurrenceRule || data.recurrenceId) {#<span class="k-icon k-i-refresh"></span># } #</span>{0}<span class="k-event-actions">#if (showDelete) {#<a href="\\#" class="k-link k-event-delete"><span class="k-icon k-si-close"></span></a>#}## if(data.head || data.middle) {#<span class="k-icon k-i-arrow-e"></span>#}#</span>#if(resizable && !singleDay && !data.tail && !data.middle){#<span class="k-resize-handle k-resize-w"></span>#}##if(resizable && !singleDay && !data.head && !data.middle){#<span class="k-resize-handle k-resize-e"></span>#}#</div>',S='<div class="k-event" data-#=ns#uid="#=uid#"#if (resources[0]) { #style="background-color:#=resources[0].color #"#}#><span class="k-event-actions"># if(data.id && data.recurrenceId) {#<span class="k-icon k-i-exception"></span># } else if(data.recurrenceRule || data.recurrenceId) {#<span class="k-icon k-i-refresh"></span># } #</span>{0}<span class="k-event-actions">#if (showDelete) {#<a href="\\#" class="k-link k-event-delete"><span class="k-icon k-si-close"></span></a>#}#</span><span class="k-event-top-actions"># if(data.tail || data.middle) {#<span class="k-icon k-i-arrow-n"></span># } #</span><span class="k-event-bottom-actions"># if(data.head || data.middle) {#<span class="k-icon k-i-arrow-s"></span># } #</span># if(resizable && !data.tail && !data.middle) {#<span class="k-resize-handle k-resize-n"></span># } ## if(resizable && !data.head && !data.middle) {#<span class="k-resize-handle k-resize-s"></span># } #</div>',C=p.extend({init:function(t,e){var s=this;p.fn.init.call(s,t,e),s.title=s.options.title||s.options.name,s._templates(),s._editable(),s.calculateDateRange(),s._slots()},_toDaySlot:function(t){if(!t.isAllDay)return t;var e=0;return this._isVerticallyGrouped()&&(e+=t.groupIndex*this._rowCountInGroup()),this._columns[t.columnIndex].slots[e]},_toAllDaySlot:function(t){return t.isAllDay?t:this._rows[t.groupIndex].slots[t.columnIndex]},_updateResizeHint:function(t,e,s){var n,i,o,a,r,l,h,u,c,f,_,m="south"==t||"north"==t,g=this.content,v=function(t,e,s,n){var i,o=0;for(i=e;s>i;i++)o+=t[i][n];return o+=t[s][n]};if(this._removeResizeHint(),m){for(e=this._toDaySlot(e),s=this._toDaySlot(s),i=[],o=e.columnIndex;o<=s.columnIndex;o++)a=this._columns[o].slots,r=0,l=a.length-1,this._isVerticallyGrouped()&&(r=e.groupIndex*this._rowCountInGroup(),l=(e.groupIndex+1)*this._rowCountInGroup()-1),h=a[r],u=a[l],h.start<e.start&&(h=e),u.start>s.start&&(u=s),i.push({startSlot:h,endSlot:u});for(c=0;c<i.length;c++)f=i[c],e=f.startSlot,s=f.endSlot,_=p.fn._createResizeHint.call(this,e.offsetLeft,e.offsetTop,e.offsetWidth,v(this._columns[e.columnIndex].slots,e.index,s.index,"offsetHeight")),_.appendTo(g),this._resizeHint=this._resizeHint.add(_);n="t"}else e=this._toAllDaySlot(e),s=this._toAllDaySlot(s),g=this.element.find(".k-scheduler-header-wrap:has(.k-scheduler-header-all-day)"),g.length||(g=this.content),this._resizeHint=p.fn._createResizeHint.call(this,e.offsetLeft,e.offsetTop,v(this._rows[0].slots,e.columnIndex,s.columnIndex,"offsetWidth"),e.clientHeight),this._resizeHint.appendTo(g),n="M/dd";this._resizeHint.find(".k-label-top,.k-label-bottom").text(""),this._resizeHint.first().addClass("k-first").find(".k-label-top").text(d.toString(e.start,n)),this._resizeHint.last().addClass("k-last").find(".k-label-bottom").text(d.toString(s.end,n))},_updateMoveHint:function(e,s,n){var i,o,a,r,l,h,u,c,p,_,m,g,v,T,I,k,w,x,S,C,H=e.isAllDay||e.end.getTime()-e.start.getTime()>y,G=n.groupIndex*this._columnCountInGroup();if(H?(n=this._toAllDaySlot(n),i=this._rows[n.index].slots):(n=this._toDaySlot(n),i=this._columns[n.columnIndex].slots),o=n.start.getTime()-s.start.getTime(),a=e.end.getTime()-e.start.getTime(),r=new Date(e.start.getTime()),d.date.setTime(r,o),l=new Date(r.getTime()),f(l,a),H?(h=this._dateSlotIndex(r)+G,u=this._dateSlotIndex(l)+G):(h=Math.floor(this._timeSlotIndex(r)),u=Math.ceil(this._timeSlotIndex(l)),this._isVerticallyGrouped()&&(h+=n.groupIndex*this._rowCountInGroup(),u+=n.groupIndex*this._rowCountInGroup())),0>h&&(h=0),0>u&&(u=i.length-1),H&&this._isGroupedByDate()&&(h=u=n.columnIndex),e.isAllDay||(u=Math.max(h,u-1)),c=i[h],this._removeMoveHint(),H)this._moveHint=this._createEventElement(t.extend({},e,{start:r,end:l}),!1),this._moveHint.addClass("k-event-drag-hint"),this._moveHint.css({left:c.offsetLeft+2,top:c.offsetTop,width:this._calculateAllDayEventWidth(i,h,u)-4});else{for(p=Math.max(0,this._dateSlotIndex(l)),(0===D(l)||D(l)<D(this.options.startTime))&&(p=this._dateSlotIndex(r)),i=this._columns[p+G].slots,u=Math.min(i.length-1,u),_=i[u],m=[],g=c.columnIndex;g<=_.columnIndex;g++)i=this._columns[g].slots,v=0,T=i.length-1,this._isVerticallyGrouped()&&(v=n.groupIndex*this._rowCountInGroup(),T=(n.groupIndex+1)*this._rowCountInGroup()-1),I=i[v],k=i[T],I.start<c.start&&(I=c),k.start>_.start&&(k=_),m.push({startSlot:I,endSlot:k});for(w=0;w<m.length;w++)x=m[w],c=x.startSlot,_=x.endSlot,u=_.index,this._isVerticallyGrouped()?u==(n.groupIndex+1)*this._rowCountInGroup()-1&&u++:u==i.length-1&&u++,S=this._createEventElement(t.extend({},e,{start:r,end:l}),!0),S.addClass("k-event-drag-hint"),S.css({left:c.offsetLeft+2,top:c.offsetTop,width:.9*c.clientWidth-4,height:this._calculateEventHeight(this._columns[c.columnIndex].slots,c.index,u)-3}),this._moveHint=this._moveHint.add(S)}C=this.content,H&&(C=this.element.find(".k-scheduler-header-wrap:has(.k-scheduler-header-all-day)"),C.length||(C=this.content)),this._moveHint.appendTo(C)},_slotByPosition:function(t,e){var s,n,o,a,r=this.element.find(".k-scheduler-header-wrap:has(.k-scheduler-header-all-day)").offset();if(r&&(t-=r.left,e-=r.top),t=Math.ceil(t),e=Math.ceil(e),s=i(this._rows,t,e))return s;if(r&&(t+=r.left,e+=r.top),r=this.content.offset(),t-=r.left,e-=r.top,e+=this.content[0].scrollTop,t+=this.content[0].scrollLeft,t=Math.ceil(t),e=Math.ceil(e),this._rows.length>1&&(s=i(this._rows,t,e)))return s;for(o=0;o<this._columns.length&&(n=this._columns[o],!(t>=n.offsetLeft&&t<n.offsetLeft+n.clientWidth));o++)n=null;if(n)for(a=0;a<n.slots.length;a++)if(s=n.slots[a],e>=s.offsetTop&&e<=s.offsetTop+s.clientHeight)return s},_slots:function(){var t,e,s,n,i,o,a,r,l,d,h,u,c,f,p,_,m=this.content[0].getElementsByTagName("tr"),g=m[0].children.length,v=[];for(t=0;g>t;t++)v.push({slots:[],events:[]});for(a=0,r="vertical"===this._groupOrientation(),l=".k-scheduler-header-all-day tr",this._isVerticallyGrouped()&&(l=".k-scheduler-header-all-day"),d=this.element.find(l),h=this._isVerticallyGrouped()?d.length:0,u=0;u<m.length;u++)if(c=m[u],c.className&&c.className.indexOf("k-scheduler-header-all-day")>-1)a++;else for(e=c.children,s=0;s<e.length;s++)n=e[s],i=this._rangeByIndex(u-a,s,m.length-1-h),o={offsetTop:n.offsetTop,offsetLeft:n.offsetLeft,clientHeight:n.clientHeight,offsetHeight:n.offsetHeight,clientWidth:n.clientWidth,offsetWidth:n.offsetWidth,element:n,start:i.start,end:i.end},o.index=v[s].slots.length,o.columnIndex=s,o.groupIndex=r?this._groupVerticalIndex(u-a):this._groupHorizontalIndex(s),v[s].slots.push(o),v[s].offsetLeft=o.offsetLeft,v[s].clientWidth=o.clientWidth;if(this._columns=v,f=[],p={slots:[],events:[]},d.length)for(_=0,this._isVerticallyGrouped()&&(_=this._rowCountInGroup()),u=0;u<d.length;u++){for(p={slots:[],events:[]},e=d[u].children,s=0;s<e.length;s++)n=e[s],i=this._rangeByIndex(u,s,d.length),o={offsetTop:d.length>1?n.offsetTop:n.parentNode.parentNode.parentNode.offsetTop,offsetLeft:n.offsetLeft,clientHeight:n.clientHeight,offsetHeight:n.offsetHeight,offsetWidth:n.offsetWidth,clientWidth:n.clientWidth,element:n,isAllDay:!0,start:i.start,end:i.end,index:u,columnIndex:s},o.groupIndex=r?u:this._groupHorizontalIndex(s),p.slots.push(o);f.push(p)}else f.push(p);this._rows=f},options:{name:"MultiDayView",selectedDateFormat:"{0:D}",allDaySlot:!0,title:"",startTime:d.date.today(),endTime:d.date.today(),minorTickCount:2,majorTick:60,majorTimeHeaderTemplate:"#=kendo.toString(date, 't')#",minorTimeHeaderTemplate:"&nbsp;",eventTemplate:I,allDayEventTemplate:k,dateHeaderTemplate:w,editable:!0,messages:{allDay:"all day"}},events:["remove","add","edit"],_templates:function(){var t=this.options,e=_({},d.Template,t.templateSettings);this.eventTemplate=this._eventTmpl(t.eventTemplate,S),this.allDayEventTemplate=this._eventTmpl(t.allDayEventTemplate,x),this.majorTimeHeaderTemplate=d.template(t.majorTimeHeaderTemplate,e),this.minorTimeHeaderTemplate=d.template(t.minorTimeHeaderTemplate,e),this.dateHeaderTemplate=d.template(t.dateHeaderTemplate,e)},_editable:function(){this.options.editable&&(d.support.mobileOS?this._touchEditable():this._mouseEditable())},_mouseEditable:function(){var e=this;e.element.on("click"+T,".k-event a:has(.k-si-close)",function(s){e.trigger("remove",{uid:t(this).closest(".k-event").attr(d.attr("uid"))}),s.preventDefault()}),e.options.editable.create!==!1&&e.element.on("dblclick"+T,".k-scheduler-content td",function(s){var n,i;t(this).parent().hasClass("k-scheduler-header-all-day")||(n=e._slotByPosition(s.pageX,s.pageY),i=e._resourceBySlot(n),e.trigger("add",{eventInfo:_({start:n.start,end:n.end},i)}),s.preventDefault())}).on("dblclick"+T,".k-scheduler-header-all-day td",function(t){var s=e._slotByPosition(t.pageX,t.pageY),n=e._resourceBySlot(s);e.trigger("add",{eventInfo:_({},{isAllDay:!0,start:d.date.getDate(s.start),end:d.date.getDate(s.end)},n)}),t.preventDefault()}),e.options.editable.update!==!1&&e.element.on("dblclick"+T,".k-event",function(s){e.trigger("edit",{uid:t(this).closest(".k-event").attr(d.attr("uid"))}),s.preventDefault()})},_touchEditable:function(){var e=this;e._closeUserEvents=new d.UserEvents(e.element,{filter:".k-event a:has(.k-si-close)",tap:function(s){e.trigger("remove",{uid:t(s.target).closest(".k-event").attr(d.attr("uid"))}),s.preventDefault()}}),e.options.editable.create!==!1&&(e._addUserEvents=new d.UserEvents(e.element,{filter:".k-scheduler-content td",tap:function(s){var n,i;t(s.target).parent().hasClass("k-scheduler-header-all-day")||(n=e._slotByPosition(s.x.location,s.y.location),i=e._resourceBySlot(n),e.trigger("add",{eventInfo:_({start:n.start,end:n.end},i)}),s.preventDefault())}}),e._allDayUserEvents=new d.UserEvents(e.element,{filter:".k-scheduler-header-all-day td",tap:function(t){var s=e._slotByPosition(t.x.location,t.y.location),n=e._resourceBySlot(s);e.trigger("add",{eventInfo:_({},{isAllDay:!0,start:d.date.getDate(s.start),end:d.date.getDate(s.end)},n)}),t.preventDefault()}})),e.options.editable.update!==!1&&(e._editUserEvents=new d.UserEvents(e.element,{filter:".k-event.k-state-selected",tap:function(s){0===t(s.event.target).closest("a:has(.k-si-close)").length&&(e.trigger("edit",{uid:t(s.target).closest(".k-event").attr(d.attr("uid"))}),s.preventDefault())}}))},_layout:function(t){var e,s,n,i=[],o=[],a=this.options,r=this;for(e=0;e<t.length;e++)s={},s.text=r.dateHeaderTemplate({date:t[e]}),d.date.isToday(t[e])&&(s.className="k-today"),i.push(s);return a.allDaySlot&&o.push({text:a.messages.allDay,allDay:!0}),this._forTimeRange(a.startTime,a.endTime,function(t,e,s,n){var i=e?r.majorTimeHeaderTemplate:r.minorTimeHeaderTemplate,a={text:i({date:t}),className:n?"k-slot-cell":""};o.push(a)}),n=this.groupedResources,n.length&&("vertical"===this._groupOrientation()?o=this._createRowsLayout(n,o):i=this._createColumnsLayout(n,i)),{columns:i,rows:o}},_footer:function(){var e='<div class="k-header k-scheduler-footer">&nbsp;';e+="</div>",this.footer=t(e).appendTo(this.element)},_forTimeRange:function(t,s,n,i){var o,a,r,l,d,h,u,c,p,_,m,g,T,I,k,w;for(t=e(t),s=e(s),r=this,l=D(t),d=D(s),h=r.options.minorTickCount,u=r.options.majorTick*v,c=u/h||1,p=new Date(+t),_=p.getDate(),m=0,g="",a=y/c,l!=d&&(l>d&&(d+=y),a=(d-l)/c),a=Math.round(a);a>m;m++)T=m%(u/c),I=0===T,k=h-1>T,w=T===h-1,g+=n(p,I,k,w),f(p,c,!1);return d&&(o=D(p),_<p.getDate()&&(o+=y),o>d&&(p=new Date(+s))),i&&(g+=i(p)),g},_content:function(t){var e,s,n=this,i=n.options,o=i.startTime,a=i.endTime,r=1,l=1,h=t.length,u="",c=this.groupedResources,f="";for(c.length&&("vertical"===n._groupOrientation()?(l=this._rowCountForLevel(this.rowLevels.length-2),i.allDaySlot&&(f='<tr class="k-scheduler-header-all-day">'+Array(t.length+1).join("<td>&nbsp;</td>")+"</tr>")):(r=this._columnCountForLevel(this.columnLevels.length-2),this._isGroupedByDate()&&(r=this._columnCountForLevel(c.length),h=1))),u+="<tbody>",e=function(e,s){var n,i,o,a="";for(a="<tr"+(s?' class="k-middle-row"':"")+">",o=0;r>o;o++)for(n=0,i=h;i>n;n++)a+="<td"+(d.date.isToday(t[n])?' class="k-today"':"")+">",a+="&nbsp;</td>";return a+="</tr>"},s=0;l>s;s++)u+=f,u+=this._forTimeRange(o,a,e);u+="</tbody>",this.content.find("table").append(u)},_render:function(e){var s,n=this;e=e||[],this._dates=e,this._startDate=e[0],this._endDate=e[e.length-1||0],this.createLayout(this._layout(e)),this._content(e),this._footer(),this.refreshLayout(),s=this.element.find(".k-scheduler-header-all-day td"),s.length&&(this._allDayHeaderHeight=s.first()[0].clientHeight),n.datesHeader.on("click"+T,".k-nav-day",function(e){var s=t(e.currentTarget).closest("th");n.trigger("navigate",{view:"day",date:n._slotIndexDate(s.index())})})},startDate:function(){return this._startDate},endDate:function(){return this._endDate},_end:function(t){var e=D(this.options.endTime)||y;return t&&(e=0),new Date(this._endDate.getTime()+e)},nextDate:function(){return d.date.nextDay(this.endDate())},previousDate:function(){return d.date.previousDay(this.startDate())},calculateDateRange:function(){this._render([this.options.date])},destroy:function(){var t=this;t.datesHeader&&t.datesHeader.off(T),t.element&&t.element.off(T),p.fn.destroy.call(this),t.footer&&t.footer.remove(),d.support.mobileOS&&(t._closeUserEvents.destroy(),t.options.editable.create!==!1&&(t._addUserEvents.destroy(),t._allDayUserEvents.destroy()),t.options.editable.update!==!1&&t._editUserEvents.destroy())},selectionByElement:function(t){var e=t.offset();return this._slotByPosition(e.left,e.top)},_slotIndexTime:function(t){return t=this._adjustSlotIndex(t),D(this.options.startTime)+this._timeSlotInterval()*t},_timeSlotInterval:function(){var t=this.options;return t.majorTick/t.minorTickCount*v},_rangeByIndex:function(t,e,s){var n=d.date.getDate(this._slotIndexDate(e)),i=d.date.getDate(n);return f(n,this._slotIndexTime(t)),s=this._adjustSlotIndex(s),this._adjustSlotIndex(t)>=s?(f(i,D(this.options.endTime)),d.date.getDate(i).getTime()===i.getTime()&&(i=d.date.nextDay(i))):f(i,this._slotIndexTime(t+1)),{start:n,end:i}},_slotIndexDate:function(t){var e,s,n,i,o,a=this._dates||[],r=D(new Date(+this.options.startTime)),l=D(new Date(+this.options.endTime));for(r>=l&&(l+=y),i=this.groupedResources,o="vertical"===this._groupOrientation(),i.length&&!o&&(t=this._adjustColumnIndex(t)),e=0,s=a.length;s>e;e++)if(n=new Date(+a[e]),f(n,r),t===e)return n;return null},_adjustSlotIndex:function(t){if(this._isVerticallyGrouped()){var e=this._rowCountInGroup();return t-e*Math.floor(t/e)}return t},_groupHorizontalIndex:function(t){return this.groupedResources.length?Math.floor(t/this._columnCountInGroup()):0},_groupVerticalIndex:function(t){return this.groupedResources.length?Math.floor(t/this._rowCountInGroup()):0},_adjustColumnIndex:function(t){var e=this._columnCountInGroup();return this._isGroupedByDate()?Math.floor(t/e):t-e*Math.floor(t/e)},_columnCountInGroup:function(){var t=this.groupedResources;return t.length?this._isGroupedByDate()?this._columnCountForLevel(t.length)/this._columnCountForLevel(0):this._columnOffsetForResource(t.length):0},_rowCountInGroup:function(){var t,e=this.groupedResources;return e.length?(t=this.options.allDaySlot?this._rowCountForLevel(e.length-1):0,(this._rowCountForLevel(e.length)-t)/this._rowCountForLevel(e.length-1)):0},_timeSlotIndex:function(t){var e=this.options,s=D(t),n=D(e.startTime),i=e.majorTick/e.minorTickCount*v;return(s-n)/i},_dateSlotIndex:function(t,e){var n,i,o,a,r=this._dates||[],l=1;for(this._isGroupedByDate()&&(l=this._columnCountInGroup()),n=0,i=r.length;i>n;n++)if(o=d.date.getDate(r[n]),a=new Date(d.date.getDate(r[n]).getTime()+y-(e?0:1)),s(t,o,a))return n*l;return-1},_calculateAllDayEventWidth:function(t,e,s){var n,i,o=0,a=e!==s?"offsetWidth":"clientWidth";for(n=0,i=t.length;i>n;n++)n>=e&&s>=n&&(o+=t[n][a]);return o},_calculateEventHeight:function(t,e,s){var n,i,o=0;for(e===s&&(s+=1),n=0,i=t.length;i>n;n++)n>=e&&s>n&&(o+=t[n].offsetHeight);return o},_positionAllDayEvent:function(e,s,n,i){var o,a,r,l,d,h,u,c=e.slots[n],f=this._calculateAllDayEventWidth(e.slots,n,i),_=p.collidingHorizontallyEvents(e.events,n,i),m=this._headerColumnCount||0,g=2,v=n!==i?5:4,y=this._allDayHeaderHeight;for(s.css({left:c.offsetLeft+g,width:f-v}),e.events.push({start:n,end:i,element:s}),_.push({start:n,end:i,element:s}),o=p.createRows(_),o.length&&o.length>m&&(this._updateAllDayHeaderHeight(y*o.length+y),this._headerColumnCount=o.length),a=c.offsetTop,r=0,l=o.length;l>r;r++)for(d=o[r].events,h=0,u=d.length;u>h;h++)t(d[h].element).css({top:a+r*y})},_arrangeColumns:function(e,s,n){var i,o,a,r,l,d,h,u=n.clientWidth,c=.1*u,f=n.events,_=p.collidingEvents(f,e.start,e.end);for(n.events.push(e),_.push(e),i=p.createColumns(_),a=(u-c)/i.length,r=0,l=i.length;l>r;r++)for(o=i[r].events,d=0,h=o.length;h>d;d++)t(o[d].element).css({width:a-4,left:n.offsetLeft+r*a+2})},_positionEvent:function(t,e,s,n){var i,o=this._columns[s],a=this._isVerticallyGrouped()?this._rowCountInGroup():o.slots.length,r=Math.floor(this._timeSlotIndex(t.startTime||t.start))+n,l=Math.ceil(this._timeSlotIndex(t.endTime||t.end)),d=4;(r>0||0>r)&&0>=l&&(l=a),0>r&&(r=0),l>a&&(l=a),l+=n,i=o.slots[Math.floor(r)],e.css({height:this._calculateEventHeight(o.slots,r,l)-d,top:i.offsetTop}),this._arrangeColumns({element:e,start:r,end:l},s,o)},_eventTmpl:function(t,e){var s,n=this.options,i=_({},d.Template,n.templateSettings),o=i.paramName,a="",r=typeof t,l={storage:{},count:0};return"function"===r?(l.storage["tmpl"+l.count]=t,a+="#=this.tmpl"+l.count+"("+o+")#",l.count++):"string"===r&&(a+=t),s=d.template(d.format(e,a),i),l.count>0&&(s=m(s,l.storage)),s},_createEventElement:function(e,n,i,o){var a,r,l=n?this.eventTemplate:this.allDayEventTemplate,h=this.options,u=h.editable,c=u&&u.destroy!==!1,f=u&&u.resize!==!1,p=g(this.startDate()),m=g(this.endDate()),v=D(h.startTime),T=D(h.endTime),I=D(e.startTime||e.start),k=D(e.endTime||e.end);return v>=T&&(T=D(new Date(h.endTime.getTime()+y-1))),n||e.isAllDay||(m=new Date(m.getTime()+y)),r=e.end,e.isAllDay&&(r=g(e.end)),!s(g(e.start),p,m)&&!s(r,p,m)||n&&v>I&&k>T?a=!0:g(e.start)<p||n&&v>I?o=!0:(r>m&&!n||n&&k>T)&&(i=!0),t(l(_({},{ns:d.ns,resizable:f,showDelete:c,middle:a,head:i,tail:o,singleDay:1==this._dates.length||this._isGroupedByDate(),resources:this.eventResources(e)},e,{start:e.startTime||e.start,end:e.endTime||e.end})))},_isInTimeSlot:function(t){var e=this.options.startTime,s=this.options.endTime,i=t.startTime||t.start,o=t.endTime||t.end;return D(s)===D(d.date.getDate(s))&&(s=d.date.getDate(s),f(s,y-1)),D(o)===D(d.date.getDate(o))&&o.getTime()>i.getTime()&&(o=d.date.getDate(o),f(o,y-1)),o=D(o),i=D(i),s=D(s),e=D(e),e===i&&i===o?!0:n(i,e,s)||n(o,e,s)||n(e,i,o)||n(s,i,o)},_isInDateSlot:function(t){var e=this.startDate(),n=new Date(this.endDate().getTime()+y-1);return s(t.start,e,n)||s(t.end,e,n)||s(e,t.start,t.end)||s(n,t.start,t.end)},_updateAllDayHeaderHeight:function(t){var e,s,n,i,o,a=this.element.find(".k-scheduler-header-all-day td");if(a.length){for(e=t-a[0].clientHeight,a.parent().add(this.element.find(".k-scheduler-times-all-day").parent()).height(t),s=0,o=0;o<this._rows.length;o++)for(n=this._rows[o].slots,i=0;i<n.length;i++)n[i].clientHeight=a[s++].clientHeight;this._updateSlotsPosition(e)}},_updateSlotsPosition:function(t){var e,s,n,i,o,a,r,l,d;if(t&&this._isVerticallyGrouped()){for(a=this._rowCountInGroup(),r=0;r<this._columns.length;r++){for(e=this._columns[r].slots,s=this._columns[r].events,n=0;n<e.length;n++)e[n].offsetTop=e[n].offsetTop+t*Math.ceil(n/a||1);for(i=0;i<s.length;i++)o=s[i],o.element.css("top",o.element[0].offsetTop+t*Math.ceil(o.start/a||1))}for(l=0;l<this._rows.length;l++){for(s=this._rows[l].events,e=this._rows[l].slots,n=0;n<e.length;n++)e[n].offsetTop=e[n].offsetTop+t*l;for(i=0;i<s.length;i++)o=s[i],d=o.element[0].offsetTop,d&&o.element.css("top",d+t*l)}}},_renderEvents:function(t,e,s){var n,i,o,a,r,l,h,u,c,f,p,m,g,v,T=this.datesHeader.find(".k-scheduler-header-wrap"),I=0,k=0,w="vertical"===this._groupOrientation();for(this.groupedResources.length&&(w?(I=e,T=this.content):k=e),i=0,o=t.length;o>i;i++)if(n=t[i],this._isInDateSlot(n))if(a=this._dateSlotIndex(n.start),r=this._dateSlotIndex(n.end,!n.isAllDay),l=n.isAllDay||n.end.getTime()-n.start.getTime()>=y,h=l?T:this.content,l)this.options.allDaySlot&&(0>a&&(a=0),0>r&&(r=(this.groupedResources.length&&!w?this._columnCountInGroup():this._rows[0].slots.length)-1),u=this._createEventElement(n,!l),this._positionAllDayEvent(this._rows[s],u,a+k,r+k),u.appendTo(h));else if(this._isInTimeSlot(n))for(-1===a&&r>-1&&(a=r),c=a;r>=c;c++)f=n.start,p=n.end,m=!1,g=!1,c>a&&(f=d.date.getDate(p),d.date.setTime(f,D(this.options.startTime)),f>p&&(f=d.date.addDays(f,-1)),g=!0),r>c&&(p=d.date.getDate(f),d.date.setTime(p,D(this.options.endTime)),f>p&&(p=d.date.addDays(p,1)),m=!0),v=_({},n,{start:f,end:p}),this._isInTimeSlot(v)&&(u=this._createEventElement(n,!l,m,g),this._positionEvent(v,u,c+k,I),u.appendTo(h))},render:function(t){var e,s;this._headerColumnCount=0,this._slots(),this.element.find(".k-event").remove(),this._updateAllDayHeaderHeight(this._allDayHeaderHeight),t=new d.data.Query(t).sort([{field:"start",dir:"asc"},{field:"end",dir:"desc"}]).toArray(),e=this.groupedResources,e.length?(s=1,this._isGroupedByDate()&&(this._isVerticallyGrouped()||(this.columnLevels.push(Array(this._columnCountForLevel(this.columnLevels.length-1))),s=2)),this._renderGroups(t,e,0,s)):this._renderEvents(t,0,0),this.refreshLayout(),this.trigger("activate")},_resourceBySlot:function(t){var e,s,n,i,o,a,l,h,u,c,f=this.groupedResources,p={},_=this._isVerticallyGrouped();if(f.length)for(e=_?t.index:t.columnIndex,t.isAllDay&&_&&(e*=this._rowCountInGroup()),s=0,this._isGroupedByDate()&&(s=1,e-=Math.floor(e/this._columnCountInGroup())*this._columnCountInGroup()),n=0,i=f.length;i>n;n++)o=f[n],_?(l=this.options.allDaySlot?this._rowCountForLevel(f.length-1):0,a=(this._rowCountForLevel(f.length)-l)/this._rowCountForLevel(n)):a=this._columnCountForLevel(f.length)/this._columnCountForLevel(n+s),h=Math.floor(e/a),e-=h*a,u=r(o,o.dataSource.at(h)),o.multiple&&(u=[u]),c=d.setter(o.field),c(p,u);return p},_renderGroups:function(t,e,s,n){var i,o,a,l,h,u,c=e[0],f="vertical"===this._groupOrientation();if(f?(o=1===e.length&&this.options.allDaySlot?this._rowCountForLevel(n-1):0,i=(this._rowCountForLevel(n)-o)/this._rowCountForLevel(n-1)):i=this._columnOffsetForResource(n),c)for(a=c.dataSource.view(),l=0;l<a.length;l++)h=r(c,a[l]),u=new d.data.Query(t).filter({field:c.field,operator:p.groupEqFilter,value:h}).toArray(),e.length>1?this._renderGroups(u,e.slice(1),i*l,n+1):this._renderEvents(this._splitAllDayEvents(u),i*(l+s),f?l+s:0)},_splitAllDayEvents:function(t){var e,s,n,i,o,a,r,l;if(this._isGroupedByDate()){for(e=[],s=0;s<t.length;s++)if(n=t[s],i=d.date.getDate(n.start),o=n.end,a=Math.ceil((o-i)/d.date.MS_PER_DAY),1===a&&d.date.getDate(o).getTime()!==d.date.getDate(i).getTime()&&(a+=1),r=_({},n),e.push(r),a>1)for(r.end=d.date.getDate(i),r.isAllDay=!0,l=1;a>l;l++)i=d.date.getDate(d.date.nextDay(r.end)),r=_({},n),r.start=i,r.isAllDay=!0,r.end=d.date.getDate(i),e.push(r);return e}return t},_columnOffsetForResource:function(t){return this._columnCountForLevel(t)/this._columnCountForLevel(t-1)},_columnCountForLevel:function(t){var e=this.columnLevels[t];return e?e.length:0},_rowCountForLevel:function(t){var e=this.rowLevels[t];return e?e.length:0},_selectionOffset:function(){return this._dates.length},normalizeSelection:function(t){var e,s=this._columns,n=this._dateSlotIndex(t.start),i=this._timeSlotIndex(t.start);(0>n||n>=s.length)&&(n=0),e=this._columns[n].slots,0>i?i=0:i>e.length-1&&(i=e.length-1),e=this._columns[n].slots[i],t.start=new Date(e.start),t.end=new Date(e.end)},isInRange:function(t){return this._slotByDate(t)},moveSelectionToPeriod:function(t){var e=this._selectionOffset(),s=t.start,n=t.end;this._dateSlotIndex(s)<0||this._dateSlotIndex(n)<0?(s>=this.endDate()&&(e=-e),t.start=c(s,e),t.end=c(n,e),t.events=[]):this.normalizeSelection(t)},clearSelection:function(){this.content.add(this.datesHeader).find(".k-state-selected").removeClass("k-state-selected")},select:function(t){if(t){if(this.clearSelection(),t.events[0]&&this._selectEvents(t))return;this._selectCells(t)}},_selectEvents:function(t){for(var e,s=this.content.add(this.datesHeader.children()),n=t.events,i=n.length,o=0;i>o;o++)if(e=s.children("[data-uid="+n[o]+"]").addClass("k-state-selected"),e=e[e.length-1],!e)return this.clearSelection(),undefined;return e?(this._scrollTo(e,this.content[0]),!0):undefined},_selectCells:function(t){var e,s,n,i,o,r,l,d,h,u,c,f,p,_,m,g,v,T,I=t.start,k=t.end,w=I>k;if(w&&(I=new Date(k),k=new Date(t.start)),o=this,r=this.groupedResources,l=o._columns,d=Math.floor(o._timeSlotIndex(I)),h=Math.ceil(o._timeSlotIndex(k)),u=o._dateSlotIndex(I),c=o._dateSlotIndex(k),f=D(this.options.endTime),p=D(k),_=this._isVerticallyGrouped(),m=0,g=0,0>u&&(u=0),0>c&&(c=f===D(k)?this._columnCountInGroup()||this._columns.length:u),0>d&&(d=0),(0>h||u===c&&d>h)&&(h=d),v=Math.abs(D(this.options.endTime)-D(this.options.startTime)||y),w&&Math.abs(k-I)>v&&(h+=1),_?(g=this._rowCountInGroup()||0,g=t.groupIndex*g,d+=g,h+=g):(m=this._columnOffsetForResource(r.length),m=t.groupIndex*m||0,u+=m,c+=m),t.isAllDay)for(T=_?t.groupIndex:0,e=o._rows[T].slots;c>=u;u++)e[u].groupIndex===t.groupIndex&&(i=e[u].element,a(i));else for(0===p&&p===f&&u!==c&&(c-=1,h=this._rowCountInGroup()+this._rowCountInGroup()*t.groupIndex||l[c].slots.length),s=h;c>=u;u++){for(u===c?s=h:c>u&&(s=this._rowCountInGroup()+this._rowCountInGroup()*t.groupIndex||l[c].slots.length),e=l[u].slots,d!==s&&(s-=1);s>=d;d++)i=e[d].element,a(i),n||(n=i);d=0+g}i=w?n:i,i&&o._scrollTo(i,o.content[0])},move:function(t,e,s){var n,i,o=this.groupedResources,a=this._timeSlotInterval(),r=new Date(t.start),l=new Date(t.end),d=Math.abs(r-l)>a,h=this._columnCountInGroup(),p=t.isAllDay,_=!1;if(e===u.DOWN){if(_=!0,p){if(s)return t.events=[],_;t.isAllDay=!1,n=this._firstSlot(r),r=n.start,l=n.end}else s||(d?l>r?r=new Date(l):l=new Date(r+a):f(r,a)),f(l,a),r.getTime()===l.getTime()&&(s?(f(r,-a),f(l,a)):f(l,a));this._slotByDate(new Date(l-a))&&this._slotByDate(r)||(i=t.groupIndex+1<Math.floor(this._rowCountForLevel(o.length)/this._rowCountInGroup()),o.length&&this._isVerticallyGrouped()&&i?(t.isAllDay=!0,t.groupIndex+=1,n=this._firstSlot(t.start),l=r=n.start):(r=t.start,l=t.end))}else if(e===u.UP){if(_=!0,s||(d&&(r>l&&(r=new Date(l)),l=new Date(r)),f(r,-a)),f(l,-a),r.getTime()===l.getTime()&&(s?(f(r,a),f(l,-a)):f(l,a)),s&&!this._slotByDate(r>l?l:r))return t.events=[],_;s||(this._isVerticallyGrouped()&&t.isAllDay&&t.groupIndex-1>-1?(t.groupIndex-=1,t.isAllDay=!1,n=this._lastSlot(t.start),r=n.start,l=n.end):!this._slotByDate(r)&&this.options.allDaySlot&&(t.isAllDay=!0,n=this._firstSlot(t.start),l=r=n.start))}else e===u.RIGHT?(_=!0,s||(r=c(r,1)),l=c(l,1),s&&!d&&(l.setHours(r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds()),f(l,a)),r>this._end(p)&&o.length&&!this._isVerticallyGrouped()&&(t.groupIndex+=1,this._columnCountForLevel(o.length)>t.groupIndex*h?(r=c(r,-h),l=c(l,-h)):t.groupIndex=0)):e===u.LEFT&&(_=!0,s||(r=c(r,-1)),l=c(l,-1),s&&!d&&l.setHours(r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds()),r<this.startDate()&&o.length&&!this._isVerticallyGrouped()&&(t.groupIndex-=1,t.groupIndex>-1?(r=c(r,h),l=c(l,h)):t.groupIndex=this._columnCountForLevel(o.length)/h-1));return _&&(t.events=[],t.start=r,t.end=l),_},_firstSlot:function(t){return this._columns[this._dateSlotIndex(t)].slots[0]},_lastSlot:function(t){var e=this._columns[this._dateSlotIndex(t)].slots;return e[e.length-1]},_slotByDate:function(t){var e,s=this._columns[this._dateSlotIndex(t)];return s&&(e=s.slots[this._timeSlotIndex(t)],e&&e.start.getTime()===t.getTime())?e:null},_slotByAllDay:function(t){var e=this._rows[0].slots[this._dateSlotIndex(t)];return e||null},_getAllDayEvents:function(t,e){var s,n,i,o,a=this._rows[0],r=a.events;for(i=l(r,e),o=r.length;o>i;i++)if(n=r[i],n.start===t){s=n;break}return s},moveToEvent:function(t,e){var s,n,i,a,r,h,u=t.events.length,c=this._columns.length,f=function(e){return e.start<t.end},p=function(e){return d.date.getDate(e.start).getTime()===d.date.getDate(t.start).getTime()},_=function(e){return e.start>=t.start},m=function(e){return e.start>=t.start};if(h=t.isAllDay?this._slotByAllDay(t.start):this._slotByDate(t.start),s=h.columnIndex,e)for(;s>=0;s--){if(n=this._columns[s],i=o(n.slots,n.events,f),i[0]&&(r=-1,u?(r=l(i,t.events,e),u=0):r=i.length-1,a=i[r]))return t.start=n.slots[a.start].start,t.end=n.slots[a.end-1].end,t.events=[a.element.data("uid")],!0;if(i=o(this._rows[0].slots,this._rows[0].events,p),i[0]&&(r=-1,u?(r=l(i,t.events,e),u=0):r=i.length-1,a=i[r]))return t.start=this._rows[0].slots[a.start].start,t.end=this._rows[0].slots[a.end].end,t.events=[a.element.data("uid")],t.isAllDay=!0,!0}else for(;c>s;s++)if(n=this._columns[s],i=o(n.slots,n.events,_),i[0]){if(r=u?l(i,t.events):0,a=i[r])return t.start=n.slots[a.start].start,t.end=n.slots[a.end-1].end,t.events=[a.element.data("uid")],!0}else if(i=o(this._rows[0].slots,this._rows[0].events,m),i[0]&&(r=u?l(i,t.events):0,a=i[r]))return t.start=this._rows[0].slots[a.start].start,t.end=this._rows[0].slots[a.end].end,t.events=[a.element.data("uid")],t.isAllDay=!0,!0}}),H=/\s*k-state-selected/;_(!0,h,{MultiDayView:C,DayView:C.extend({options:{title:"Day"},name:"day"}),WeekView:C.extend({options:{title:"Week",selectedDateFormat:"{0:D} - {1:D}"},name:"week",calculateDateRange:function(){var t,e,s=this.options.date,n=d.date.dayOfWeek(s,0,-1),i=[];for(t=0,e=7;e>t;t++)i.push(n),n=d.date.nextDay(n);this._render(i)}})})}(window.kendo.jQuery)});