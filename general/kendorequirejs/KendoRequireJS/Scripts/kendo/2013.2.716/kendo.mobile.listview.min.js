/*
* Kendo UI Complete v2013.2.716 (http://kendoui.com)
* Copyright 2013 Telerik AD. All rights reserved.
*
* Kendo UI Complete commercial licenses may be obtained at
* https://www.kendoui.com/purchase/license-agreement/kendo-ui-complete-commercial.aspx
* If you do not own a commercial license, this file shall be governed by the trial license terms.
*/


("function"==typeof define&&define.amd?define:function(t,e){return e()})(["./kendo.data.min","./kendo.mobile.application.min","./kendo.userevents.min"],function(){!function(t){function e(){return this.nodeType===g.TEXT_NODE&&this.nodeValue.match(P)}function i(t,e){e&&!t[0].querySelector(".km-icon")&&t.prepend('<span class="km-icon km-'+e+'"/>')}function s(t){i(t,x(t,"icon")),i(t,x(t.children(T),"icon"))}function n(t){var s=t.parent(),n=t.add(s.children(m.roleSelector("detailbutton"))),o=s.contents().not(n).not(e);o.length||(t.addClass("km-listview-link").attr(m.attr("role"),"listview-link"),i(t,x(s,"icon")),i(t,x(t,"icon")))}function o(t){if(t[0].querySelector("input[type=checkbox],input[type=radio]")){var e=t.parent();e.contents().not(t).not(function(){return 3==this.nodeType})[0]||t.addClass("km-listview-label")}}function r(e,i){t(e).css("transform","translate3d(0px, "+i+"px, 0px)")}var a,l,h,d,c,f,u,p,m=window.kendo,g=window.Node,b=m.mobile,v=b.ui,_=m.data.DataSource,w=v.Widget,k=".km-list > li, > li:not(.km-group-container)",y=".km-listview-link, .km-listview-label",T="["+m.attr("icon")+"]",S=t.proxy,x=m.attrValue,C="km-group-title",H="km-state-active",B='<div class="'+C+'"><div class="km-text"></div></div>',I=m.template('<li><div class="'+C+'"><div class="km-text">#= this.headerTemplate(data) #</div></div><ul>#= kendo.render(this.template, data.items)#</ul></li>'),D='<div class="km-listview-wrapper" />',R=m.template('<form class="km-filter-form"><div class="km-filter-wrap"><input type="search" placeholder="#=placeholder#"/><a href="\\#" class="km-filter-reset" title="Clear"><span class="km-icon km-clear"></span><span class="km-text">Clear</span></a></div></form>'),F=".kendoMobileListView",V="styled",z="dataBound",L="click",O="change",M="progress",E="function",P=/^\s+$/,U=/button/,G=m.Class.extend({init:function(t){var e,i,s=t.scroller();s&&(this.options=t.options,this.element=t.element,this.scroller=t.scroller(),this._shouldFixHeaders(),e=this,i=function(){e._cacheHeaders()},m.onResize(i),t.bind(V,i),t.bind(z,i),s.bind("scroll",function(t){e._fixHeader(t)}))},_fixHeader:function(e){if(this.fixedHeaders){var i,s,n,o=0,r=this.scroller,a=this.headers,l=e.scrollTop;do{if(i=a[o++],!i){n=t("<div />");break}s=i.offset,n=i.header}while(s>l);this.currentHeader!=o&&(r.fixedContainer.html(n.clone()),this.currentHeader=o)}},_shouldFixHeaders:function(){this.fixedHeaders="group"===this.options.type&&this.options.fixedHeaders},_cacheHeaders:function(){if(this._shouldFixHeaders(),this.fixedHeaders){var e=[],i=this.scroller.scrollTop;this.element.find("."+C).each(function(s,n){n=t(n),e.unshift({offset:n.position().top+i,header:n})}),this.headers=e,this._fixHeader({scrollTop:i})}}}),j=function(){return{page:1}},W=m.Class.extend({init:function(t){var e,i=t.scroller(),s=t.options,n=t.dataSource,o=s.pullParameters||j;this._first=n.view()[0],this.scroller=i,this.dataSource=n,e=this,i.setOptions({pullToRefresh:!0,pull:function(){e._pulled=!0,n.read(o.call(t,e._first))},pullTemplate:s.pullTemplate,releaseTemplate:s.releaseTemplate,refreshTemplate:s.refreshTemplate}),n.bind("change",function(){e._change()})},_change:function(){var t,e=this.scroller,i=this.dataSource;this._pulled&&e.pullHandled(),(this._pulled||!this._first)&&(t=i.view(),t[0]&&(this._first=t[0])),this._pulled=!1}}),q=m.Observable.extend({init:function(t){var e=this;m.Observable.fn.init.call(e),e.buffer=t.buffer,e.height=t.height,e.item=t.item,e.items=[],e.footer=t.footer,e.buffer.bind("reset",function(){e.refresh()}),e.bind("resize",function(){e.footer&&e.footer.below(e.items[e.items.length-1])})},refresh:function(){for(var t,e,i,s,n=this.buffer,o=this.items;o.length;)o.pop().destroy();for(this.bottom=0,this.offset=n.offset,this.top=0,i=this.item,s=0;s<n.viewSize;s++){if(s===n.total()){this.trigger("endReached");break}e=i(this.content(this.offset+o.length)),e.below(t),t=e,o.push(e),this.bottom=e.bottom}this.itemCount=o.length,this.trigger("reset"),this.trigger("resize",{top:this.top,bottom:this.bottom})},totalHeight:function(){var t=this,e=(t.bottom-t.top)/t.itemCount,i=t.buffer.length-t.offset-t.itemCount;return(this.footer?this.footer.height:0)+this.bottom+i*e},batchUpdate:function(t){var e,i=this.height(),s=this.offset;if(this.lastDirection)for(;this.bottom>t+2*i&&0!==this.offset;)this.reOrder(!0);else for(;this.top<t-i;){if(e=this.offset+this.itemCount,e===this.buffer.total()){this.trigger("endReached");break}if(e===this.buffer.length)break;this.reOrder(!1)}s!==this.offset&&this.trigger("resize",{top:this.top,bottom:this.bottom})},reOrder:function(t){var e,i=this.items;t?(this.offset--,e=i.pop(),e.update(this.content(this.offset)),e.above(i[0]),i.unshift(e)):(e=i.shift(),e.update(this.content(this.offset+this.itemCount)),e.below(i[i.length-1]),i.push(e),this.offset++),this.top=i[0].top,this.bottom=i[i.length-1].bottom},update:function(t){var e,i,s,n,o=this,r=this.items,a=this.height(),l=this.itemCount,h=a/2,d=(this.lastTop||0)>t,c=t-h,f=t+a+h;this.lastTop=t,this.lastDirection=d,d?this.top>c&&this.bottom>f+h&&this.offset>0&&(this.offset--,e=r.pop(),i=r[0],e.update(this.content(this.offset)),r.unshift(e),m.effects.animationFrame(function(){e.above(i),o.top=r[0].top,o.bottom=r[r.length-1].bottom,o.trigger("resize",{top:o.top,bottom:o.bottom})})):this.bottom<f&&this.top<c-h&&(n=this.offset+l,n===this.buffer.total()?this.trigger("endReached"):n!==this.buffer.length&&(e=r.shift(),s=r[r.length-1],r.push(e),e.update(this.content(this.offset+this.itemCount)),o.offset++,m.effects.animationFrame(function(){e.below(s),o.top=r[0].top,o.bottom=r[r.length-1].bottom,o.trigger("resize",{top:o.top,bottom:o.bottom})})))},content:function(t){return this.buffer.at(t)}});m.mobile.ui.VirtualList=q,a=m.Class.extend({init:function(e,i){var s=e.append([i])[0],n=s.offsetHeight;t.extend(this,{top:0,element:s,listView:e,height:n,bottom:n})},update:function(t){this.element=this.listView.setDataItem(this.element,t)},above:function(t){t&&(this.height=this.element.offsetHeight,this.top=t.top-this.height,this.bottom=t.top,r(this.element,this.top))},below:function(t){t&&(this.height=this.element.offsetHeight,this.top=t.bottom,this.bottom=this.top+this.height,r(this.element,this.top))},destroy:function(){m.destroy(this.element),t(this.element).remove()}}),l='<div><span class="km-icon"></span><span class="km-loading-left"></span><span class="km-loading-right"></span></div>',h=m.Class.extend({init:function(e){this.element=t('<li class="km-load-more km-scroller-refresh" style="display: none"></li>').appendTo(e.element),this._loadIcon=t(l).appendTo(this.element)},enable:function(){this.element.show(),this.height=this.element.outerHeight(!0)},disable:function(){this.element.hide(),this.height=this.element.outerHeight(!0)},below:function(t){t&&(this.top=t.bottom,this.bottom=this.height+this.top,r(this.element,this.top))}}),d=h.extend({init:function(e,i){this._loadIcon=t(l).hide(),this._loadButton=t('<a class="km-load">'+e.options.loadMoreText+"</a>").hide(),this.element=t('<li class="km-load-more" style="display: none"></li>').append(this._loadIcon).append(this._loadButton).appendTo(e.element);var s=this;this._loadButton.kendoMobileButton().data("kendoMobileButton").bind("click",function(){s._hideShowButton(),i.next()}),i.bind("resize",function(){s._showLoadButton()}),this.height=this.element.outerHeight(!0),this.disable()},_hideShowButton:function(){this._loadButton.hide(),this.element.addClass("km-scroller-refresh"),this._loadIcon.css("display","block")},_showLoadButton:function(){this._loadButton.show(),this.element.removeClass("km-scroller-refresh"),this._loadIcon.hide()}}),c=m.Class.extend({init:function(t){this.listView=t,this.options=t.options,this.configure()},destroy:function(){this.list.unbind(),this.buffer.unbind(),m.unbindResize(this._resizeHandler)},configure:function(){var e,i,s,n,o=this.options,r=this.listView,l=r.scroller(),c=o.loadMore;this.dataSource&&this._unbindDataSource(),i=this.listView.dataSource=_.create(o.dataSource),s=new m.data.Buffer(i,Math.floor(i.pageSize()/2),c),e=c?new d(r,s):new h(r),n=new q({buffer:s,footer:e,item:function(t){return new a(r,t)},height:function(){return l.height()}}),l&&(l.makeVirtual(),l.bind("scroll",function(t){n.update(t.scrollTop)}),l.bind("scrollEnd",function(t){n.batchUpdate(t.scrollTop)}),n.bind("resize",function(){m.effects.animationFrame(function(){l.virtualSize(0,n.totalHeight())})}),n.bind("reset",function(){e.enable()}),n.bind("endReached",function(){e.disable()}),this._resizeHandler=m.onResize(function(){l.reset(),r.element.is(":visible")?(s.range(0),n.refresh()):n._needsRefresh=!0}),r.view().bind("show",function(){n._needsRefresh&&(setTimeout(function(){n.refresh()}),n._needsRefresh=!1)}),s.bind("expand",function(){n.lastDirection=!1,n.batchUpdate(l.scrollTop)})),t.extend(this,{buffer:s,list:n,footer:e})},refresh:function(){this.list.refresh()},_unbindDataSource:function(){}}),f=m.Class.extend({init:function(t){this.listView=t,this.options=t.options;var e=this;this._refreshHandler=function(t){e.refresh(t)},this._progressHandler=function(){t.showLoading()},this.configure()},destroy:function(){},refresh:function(t){var e=t&&t.action,i=t&&t.items,s=this.listView,n=this.dataSource,o=this.options.appendOnRefresh,r=n.view(),a=n.group(),l=a&&a[0];s.trigger("dataBinding"),"itemchange"===e?s.setDataItem(s.findByDataItem(i)[0],i[0]):"add"!==e||l?"remove"!==e||l?l?s.replaceGrouped(r):o&&!s._filter?s.prepend(r):s.replace(r):s.remove(i):s.append(i),this._shouldShowLoading()&&s.hideLoading(),s.trigger(z,{ns:v})},configure:function(){var t=this.options;this.dataSource&&this._unbindDataSource(),this.listView.dataSource=this.dataSource=_.create(t.dataSource).bind(O,this._refreshHandler),this._shouldShowLoading()&&this.dataSource.bind(M,this._progressHandler)},_unbindDataSource:function(){this.dataSource.unbind(O,this._refreshHandler).unbind(M,this._progressHandler)},_shouldShowLoading:function(){var t=this.options;return!t.pullToRefresh&&!t.loadMore&&!t.endlessScroll}}),u=m.Class.extend({init:function(t){var e=this,i=t.options.filterable,s="change paste";this.listView=t,this.options=i,t.element.before(R({placeholder:i.placeholder||"Search..."})),i.autoFilter!==!1&&(s+=" keyup"),this.searchInput=t.wrapper.find("input[type=search]").closest("form").on("submit"+F,function(t){t.preventDefault()}).end().on("focus"+F,function(){e._oldFilter=e.searchInput.val()}).on(s.split(" ").join(F+" ")+F,S(this._filterChange,this)),this.clearButton=t.wrapper.find(".km-filter-reset").on(L,S(this,"_clearFilter")).hide()},_search:function(t){this._filter=!0,this.clearButton[t?"show":"hide"](),this.listView.dataSource.filter(t)},_filterChange:function(t){var e=this;"paste"==t.type&&this.options.autoFilter!==!1?setTimeout(function(){e._applyFilter()},1):this._applyFilter()},_applyFilter:function(){var t=this.options,e=this.searchInput.val(),i=e.length?{field:t.field,operator:t.operator||"startsWith",ignoreCase:t.ignoreCase,value:e}:null;e!==this._oldFilter&&(this._oldFilter=e,this._search(i))},_clearFilter:function(t){this.searchInput.val(""),this._search(null),t.preventDefault()}}),p=w.extend({init:function(t,e){var i=this;w.fn.init.call(this,t,e),t=this.element,e=this.options,e.scrollTreshold&&(e.scrollThreshold=e.scrollTreshold),t.on("down",y,"_highlight").on("move up cancel",y,"_dim"),this._userEvents=new m.UserEvents(t,{filter:k,allowSelection:!0,tap:function(t){i._click(t)}}),t.css("-ms-touch-action","auto"),t.wrap(D),this.wrapper=this.element.parent(),this._headerFixer=new G(this),this._itemsCache={},this._templates(),this.virtual=e.endlessScroll||e.loadMore,this._style(),this._itemBinder=this.virtual?new c(this):new f(this),e.dataSource&&e.autoBind&&this.dataSource.fetch(),this.options.pullToRefresh&&(this._pullToRefreshHandler=new W(this)),this.options.filterable&&(this._filter=new u(this)),this._enhanceItems(this.items()),m.notify(this,v)},events:[L,z],options:{name:"ListView",style:"",type:"flat",autoBind:!0,fixedHeaders:!1,template:"#:data#",headerTemplate:'<span class="km-text">#:value#</span>',appendOnRefresh:!1,loadMore:!1,loadMoreText:"Press to load more",endlessScroll:!1,scrollThreshold:30,pullToRefresh:!1,pullTemplate:"Pull to refresh",releaseTemplate:"Release to refresh",refreshTemplate:"Refreshing",pullOffset:140,filterable:!1},refresh:function(){this._itemBinder.refresh()},setOptions:function(t){w.fn.setOptions.call(this,t)},setDataSource:function(t){this.options.dataSource=t,this._itemBinder.configure(),this.options.autoBind&&(this.element.empty(),this.dataSource.fetch())},destroy:function(){w.fn.destroy.call(this),m.destroy(this.element),this._userEvents.destroy(),this._itemBinder&&this._itemBinder.destroy(),delete this.element,delete this.wrapper,delete this._userEvents},items:function(){return"group"===this.options.type?this.element.find(".km-list").children():this.element.children()},scroller:function(){return this._scrollerInstance||(this._scrollerInstance=this.element.closest(".km-scroll-wrapper").data("kendoMobileScroller")),this._scrollerInstance},showLoading:function(){var t=this.view();t&&t.loader&&t.loader.show()},hideLoading:function(){var t=this.view();t&&t.loader&&t.loader.hide()},append:function(t){return this._insert(t,"append")},prepend:function(t){return this._insert(t,"prepend")},replace:function(t){return this.element.empty(),this._insert(t,"append")},replaceGrouped:function(e){this.options.type="group",this.element.empty();var i=t(m.render(this.groupTemplate,e));this._enhanceItems(i),b.init(i),this.element.append(i),this._style()},remove:function(t){var e=this.findByDataItem(t);m.destroy(e),e.remove()},findByDataItem:function(t){var e,i,s=[];for(e=0,i=t.length;i>e;e++)s[e]="[data-"+m.ns+"uid="+t[e].uid+"]";return this.element.find(s.join(","))},setDataItem:function(e,i){var s=this,n=function(n){var o=t(n[0]);t(e).replaceWith(o),s.trigger("itemChange",{item:o,data:i,ns:v})};return this._renderItems([i],n)[0]},_insert:function(t,e){var i=this;return this._renderItems(t,function(s){i.element[e](s);for(var n=0;n<s.length;n++)i.trigger("itemChange",{item:[s[n]],data:t[n],ns:v})})},_renderItems:function(e,i){var s=t(m.render(this.template,e));return i(s),b.init(s),this._enhanceItems(s),s},_dim:function(t){this._toggle(t,!1)},_highlight:function(t){this._toggle(t,!0)},_toggle:function(e,i){if(!(e.which>1)){var s=t(e.currentTarget),n=s.parent(),o=x(s,"role")||"",r=!o.match(U),a=e.isDefaultPrevented();r&&n.toggleClass(H,i&&!a)}},_templates:function(){var t=this.options.template,e=this.options.headerTemplate,i=' data-uid="#=arguments[0].uid || ""#"',s={},n={};typeof t===E&&(s.template=t,t="#=this.template(data)#"),this.template=S(m.template("<li"+i+">"+t+"</li>"),s),n.template=this.template,typeof e===E&&(n._headerTemplate=e,e="#=this._headerTemplate(data)#"),n.headerTemplate=m.template(e),this.groupTemplate=S(I,n)},_click:function(e){if(!(e.event.which>1||e.event.isDefaultPrevented())){var i,s=e.target,n=t(e.event.target),o=n.closest(m.roleSelector("button","detailbutton","backbutton")),r=m.widgetInstance(o,v),a=s.attr(m.attr("uid"));a&&(i=this.dataSource.getByUid(a)),this.trigger(L,{target:n,item:s,dataItem:i,button:r})&&e.preventDefault()}},_styleGroups:function(){var e=this.element.children();e.children("ul").addClass("km-list"),e.each(function(){var e=t(this),i=e.contents().first();e.addClass("km-group-container"),i.is("ul")||i.is("div."+C)||i.wrap(B)})},_style:function(){var t=this.options,e="group"===t.type,i=this.element,s="inset"===t.style;i.addClass("km-listview").toggleClass("km-list",!e).toggleClass("km-virtual-list",this.virtual).toggleClass("km-listinset",!e&&s).toggleClass("km-listgroup",e&&!s).toggleClass("km-listgroupinset",e&&s),i.parents(".km-listview")[0]||i.closest(".km-content").toggleClass("km-insetcontent",s),e&&this._styleGroups(),this.trigger(V)},_enhanceItems:function(e){e.each(function(){var e,i=t(this),r=!1;i.children().each(function(){e=t(this),e.is("a")?(n(e),r=!0):e.is("label")&&(o(e),r=!0)}),r||s(i)})}}),v.plugin(p)}(window.kendo.jQuery)});