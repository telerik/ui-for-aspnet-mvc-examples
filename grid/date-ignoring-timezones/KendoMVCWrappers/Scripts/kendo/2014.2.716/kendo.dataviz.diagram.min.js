/*
* Kendo UI v2014.2.716 (http://www.telerik.com/kendo-ui)
* Copyright 2014 Telerik AD. All rights reserved.
*
* Kendo UI commercial licenses may be obtained at
* http://www.telerik.com/purchase/license-agreement/kendo-ui-complete
* If you do not own a commercial license, this file shall be governed by the trial license terms.
*/
!function(e,define){define(["./kendo.data.min","./kendo.draganddrop.min","./kendo.userevents.min","./kendo.mobile.scroller.min","./kendo.dataviz.core.min","./kendo.dataviz.themes.min"],e)}(function(){return function(e,t){function n(e,n,i){function r(e){for(var t=1;e*t%1;)t*=10;return t}var o,a,s,l;if(t===e||t===n)return[];if(i&&u.sign(n-e)!=u.sign(i))throw"The sign of the increment should allow to reach the stop-value.";if(i=i||1,e=e||0,n=n||e,(n-e)/i===1/0)throw"Infinite range defined.";if(o=[],a=-1,l=r(Math.abs(i)),e*=l,n*=l,i*=l,e>n&&i>0&&(i=-i),0>i)for(;(s=e+i*++a)>=n;)o.push(s/l);else for(;(s=e+i*++a)<=n;)o.push(s/l);return o}function i(e,t){if(e==t)return 0;var n=t.x-e.x,i=e.y-t.y,r=Math.atan(n/i);return i>=0?0>n?r+2*Math.PI:r:r+Math.PI}var r,o,a=window.kendo,s=a.dataviz.diagram={},l=a.deepExtend,d=e.isArray,c=1e-6,u={};l(u,{isNearZero:function(e){return Math.abs(e)<c},isDefined:function(e){return t!==e},isUndefined:function(e){return t===e||null===e},isObject:function(e){return e===Object(e)},has:function(e,t){return Object.hasOwnProperty.call(e,t)},isString:function(e){return"[object String]"==Object.prototype.toString.call(e)},isBoolean:function(e){return"[object Boolean]"==Object.prototype.toString.call(e)},isType:function(e,t){return Object.prototype.toString.call(e)=="[object "+t+"]"},isNumber:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},isEmpty:function(e){if(null===e)return!0;if(d(e)||u.isString(e))return 0===e.length;for(var t in e)if(u.has(e,t))return!1;return!0},simpleExtend:function(e,t){if(u.isObject(t))for(var n in t)e[n]=t[n]},initArray:function(e,t){var n,i=[];for(n=0;e>n;++n)i[n]=t;return i},serializePoints:function(e){var t,n,i=[];for(t=0;e.length>t;t++)n=e[t],i.push(n.x+";"+n.y);return i.join(";")},deserializePoints:function(e){var t,n=e.split(";"),i=[];if(n.length%2!==0)throw"Not an array of points.";for(t=0;n.length>t;t+=2)i.push(new s.Point(parseInt(n[t],10),parseInt(n[t+1],10)));return i},randomInteger:function(e,t){return parseInt(Math.floor(Math.random()*t)+e,10)},DFT:function(e,t){var n,i;if(t(e),e.childNodes)for(n=0;e.childNodes.length>n;n++)i=e.childNodes[n],this.DFT(i,t)},getMatrixAngle:function(e){return null===e||0===e.d?0:180*Math.atan2(e.b,e.d)/Math.PI},getMatrixScaling:function(e){var t=Math.sqrt(e.a*e.a+e.c*e.c),n=Math.sqrt(e.b*e.b+e.d*e.d);return[t,n]}}),u.sign=function(e){return e?0>e?-1:1:0},u.findAngle=function(e,t){return 180*i(e,t)/Math.PI},u.forEach=function(e,t,n){for(var i=0;e.length>i;i++)t.call(n,e[i],i,e)},u.any=function(e,t){for(var n=0;e.length>n;++n)if(t(e[n]))return e[n];return null},u.remove=function(e,t){for(var n;-1!==(n=u.indexOf(e,t));)e.splice(n,1);return e},u.contains=function(e,t){return-1!==u.indexOf(e,t)},u.indexOf=function(t,n){return e.inArray(n,t)},u.fold=function(e,t,n,i){var r,o,a=arguments.length>2;for(r=0;e.length>r;r++)o=e[r],a?n=t.call(i,n,o,r,e):(n=o,a=!0);if(!a)throw"Reduce of empty array with no initial value";return n},u.find=function(e,t,n){var i;return u.any(e,function(e,r,o){return t.call(n,e,r,o)?(i=e,!0):!1}),i},u.first=function(e,t,n){return 0===e.length?null:u.isUndefined(t)?e[0]:u.find(e,t,n)},u.insert=function(e,t,n){return e.splice(n,0,t),e},u.all=function(e,t,n){var i,r,o=!0;for(r=0;e.length>r&&(i=e[r],o=o&&t.call(n,i,r,e),o);r++);return o},u.clear=function(e){e.splice(0,e.length)},u.bisort=function(e,t,n){if(u.isUndefined(e))throw"First array is not specified.";if(u.isUndefined(t))throw"Second array is not specified.";if(e.length!=t.length)throw"The two arrays should have equal length";var i,r=[];for(i=0;e.length>i;i++)r.push({x:e[i],y:t[i]});for(r.sort(u.isUndefined(n)?function(e,t){return e.x-t.x}:function(e,t){return n(e.x,t.x)}),u.clear(e),u.clear(t),i=0;r.length>i;i++)e.push(r[i].x),t.push(r[i].y)},u.addRange=function(e,t){e.push.apply(e,t)},r={easeInOut:function(e){return-Math.cos(e*Math.PI)/2+.5}},o=a.Class.extend({init:function(){this.adapters=[],this.target=0,this.tick=0,this.interval=20,this.duration=800,this.lastTime=null,this.handlers=[];var e=this;this.transition=r.easeInOut,this.timerDelegate=function(){e.onTimerEvent()}},addAdapter:function(e){this.adapters.push(e)},onComplete:function(e){this.handlers.push(e)},removeHandler:function(t){this.handlers=e.grep(this.handlers,function(e){return e!==t})},trigger:function(){var e=this;this.handlers&&u.forEach(this.handlers,function(t){return t.call(null!==e.caller?e.caller:e)})},onStep:function(){},seekTo:function(e){this.seekFromTo(this.tick,e)},seekFromTo:function(e,t){this.target=Math.max(0,Math.min(1,t)),this.tick=Math.max(0,Math.min(1,e)),this.lastTime=(new Date).getTime(),this.intervalId||(this.intervalId=window.setInterval(this.timerDelegate,this.interval))},stop:function(){this.intervalId&&(window.clearInterval(this.intervalId),this.intervalId=null,this.trigger())},play:function(e){0!==this.adapters.length&&(null!==e&&(this.caller=e),this.initState(),this.seekFromTo(0,1))},reverse:function(){this.seekFromTo(1,0)},initState:function(){if(0!==this.adapters.length)for(var e=0;this.adapters.length>e;e++)this.adapters[e].initState()},propagate:function(){var e,t=this.transition(this.tick);for(e=0;this.adapters.length>e;e++)this.adapters[e].update(t)},onTimerEvent:function(){var e,t=(new Date).getTime(),n=t-this.lastTime;this.lastTime=t,e=n/this.duration*(this.target>this.tick?1:-1),Math.abs(e)>=Math.abs(this.tick-this.target)?this.tick=this.target:this.tick+=e;try{this.propagate()}finally{this.onStep.call(this),this.target==this.tick&&this.stop()}}}),a.deepExtend(s,{init:function(e){a.init(e,s.ui)},Utils:u,Range:n,Ticker:o})}(window.kendo.jQuery),function(e,t){function n(e){return Math.abs(e)<z}function i(e,t,i,r,o){var a,s,l,d,c=(t.x-e.x)*(r.y-i.y)-(t.y-e.y)*(r.x-i.x);if(!n(c)&&(a=(e.y-i.y)*(r.x-i.x)-(e.x-i.x)*(r.y-i.y),s=(e.y-i.y)*(t.x-e.x)-(e.x-i.x)*(t.y-e.y),l=a/c,d=s/c,!o||!(0>l||l>1||0>d||d>1)))return new A(e.x+l*(t.x-e.x),e.y+l*(t.y-e.y))}function r(e,t){var n,i,r;do n=2*Math.random()-1,i=2*Math.random()-1,r=n*n+i*i;while(!r||r>1);return e+t*n*Math.sqrt(-2*Math.log(r)/r)}function o(e){var t,n,i;for(D.isUndefined(e)&&(e=10),t="",n="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",i=e;i>0;--i)t+=n.charAt(Math.round(Math.random()*(n.length-1)));return t}var a,s,l,d,c,u,h,p,f,g,m,v,_,y,w,k,b=window.kendo,x=b.dataviz.diagram,C=b.Class,T=b.deepExtend,S=b.dataviz,D=x.Utils,A=S.Point2D,E=b.isFunction,I=D.contains,P=e.map,M=3,z=1e-6;T(A.fn,{plus:function(e){return new A(this.x+e.x,this.y+e.y)},minus:function(e){return new A(this.x-e.x,this.y-e.y)},offset:function(e){return new A(this.x-e,this.y-e)},times:function(e){return new A(this.x*e,this.y*e)},normalize:function(){return 0===this.length()?new A:this.times(1/this.length())},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},toString:function(){return"("+this.x+","+this.y+")"},lengthSquared:function(){return this.x*this.x+this.y*this.y},middleOf:function(e,t){return new A(t.x-e.x,t.y-e.y).times(.5).plus(e)},toPolar:function(e){var t,n,i,r=1;if(e&&(r=180/Math.PI),t=Math.atan2(Math.abs(this.y),Math.abs(this.x)),n=Math.PI/2,i=this.length(),0===this.x){if(0===this.y)return new u(0,0);if(this.y>0)return new u(i,r*n);if(0>this.y)return new u(i,3*r*n)}else if(this.x>0){if(0===this.y)return new u(i,0);if(this.y>0)return new u(i,r*t);if(0>this.y)return new u(i,r*(4*n-t))}else{if(0===this.y)return new u(i,2*n);if(this.y>0)return new u(i,r*(2*n-t));if(0>this.y)return new u(i,r*(2*n+t))}},isOnLine:function(e,t){var n,i,r,o,a;return e.x>t.x&&(n=t,t=e,e=n),i=new s(e.x,e.y).inflate(M,M),r=new s(t.x,t.y).inflate(M,M),i.union(r).contains(this)?e.x===t.x||e.y===t.y?!0:(t.y>e.y?(o=i.x+(r.x-i.x)*(this.y-(i.y+i.height))/(r.y+r.height-(i.y+i.height)),a=i.x+i.width+(r.x+r.width-(i.x+i.width))*(this.y-i.y)/(r.y-i.y)):(o=i.x+(r.x-i.x)*(this.y-i.y)/(r.y-i.y),a=i.x+i.width+(r.x+r.width-(i.x+i.width))*(this.y-(i.y+i.height))/(r.y+r.height-(i.y+i.height))),this.x>o&&a>this.x):!1}}),T(A,{parse:function(e){var n=e.slice(1,e.length-1),i=n.split(","),r=parseInt(i[0],10),o=parseInt(i[1],10);return isNaN(r)||isNaN(o)?t:new A(r,o)}}),a=C.extend({init:function(e,t,n){this.point=e,this.left=t,this.right=n}}),s=C.extend({init:function(e,t,n,i){this.x=e||0,this.y=t||0,this.width=n||0,this.height=i||0},contains:function(e){return e.x>=this.x&&this.x+this.width>=e.x&&e.y>=this.y&&this.y+this.height>=e.y},inflate:function(e,n){return n===t&&(n=e),this.x-=e,this.y-=n,this.width+=2*e+1,this.height+=2*n+1,this},offset:function(e,t){var n=e,i=t;return e instanceof A&&(n=e.x,i=e.y),this.x+=n,this.y+=i,this},union:function(e){var t=Math.min(this.x,e.x),n=Math.min(this.y,e.y),i=Math.max(this.x+this.width,e.x+e.width),r=Math.max(this.y+this.height,e.y+e.height);return new s(t,n,i-t,r-n)},center:function(){return new A(this.x+this.width/2,this.y+this.height/2)},top:function(){return new A(this.x+this.width/2,this.y)},right:function(){return new A(this.x+this.width,this.y+this.height/2)},bottom:function(){return new A(this.x+this.width/2,this.y+this.height)},left:function(){return new A(this.x,this.y+this.height/2)},topLeft:function(){return new A(this.x,this.y)},topRight:function(){return new A(this.x+this.width,this.y)},bottomLeft:function(){return new A(this.x,this.y+this.height)},bottomRight:function(){return new A(this.x+this.width,this.y+this.height)},clone:function(){return new s(this.x,this.y,this.width,this.height)},isEmpty:function(){return!this.width&&!this.height},equals:function(e){return this.x===e.x&&this.y===e.y&&this.width===e.width&&this.height===e.height},rotatedBounds:function(e){var t=this.clone(),n=this.rotatedPoints(e),i=n[0],r=n[1],o=n[2],a=n[3];return t.x=Math.min(o.x,i.x,r.x,a.x),t.y=Math.min(o.y,i.y,r.y,a.y),t.width=Math.max(o.x,i.x,r.x,a.x)-t.x,t.height=Math.max(o.y,i.y,r.y,a.y)-t.y,t},rotatedPoints:function(e){var t=this,n=t.center(),i=t.bottomRight().rotate(n,360-e),r=t.topLeft().rotate(n,360-e),o=t.topRight().rotate(n,360-e),a=t.bottomLeft().rotate(n,360-e);return[r,o,i,a]},toString:function(e){return e=e||" ",this.x+e+this.y+e+this.width+e+this.height},scale:function(e,t,n,i,r){var o,a,s,l=this.topLeft(),d=this.center();l.rotate(d,360-r).rotate(i,r),o=n.minus(l),a=new A(o.x*e,o.y*t),s=o.minus(a),l=l.plus(s),l.rotate(i,360-r).rotate(d,r),this.x=l.x,this.y=l.y,this.width*=e,this.height*=t},zoom:function(e){return this.x*=e,this.y*=e,this.width*=e,this.height*=e,this}}),l=C.extend({init:function(e,t){this.width=e,this.height=t}}),l.prototype.Empty=new l(0,0),s.toRect=function(e){return e instanceof s||(e=new s(e.x,e.y,e.width,e.height)),e},s.empty=function(){return new s(0,0,0,0)},s.fromPoints=function(e,t){if(isNaN(e.x)||isNaN(e.y)||isNaN(t.x)||isNaN(t.y))throw"Some values are NaN.";return new s(Math.min(e.x,t.x),Math.min(e.y,t.y),Math.abs(e.x-t.x),Math.abs(e.y-t.y))},d={lines:function(e,t,n,r){return i(e,t,n,r)},segments:function(e,t,n,r){return i(e,t,n,r,!0)},rectWithLine:function(e,t,n){return d.segments(t,n,e.topLeft(),e.topRight())||d.segments(t,n,e.topRight(),e.bottomRight())||d.segments(t,n,e.bottomLeft(),e.bottomRight())||d.segments(t,n,e.topLeft(),e.bottomLeft())},rects:function(e,t,n){var i,r,o=t.topLeft(),a=t.topRight(),s=t.bottomLeft(),l=t.bottomRight(),c=t.center();return n&&(o=o.rotate(c,n),a=a.rotate(c,n),s=s.rotate(c,n),l=l.rotate(c,n)),i=e.contains(o)||e.contains(a)||e.contains(s)||e.contains(l)||d.rectWithLine(e,o,a)||d.rectWithLine(e,o,s)||d.rectWithLine(e,a,l)||d.rectWithLine(e,s,l),i||(o=e.topLeft(),a=e.topRight(),s=e.bottomLeft(),l=e.bottomRight(),n&&(r=360-n,o=o.rotate(c,r),a=a.rotate(c,r),s=s.rotate(c,r),l=l.rotate(c,r)),i=t.contains(o)||t.contains(a)||t.contains(s)||t.contains(l)),i}},c=C.extend({init:function(e){this.container=s.toRect(e)},align:function(e,t){var n,i=t.toLowerCase().split(" ");for(n=0;i.length>n;n++)e=this._singleAlign(e,i[n]);return e},_singleAlign:function(e,t){return E(this[t])?this[t](e):e},left:function(e){return this._align(e,this._left)},center:function(e){return this._align(e,this._center)},right:function(e){return this._align(e,this._right)},stretch:function(e){return this._align(e,this._stretch)},top:function(e){return this._align(e,this._top)},middle:function(e){return this._align(e,this._middle)},bottom:function(e){return this._align(e,this._bottom)},_left:function(e,t){t.x=e.x},_center:function(e,t){t.x=(e.width-t.width)/2||0},_right:function(e,t){t.x=e.width-t.width},_top:function(e,t){t.y=e.y},_middle:function(e,t){t.y=(e.height-t.height)/2||0},_bottom:function(e,t){t.y=e.height-t.height},_stretch:function(e,t){t.x=0,t.y=0,t.height=e.height,t.width=e.width},_align:function(e,t){return e=s.toRect(e),t(this.container,e),e}}),u=C.extend({init:function(e,t){this.r=e,this.angle=t}}),h=C.extend({init:function(e,t,n,i,r,o){this.a=e||0,this.b=t||0,this.c=n||0,this.d=i||0,this.e=r||0,this.f=o||0},plus:function(e){this.a+=e.a,this.b+=e.b,this.c+=e.c,this.d+=e.d,this.e+=e.e,this.f+=e.f},minus:function(e){this.a-=e.a,this.b-=e.b,this.c-=e.c,this.d-=e.d,this.e-=e.e,this.f-=e.f},times:function(e){return new h(this.a*e.a+this.c*e.b,this.b*e.a+this.d*e.b,this.a*e.c+this.c*e.d,this.b*e.c+this.d*e.d,this.a*e.e+this.c*e.f+this.e,this.b*e.e+this.d*e.f+this.f)},apply:function(e){return new A(this.a*e.x+this.c*e.y+this.e,this.b*e.x+this.d*e.y+this.f)},applyRect:function(e){return s.fromPoints(this.apply(e.topLeft()),this.apply(e.bottomRight()))},toString:function(){return"matrix("+this.a+" "+this.b+" "+this.c+" "+this.d+" "+this.e+" "+this.f+")"}}),T(h,{fromSVGMatrix:function(e){var t=new h;return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t.e=e.e,t.f=e.f,t},fromMatrixVector:function(e){var t=new h;return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t.e=e.e,t.f=e.f,t},fromList:function(e){if(6!==e.length)throw"The given list should consist of six elements.";var t=new h;return t.a=e[0],t.b=e[1],t.c=e[2],t.d=e[3],t.e=e[4],t.f=e[5],t},translation:function(e,t){var n=new h;return n.a=1,n.b=0,n.c=0,n.d=1,n.e=e,n.f=t,n},unit:function(){return new h(1,0,0,1,0,0)},rotation:function(e,t,n){var i=new h;return i.a=Math.cos(e*Math.PI/180),i.b=Math.sin(e*Math.PI/180),i.c=-i.b,i.d=i.a,i.e=t-t*i.a+n*i.b||0,i.f=n-n*i.a-t*i.b||0,i},scaling:function(e,t){var n=new h;return n.a=e,n.b=0,n.c=0,n.d=t,n.e=0,n.f=0,n},parse:function(e){var t,n;if(e){if(e=e.trim(),"matrix"===e.slice(0,6).toLowerCase()){if(n=e.slice(7,e.length-1).trim(),t=n.split(","),6===t.length)return h.fromList(P(t,function(e){return parseFloat(e)}));if(t=n.split(" "),6===t.length)return h.fromList(P(t,function(e){return parseFloat(e)}))}if("("===e.slice(0,1)&&")"===e.slice(e.length-1)&&(e=e.substr(1,e.length-1)),e.indexOf(",")>0&&(t=e.split(","),6===t.length))return h.fromList(P(t,function(e){return parseFloat(e)}));if(e.indexOf(" ")>0&&(t=e.split(" "),6===t.length))return h.fromList(P(t,function(e){return parseFloat(e)}))}return t}}),p=C.extend({init:function(e,t,n,i,r,o){this.a=e||0,this.b=t||0,this.c=n||0,this.d=i||0,this.e=r||0,this.f=o||0},fromMatrix:function(e){var t=new p;return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t.e=e.e,t.f=e.f,t}}),f={_distanceToLineSquared:function(e,t,n){function i(e,t){return(e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y)}if(t===n)return i(e,t);var r=n.x-t.x,o=n.y-t.y,a=(e.x-t.x)*r+(e.y-t.y)*o;return 0>a?i(t,e):(a=(n.x-e.x)*r+(n.y-e.y)*o,0>a?i(n,e):(a=(n.x-e.x)*o-(n.y-e.y)*r,a*a/(r*r+o*o)))},distanceToLine:function(e,t,n){return Math.sqrt(this._distanceToLineSquared(e,t,n))},distanceToPolyline:function(e,t){var n,i,r,o,a=Number.MAX_VALUE;if(D.isUndefined(t)||0===t.length)return Number.MAX_VALUE;for(n=0;t.length-1>n;n++)i=t[n],r=t[n+1],o=this._distanceToLineSquared(e,i,r),a>o&&(a=o);return Math.sqrt(a)}},g=b.Class.extend({init:function(){this._buckets=[],this.length=0},add:function(e,t){var n=this._createGetBucket(e);return D.isDefined(t)&&(n.value=t),n},get:function(e){return this._bucketExists(e)?this._createGetBucket(e):null},set:function(e,t){this.add(e,t)},containsKey:function(e){return this._bucketExists(e)},remove:function(e){if(this._bucketExists(e)){var t=this._hash(e);return delete this._buckets[t],this.length--,e}},forEach:function(e){var t,n,i,r,o=this._hashes();for(t=0,n=o.length;n>t;t++)i=o[t],r=this._buckets[i],D.isUndefined(r)||e(r)},clone:function(){var e,t,n,i,r=new g,o=this._hashes();for(e=0,t=o.length;t>e;e++)n=o[e],i=this._buckets[n],D.isUndefined(i)||r.add(i.key,i.value);return r},_hashes:function(){var e,t=[];for(e in this._buckets)this._buckets.hasOwnProperty(e)&&t.push(e);return t},_bucketExists:function(e){var t=this._hash(e);return D.isDefined(this._buckets[t])},_createGetBucket:function(e){var t=this._hash(e),n=this._buckets[t];return D.isUndefined(n)&&(n={key:e},this._buckets[t]=n,this.length++),n},_hash:function(e){if(D.isNumber(e))return e;if(D.isString(e))return this._hashString(e);if(D.isObject(e))return this._objectHashId(e);throw"Unsupported key type."},_hashString:function(e){var t,n,i=0;if(0===e.length)return i;for(t=0;e.length>t;t++)n=e.charCodeAt(t),i=32*i-i+n;return i},_objectHashId:function(e){var t=e._hashId;return D.isUndefined(t)&&(t=o(),e._hashId=t),t}}),m=b.Observable.extend({init:function(t){var n,i=this;if(b.Observable.fn.init.call(i),this._hashTable=new g,this.length=0,D.isDefined(t))if(e.isArray(t))for(n=0;t.length>n;n++)this.add(t[n]);else t.forEach(function(e,t){this.add(e,t)},this)},add:function(e,t){var n=this._hashTable.get(e);n||(n=this._hashTable.add(e),this.length++,this.trigger("changed")),n.value=t},set:function(e,t){this.add(e,t)},get:function(e){var t=this._hashTable.get(e);if(t)return t.value;throw Error("Cannot find key "+e)},containsKey:function(e){return this._hashTable.containsKey(e)},remove:function(e){return this.containsKey(e)?(this.trigger("changed"),this.length--,this._hashTable.remove(e)):t},forEach:function(e,t){this._hashTable.forEach(function(n){e.call(t,n.key,n.value)})},forEachValue:function(e,t){this._hashTable.forEach(function(n){e.call(t,n.value)})},forEachKey:function(e,t){this._hashTable.forEach(function(n){e.call(t,n.key)})},keys:function(){var e=[];return this.forEachKey(function(t){e.push(t)}),e}}),v=b.Class.extend({init:function(){this._tail=null,this._head=null,this.length=0},enqueue:function(e){var t={value:e,next:null};this._head?(this._tail.next=t,this._tail=this._tail.next):(this._head=t,this._tail=this._head),this.length++},dequeue:function(){if(1>this.length)throw Error("The queue is empty.");var e=this._head.value;return this._head=this._head.next,this.length--,e},contains:function(e){for(var t=this._head;t;){if(t.value===e)return!0;t=t.next}return!1}}),_=b.Observable.extend({init:function(e){var t=this;b.Observable.fn.init.call(t),this._hashTable=new g,this.length=0,D.isDefined(e)&&(e instanceof g?e.forEach(function(e){this.add(e)}):e instanceof m&&e.forEach(function(e,t){this.add({key:e,value:t})},this))},contains:function(e){return this._hashTable.containsKey(e)},add:function(e){var t=this._hashTable.get(e);t||(this._hashTable.add(e,e),this.length++,this.trigger("changed"))},get:function(e){return this.contains(e)?this._hashTable.get(e).value:null},hash:function(e){return this._hashTable._hash(e)},remove:function(e){this.contains(e)&&(this._hashTable.remove(e),this.length--,this.trigger("changed"))},forEach:function(e,t){this._hashTable.forEach(function(t){e(t.value)},t)},toArray:function(){var e=[];return this.forEach(function(t){e.push(t)}),e}}),y=b.Class.extend({init:function(e,t){if(this.links=[],this.outgoing=[],this.incoming=[],this.weight=1,this.id=D.isDefined(e)?e:o(),D.isDefined(t)){this.associatedShape=t;var n=t.bounds();this.width=n.width,this.height=n.height,this.x=n.x,this.y=n.y}else this.associatedShape=null;this.data=null,this.type="Node",this.shortForm="Node '"+this.id+"'",this.isVirtual=!1},isIsolated:function(){return D.isEmpty(this.links)},bounds:function(e){return D.isDefined(e)?(this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,t):new x.Rect(this.x,this.y,this.width,this.height)},isLinkedTo:function(e){var t=this;return D.any(t.links,function(n){return n.getComplement(t)===e})},getChildren:function(){var e,t,n,i;if(0===this.outgoing.length)return[];for(e=[],t=0,n=this.outgoing.length;n>t;t++)i=this.outgoing[t],e.push(i.getComplement(this));return e},getParents:function(){var e,t,n,i;if(0===this.incoming.length)return[];for(e=[],t=0,n=this.incoming.length;n>t;t++)i=this.incoming[t],e.push(i.getComplement(this));return e},clone:function(){var e=new y;return D.isDefined(this.weight)&&(e.weight=this.weight),D.isDefined(this.balance)&&(e.balance=this.balance),D.isDefined(this.owner)&&(e.owner=this.owner),e.associatedShape=this.associatedShape,e.x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e},adjacentTo:function(e){return null!==this.isLinkedTo(e)},removeLink:function(e){e.source===this&&(D.remove(this.links,e),D.remove(this.outgoing,e),e.source=null),e.target===this&&(D.remove(this.links,e),D.remove(this.incoming,e),e.target=null)},hasLinkTo:function(e){return D.any(this.outgoing,function(t){return t.target===e})},degree:function(){return this.links.length},incidentWith:function(e){return I(this.links,e)},getLinksWith:function(e){return D.all(this.links,function(t){return t.getComplement(this)===e},this)},getNeighbors:function(){var e=[];return D.forEach(this.incoming,function(t){e.push(t.getComplement(this))},this),D.forEach(this.outgoing,function(t){e.push(t.getComplement(this))},this),e}}),w=b.Class.extend({init:function(e,t,n,i){if(D.isUndefined(e))throw"The source of the new link is not set.";if(D.isUndefined(t))throw"The target of the new link is not set.";var r,a;r=D.isString(e)?new y(e):e,a=D.isString(t)?new y(t):t,this.source=r,this.target=a,this.source.links.push(this),this.target.links.push(this),this.source.outgoing.push(this),this.target.incoming.push(this),this.id=D.isDefined(n)?n:o(),this.associatedConnection=D.isDefined(i)?i:null,this.type="Link",this.shortForm="Link '"+this.source.id+"->"+this.target.id+"'"},getComplement:function(e){if(this.source!==e&&this.target!==e)throw"The given node is not incident with this link.";return this.source===e?this.target:this.source},getCommonNode:function(e){return this.source===e.source||this.source===e.target?this.source:this.target===e.source||this.target===e.target?this.target:null},isBridging:function(e,t){return this.source===e&&this.target===t||this.source===t&&this.target===e},getNodes:function(){return[this.source,this.target]},incidentWith:function(e){return this.source===e||this.target===e},adjacentTo:function(e){return I(this.source.links,e)||I(this.target.links,e)},changeSource:function(e){D.remove(this.source.links,this),D.remove(this.source.outgoing,this),e.links.push(this),e.outgoing.push(this),this.source=e},changeTarget:function(e){D.remove(this.target.links,this),D.remove(this.target.incoming,this),e.links.push(this),e.incoming.push(this),this.target=e},changesNodes:function(e,t){this.source===e?this.changeSource(t):this.target===e&&this.changeTarget(t)},reverse:function(){var e=this.source,t=this.target;return this.source=t,D.remove(e.outgoing,this),this.source.outgoing.push(this),this.target=e,D.remove(t.incoming,this),this.target.incoming.push(this),this},directTo:function(e){if(this.source!==e&&this.target!==e)throw"The given node is not incident with this link.";this.target!==e&&this.reverse()},createReverseEdge:function(){var e=this.clone();return e.reverse(),e.reversed=!0,e},clone:function(){var e=new w(this.source,this.target);return e}}),k=b.Class.extend({init:function(e){this.links=[],this.nodes=[],this.diagram=null,this._root=null,D.isDefined(e)?D.isString(e)?this.id=e:(this.diagram=e,this.id=e.id):this.id=o(),this.bounds=new s,this._hasCachedRelationships=!1,this.type="Graph"},cacheRelationships:function(e){var t,n,i;if(D.isUndefined(e)&&(e=!1),!this._hasCachedRelationships||e){for(t=0,n=this.nodes.length;n>t;t++)i=this.nodes[t],i.children=this.getChildren(i),i.parents=this.getParents(i);this._hasCachedRelationships=!0}},assignLevels:function(e,t,n){var i,r,o,a;if(!e)throw"Start node not specified.";for(D.isUndefined(t)&&(t=0),this.cacheRelationships(),D.isUndefined(n)&&(n=new m,D.forEach(this.nodes,function(e){n.add(e,!1)})),n.set(e,!0),e.level=t,i=e.children,r=0,o=i.length;o>r;r++)a=i[r],a&&!n.get(a)&&this.assignLevels(a,t+1,n)},root:function(e){if(D.isUndefined(e)){if(this._root)return this._root;var t=D.first(this.nodes,function(e){return 0===e.incoming.length});return t?t:D.first(this.nodes)}this._root=e},getConnectedComponents:function(){var e,t,n,i,r;for(this.componentIndex=0,this.setItemIndices(),e=D.initArray(this.nodes.length,-1),t=0;this.nodes.length>t;t++)-1===e[t]&&(this._collectConnectedNodes(e,t),this.componentIndex++);for(n=[],i=0;this.componentIndex>i;++i)n[i]=new k;for(i=0;e.length>i;++i)r=n[e[i]],r.addNodeAndOutgoings(this.nodes[i]);return n.sort(function(e,t){return t.nodes.length-e.nodes.length}),n},_collectConnectedNodes:function(e,t){e[t]=this.componentIndex;var n=this.nodes[t];D.forEach(n.links,function(t){var i=t.getComplement(n),r=i.index;-1===e[r]&&this._collectConnectedNodes(e,r)},this)},calcBounds:function(){var e,t,n,i;if(this.isEmpty())return this.bounds=new s;for(e=null,t=0,n=this.nodes.length;n>t;t++)i=this.nodes[t],e=e?e.union(i.bounds()):i.bounds();return this.bounds=e},getSpanningTree:function(e){var t,n,i,r,o,a,s,l,d,c,u,h,p=new k,f=new m;for(p.root=e.clone(),p.root.level=0,p.root.id=e.id,f.add(e,p.root),e.level=0,i=[],r=[],p.nodes.push(p.root),i.push(e),r.push(e),o=1;r.length>0;)for(a=r.pop(),s=0;a.links.length>s;s++)l=a.links[s],d=l.getComplement(a),I(i,d)||(d.level=a.level+1,d.level+1>o&&(o=d.level+1),I(r,d)||r.push(d),I(i,d)||i.push(d),f.containsKey(a)?t=f.get(a):(t=a.clone(),t.level=a.level,t.id=a.id,f.add(a,t)),f.containsKey(d)?n=f.get(d):(n=d.clone(),n.level=d.level,n.id=d.id,f.add(d,n)),c=new w(t,n),p.addLink(c));for(u=[],h=0;o>h;h++)u.push([]);return D.forEach(p.nodes,function(e){u[e.level].push(e)}),p.treeLevels=u,p.cacheRelationships(),p},takeRandomNode:function(t,n){if(D.isUndefined(t)&&(t=[]),D.isUndefined(n)&&(n=4),0===this.nodes.length)return null;if(1===this.nodes.length)return I(t,this.nodes[0])?null:this.nodes[0];var i=e.grep(this.nodes,function(e){return!I(t,e)&&e.degree()<=n});return D.isEmpty(i)?null:i[D.randomInteger(0,i.length)]},isEmpty:function(){return D.isEmpty(this.nodes)},isHealthy:function(){return D.all(this.links,function(e){return I(this.nodes,e.source)&&I(this.nodes,e.target)},this)},getParents:function(e){if(!this.hasNode(e))throw"The given node is not part of this graph.";return e.getParents()},getChildren:function(e){if(!this.hasNode(e))throw"The given node is not part of this graph.";return e.getChildren()},addLink:function(e,n,i){var r,o,a;if(D.isUndefined(e))throw"The source of the link is not defined.";if(D.isUndefined(n)){if(D.isDefined(e.type)&&"Link"===e.type)return this.addExistingLink(e),t;throw"The target of the link is not defined."}return r=this.getNode(e),D.isUndefined(r)&&(r=this.addNode(e)),o=this.getNode(n),D.isUndefined(o)&&(o=this.addNode(n)),a=new w(r,o),D.isDefined(i)&&(a.owner=i),this.links.push(a),a},removeAllLinks:function(){for(;this.links.length>0;){var e=this.links[0];this.removeLink(e)}},addExistingLink:function(e){var t,n;this.hasLink(e)||(this.links.push(e),this.hasNode(e.source.id)?(t=this.getNode(e.source.id),e.changeSource(t)):this.addNode(e.source),this.hasNode(e.target.id)?(n=this.getNode(e.target.id),e.changeTarget(n)):this.addNode(e.target))},hasLink:function(e){if(D.isString(e))return D.any(this.links,function(t){return t.id===e});if("Link"===e.type)return I(this.links,e);throw"The given object is neither an identifier nor a Link."},getNode:function(e){if(D.isUndefined(e))throw"No identifier or Node specified.";return D.isString(e)?D.find(this.nodes,function(t){return t.id==e}):this.hasNode(e)?e:null},hasNode:function(e){if(D.isString(e))return D.any(this.nodes,function(t){return t.id===e});if(D.isObject(e))return D.any(this.nodes,function(t){return t===e});throw"The identifier should be a Node or the Id (string) of a node."},removeNode:function(e){var t,n,i,r,o=e;if(D.isString(e)&&(o=this.getNode(e)),!D.isDefined(o))throw"The identifier should be a Node or the Id (string) of a node.";for(t=o.links,o.links=[],n=0,i=t.length;i>n;n++)r=t[n],this.removeLink(r);D.remove(this.nodes,o)},areConnected:function(e,t){return D.any(this.links,function(n){return n.source==e&&n.target==t||n.source==t&&n.target==e})},removeLink:function(e){D.remove(this.links,e),D.remove(e.source.outgoing,e),D.remove(e.source.links,e),D.remove(e.target.incoming,e),D.remove(e.target.links,e)},addNode:function(e,t,n){var i=null;if(!D.isDefined(e))throw"No Node or identifier for a new Node is given.";if(D.isString(e)){if(this.hasNode(e))return this.getNode(e);i=new y(e)}else{if(this.hasNode(e))return this.getNode(e);i=e}return D.isDefined(t)&&i.bounds(t),D.isDefined(n)&&(i.owner=n),this.nodes.push(i),i},addNodeAndOutgoings:function(e){I(this.nodes,e)||this.nodes.push(e);var t=e.outgoing;e.outgoing=[],D.forEach(t,function(e){this.addExistingLink(e)},this)},setItemIndices:function(){var e;for(e=0;this.nodes.length>e;++e)this.nodes[e].index=e;for(e=0;this.links.length>e;++e)this.links[e].index=e},clone:function(e){var t,n=new k,i=D.isDefined(e)&&e===!0;return i&&(n.nodeMap=new m,n.linkMap=new m),t=new m,D.forEach(this.nodes,function(e){var r=e.clone();t.set(e,r),n.nodes.push(r),i&&n.nodeMap.set(r,e)}),D.forEach(this.links,function(e){if(t.containsKey(e.source)&&t.containsKey(e.target)){var r=n.addLink(t.get(e.source),t.get(e.target));i&&n.linkMap.set(r,e)}}),n},linearize:function(e){return k.Utils.linearize(this,e)},depthFirstTraversal:function(e,t){var n,i;if(D.isUndefined(e))throw"You need to supply a starting node.";if(D.isUndefined(t))throw"You need to supply an action.";if(!this.hasNode(e))throw"The given start-node is not part of this graph";n=this.getNode(e),i=[],this._dftIterator(n,t,i)},_dftIterator:function(e,t,n){var i,r,o,a;for(t(e),n.push(e),i=e.getChildren(),r=0,o=i.length;o>r;r++)a=i[r],I(n,a)||this._dftIterator(a,t,n)},breadthFirstTraversal:function(e,t){var n,i,r,o,a,s,l,d;if(D.isUndefined(e))throw"You need to supply a starting node.";if(D.isUndefined(t))throw"You need to supply an action.";if(!this.hasNode(e))throw"The given start-node is not part of this graph";for(n=this.getNode(e),i=new v,r=[],i.enqueue(n);i.length>0;)for(o=i.dequeue(),t(o),r.push(o),a=o.getChildren(),s=0,l=a.length;l>s;s++)d=a[s],I(r,d)||I(i,d)||i.enqueue(d)},_stronglyConnectedComponents:function(e,t,n,i,r,o,a){var s,l,d,c,u;for(n.add(t,a),i.add(t,a),a++,o.push(t),s=t.getChildren(),d=0,c=s.length;c>d;d++)l=s[d],n.containsKey(l)?I(o,l)&&i.add(t,Math.min(i.get(t),n.get(l))):(this._stronglyConnectedComponents(e,l,n,i,r,o,a),i.add(t,Math.min(i.get(t),i.get(l))));if(i.get(t)===n.get(t)){u=[];do l=o.pop(),u.push(l);while(l!==t);(!e||u.length>1)&&r.push(u)}},findCycles:function(e){var t,n,i,r,o,a,s;for(D.isUndefined(e)&&(e=!0),t=new m,n=new m,i=[],r=[],o=0,a=this.nodes.length;a>o;o++)s=this.nodes[o],t.containsKey(s)||this._stronglyConnectedComponents(e,s,t,n,i,r,0);return i},isAcyclic:function(){return D.isEmpty(this.findCycles())},isSubGraph:function(e){var t=e.linearize(),n=this.linearize();return D.all(t,function(e){return I(n,e)})},makeAcyclic:function(){var e,t,n,i,r,o,a,s,l,d,c,u,h,p,f,g,v,_,y,w,k,b,x,C,T,S,A,E,I,P,M,z;if(this.isEmpty()||1>=this.nodes.length||1>=this.links.length)return[];if(2==this.nodes.length){if(e=[],this.links.length>1)for(t=this.links[0],n=t.source,i=0,r=this.links.length;r>i;i++)o=this.links[i],o.source!=n&&(a=o.reverse(),e.push(a));return e}for(s=this.clone(!0),l=this.nodes.length,d=new m,c=function(e){return 0===e.outgoing.length?2-l:0===e.incoming.length?l-2:e.outgoing.length-e.incoming.length},u=function(e,t){var n=c(e,l);t.containsKey(n)||t.set(n,[]),t.get(n).push(e)},D.forEach(s.nodes,function(e){u(e,d)}),h=[],p=[];s.nodes.length>0;){if(d.containsKey(2-l))for(_=d.get(2-l);_.length>0;){for(g=_.pop(),y=0;g.links.length>y;y++)w=g.links[y],f=w.getComplement(g),v=c(f,l),D.remove(d.get(v),f),f.removeLink(w),u(f,d);
D.remove(s.nodes,g),p.unshift(g)}if(d.containsKey(l-2))for(k=d.get(l-2);k.length>0;){for(f=k.pop(),b=0;f.links.length>b;b++)x=f.links[b],g=x.getComplement(f),v=c(g,l),D.remove(d.get(v),g),g.removeLink(x),u(g,d);h.push(f),D.remove(s.nodes,f)}if(s.nodes.length>0)for(C=l-3;C>2-l;C--)if(d.containsKey(C)&&d.get(C).length>0){for(T=d.get(C),S=T.pop(),A=0;S.links.length>A;A++)E=S.links[A],I=E.getComplement(S),v=c(I,l),D.remove(d.get(v),I),I.removeLink(E),u(I,d);h.push(S),D.remove(s.nodes,S);break}}for(h=h.concat(p),P=new m,M=0;this.nodes.length>M;M++)P.set(s.nodeMap.get(h[M]),M);return z=[],D.forEach(this.links,function(e){P.get(e.source)>P.get(e.target)&&(e.reverse(),z.push(e))}),z}}),k.Predefined={EightGraph:function(){return k.Utils.parse(["1->2","2->3","3->4","4->1","3->5","5->6","6->7","7->3"])},Mindmap:function(){return k.Utils.parse(["0->1","0->2","0->3","0->4","0->5","1->6","1->7","7->8","2->9","9->10","9->11","3->12","12->13","13->14","4->15","4->16","15->17","15->18","18->19","18->20","14->21","14->22","5->23","23->24","23->25","6->26"])},ThreeGraph:function(){return k.Utils.parse(["1->2","2->3","3->1"])},BinaryTree:function(e){return D.isUndefined(e)&&(e=5),k.Utils.createBalancedTree(e,2)},Linear:function(e){return D.isUndefined(e)&&(e=10),k.Utils.createBalancedTree(e,1)},Tree:function(e,t){return k.Utils.createBalancedTree(e,t)},Forest:function(e,t,n){return k.Utils.createBalancedForest(e,t,n)},Workflow:function(){return k.Utils.parse(["0->1","1->2","2->3","1->4","4->3","3->5","5->6","6->3","6->7","5->4"])},Grid:function(e,t){var n,i,r,o,a,s=new x.Graph;if(0>=e&&0>=t)return s;for(n=0;e+1>n;n++)for(i=null,r=0;t+1>r;r++)o=new y(""+n+"."+r),s.addNode(o),i&&s.addLink(i,o),n>0&&(a=s.getNode(""+(n-1)+"."+r),s.addLink(a,o)),i=o;return s}},k.Utils={parse:function(e){var t,n,i,r,o,a=new x.Graph,s=e.slice();for(n=0,i=s.length;i>n;n++){if(r=s[n],D.isString(r)){if(r.indexOf("->")<0)throw"The link should be specified as 'a->b'.";if(o=r.split("->"),2!=o.length)throw"The link should be specified as 'a->b'.";t=new w(o[0],o[1]),a.addLink(t)}if(D.isObject(r)){if(!t)throw"Specification found before Link definition.";b.deepExtend(t,r)}}return a},linearize:function(e,t){var n,i,r,o;if(D.isUndefined(e))throw"Expected an instance of a Graph object in slot one.";for(D.isUndefined(t)&&(t=!1),n=[],i=0,r=e.links.length;r>i;i++)o=e.links[i],n.push(o.source.id+"->"+o.target.id),t&&n.push({id:o.id});return n},_addShape:function(e,t,n,i){return D.isUndefined(t)&&(t=new x.Point(0,0)),D.isUndefined(n)&&(n=o()),i=b.deepExtend({width:20,height:20,id:n,radius:10,fill:"#778899",data:"circle",undoable:!1,x:t.x,y:t.y},i),e.addShape(i)},_addConnection:function(e,t,n,i){return e.connect(t,n,i)},createDiagramFromGraph:function(e,t,n,i){var r,o,a,l,d,c,u,h,p,f,g,m,v,_,y,w;if(D.isUndefined(e))throw"The diagram surface is undefined.";if(D.isUndefined(t))throw"No graph specification defined.";for(D.isUndefined(n)&&(n=!0),D.isUndefined(i)&&(i=!1),r=e.element.clientWidth||200,o=e.element.clientHeight||200,a=[],c=0,u=t.nodes.length;u>c;c++)l=t.nodes[c],h=l.position,D.isUndefined(h)&&(h=D.isDefined(l.x)&&D.isDefined(l.y)?new A(l.x,l.y):new A(D.randomInteger(10,r-20),D.randomInteger(10,o-20))),p={},"0"===l.id||i&&b.deepExtend(p,{width:150*Math.random()+20,height:80*Math.random()+50,data:"rectangle",fill:{color:"#778899"}}),d=this._addShape(e,h,l.id,p),f=d.bounds(),D.isDefined(f)&&(l.x=f.x,l.y=f.y,l.width=f.width,l.height=f.height),a[l.id]=d;for(g=0;t.links.length>g;g++)m=t.links[g],v=a[m.source.id],D.isUndefined(v)||(_=a[m.target.id],D.isUndefined(_)||this._addConnection(e,v,_,{id:m.id}));if(n)for(y=new e.SpringLayout(e),y.layoutGraph(t,{limitToView:!1}),w=0;t.nodes.length>w;w++)l=t.nodes[w],d=a[l.id],d.bounds(new s(l.x,l.y,l.width,l.height))},createBalancedTree:function(e,t){var n,i,r,o,a,s,l,d,c,u;if(D.isUndefined(e)&&(e=3),D.isUndefined(t)&&(t=3),n=new x.Graph,i=-1,r=[],0>=e||0>=t)return n;for(a=new y(""+ ++i),n.addNode(a),n.root=a,r.push(a),s=0;e>s;s++){for(o=[],l=0;r.length>l;l++)for(d=r[l],c=0;t>c;c++)u=new y(""+ ++i),n.addLink(d,u),o.push(u);r=o}return n},createBalancedForest:function(e,t,n){var i,r,o,a,s,l,d,c,u,h,p;if(D.isUndefined(e)&&(e=3),D.isUndefined(t)&&(t=3),D.isUndefined(n)&&(n=5),i=new x.Graph,r=-1,o=[],0>=e||0>=t||0>=n)return i;for(s=0;n>s;s++)for(l=new y(""+ ++r),i.addNode(l),o=[l],d=0;e>d;d++){for(a=[],c=0;o.length>c;c++)for(u=o[c],h=0;t>h;h++)p=new y(""+ ++r),i.addLink(u,p),a.push(p);o=a}return i},createRandomConnectedGraph:function(e,t,n){var i,r,o,a,s,l,d,c,u,h;if(D.isUndefined(e)&&(e=40),D.isUndefined(t)&&(t=4),D.isUndefined(n)&&(n=!1),i=new x.Graph,r=-1,0>=e)return i;if(o=new y(""+ ++r),i.addNode(o),1===e)return i;if(e>1){for(a=1;e>a&&(s=i.takeRandomNode([],t),s);a++)l=i.addNode(""+a),i.addLink(s,l);if(!n&&e>1)for(d=D.randomInteger(1,e),c=0;d>c;c++)u=i.takeRandomNode([],t),h=i.takeRandomNode([],t),u&&h&&!i.areConnected(u,h)&&i.addLink(u,h);return i}},randomDiagram:function(e,t,n,i,r){var o=b.dataviz.diagram.Graph.Utils.createRandomConnectedGraph(t,n,i);k.Utils.createDiagramFromGraph(e,o,!1,r)}},b.deepExtend(x,{init:function(e){b.init(e,x.ui)},Point:A,Intersect:d,Geometry:f,Rect:s,Size:l,RectAlign:c,Matrix:h,MatrixVector:p,normalVariable:r,randomId:o,Dictionary:m,HashTable:g,Queue:v,Set:_,Node:y,Link:w,Graph:k,PathDefiner:a})}(window.kendo.jQuery),function(e,t){function n(e){return{x:e.x||0,y:e.y||0,width:e.width||0,height:e.height||0}}function i(e){if(e){var t=e;return H(t)&&(t={color:t}),t.color&&(t.color=r(t.color)),t}}function r(e){var t;return t=e!=W?new P.Color(e).toHex():e}function o(e,t){var n=t.x-e.x,i=t.y-e.y,r=P.util.deg(Math.atan2(i,n));return r}function a(e,t){var n,i,r,o=this.options,a=!1;for(r=0;t.length>r;r++)i=t[r],n=e[i],R(n)&&o[i]!==n&&(o[i]=n,a=!0);return a}var s,l,d,c,u,h,p,f,g,m,v,_,y,w,k,b,x,C,T,S,D=window.kendo,A=D.dataviz.diagram,E=D.Class,I=D.deepExtend,P=D.dataviz,M=A.Point,z=A.Rect,F=A.Matrix,L=A.Utils,R=L.isNumber,H=L.isString,B=A.MatrixVector,N=P.geometry,O=P.drawing,V=P.defined,U=e.inArray,W="transparent",j={none:"none",arrowStart:"ArrowStart",filledCircle:"FilledCircle",arrowEnd:"ArrowEnd"},q=360,G="start",Y="end",$="width",Q="height",K="x",X="y";A.Markers=j,s=E.extend({init:function(e,t){this.x=e,this.y=t},toMatrix:function(){return F.scaling(this.x,this.y)},toString:function(){return D.format("scale({0},{1})",this.x,this.y)},invert:function(){return new s(1/this.x,1/this.y)}}),l=E.extend({init:function(e,t){this.x=e,this.y=t},toMatrixVector:function(){return new B(0,0,0,0,this.x,this.y)},toMatrix:function(){return F.translation(this.x,this.y)},toString:function(){return D.format("translate({0},{1})",this.x,this.y)},plus:function(e){this.x+=e.x,this.y+=e.y},times:function(e){this.x*=e,this.y*=e},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){0!==this.Length&&this.times(1/this.length())},invert:function(){return new l(-this.x,-this.y)}}),d=E.extend({init:function(e,t,n){this.x=t||0,this.y=n||0,this.angle=e},toString:function(){return this.x&&this.y?D.format("rotate({0},{1},{2})",this.angle,this.x,this.y):D.format("rotate({0})",this.angle)},toMatrix:function(){return F.rotation(this.angle,this.x,this.y)},center:function(){return new M(this.x,this.y)},invert:function(){return new d(q-this.angle,this.x,this.y)}}),d.create=function(e){return new d(e.angle,e.x,e.y)},d.parse=function(e){var t=e.slice(1,e.length-1).split(","),n=t[0],i=t[1],r=t[2],o=new d(n,i,r);return o},c=E.extend({init:function(e,n,i,r,o,a){this.translate=new l(e,n),i!==t&&r!==t&&(this.scale=new s(i,r)),o!==t&&(this.rotate=a?new d(o,a.x,a.y):new d(o))},toString:function(){var e=function(e){return e?""+e:""};return e(this.translate)+e(this.rotate)+e(this.scale)},render:function(e){e._transform=this,e._renderTransform()},toMatrix:function(){var e=F.unit();return this.translate&&(e=e.times(this.translate.toMatrix())),this.rotate&&(e=e.times(this.rotate.toMatrix())),this.scale&&(e=e.times(this.scale.toMatrix())),e},invert:function(){var e,n,i=this.rotate?this.rotate.invert():t,r=i?i.toMatrix():F.unit(),o=this.scale?this.scale.invert():t,a=o?o.toMatrix():F.unit(),s=new M(-this.translate.x,-this.translate.y);return s=r.times(a).apply(s),e=new l(s.x,s.y),n=new c,n.translate=e,n.rotate=i,n.scale=o,n}}),u={_setScale:function(){var e=this.options,t=this._originWidth,n=this._originHeight,i=e.width/t,r=e.height/n;R(i)||(i=1),R(r)||(r=1),this._transform.scale=new s(i,r)},_setTranslate:function(){var e=this.options,t=e.x||0,n=e.y||0;this._transform.translate=new l(t,n)},_initSize:function(){var e=this.options,t=!1;e.autoSize!==!1&&(V(e.width)||V(e.height))&&(this._measure(!0),this._setScale(),t=!0),(V(e.x)||V(e.y))&&(this._setTranslate(),t=!0),t&&this._renderTransform()},_updateSize:function(e){var t=!1;return this.options.autoSize!==!1&&this._diffNumericOptions(e,[$,Q])&&(t=!0,this._measure(!0),this._setScale()),this._diffNumericOptions(e,[K,X])&&(t=!0,this._setTranslate()),t&&this._renderTransform(),t}},h=E.extend({init:function(e){var t=this;t.options=I({},t.options,e),t.id=t.options.id,t._originSize=z.empty(),t._transform=new c},visible:function(e){return this.drawingContainer().visible(e)},redraw:function(e){e&&e.id&&(this.id=e.id)},position:function(e,n){var i=this.options;return V(e)?(V(n)?(i.x=e,i.y=n):e instanceof M&&(i.x=e.x,i.y=e.y),this._transform.translate=new l(i.x,i.y),this._renderTransform(),t):new M(i.x,i.y)},rotate:function(e,t){return V(e)&&(this._transform.rotate=new d(e,t.x,t.y),this._renderTransform()),this._transform.rotate||new d(0)},drawingContainer:function(){return this.drawingElement},_renderTransform:function(){var e=this._transform.toMatrix();this.drawingContainer().transform(new N.Matrix(e.a,e.b,e.c,e.d,e.e,e.f))},_hover:function(){},_diffNumericOptions:a,_measure:function(e){var t,n,i;return!this._measured||e?(n=this._boundingBox()||new N.Rect,i=n.topLeft(),t=new z(i.x,i.y,n.width(),n.height()),this._originSize=t,this._originWidth=t.width,this._originHeight=t.height,this._measured=!0):t=this._originSize,t},_boundingBox:function(){return this.drawingElement.rawBBox()}}),p=h.extend({init:function(e){h.fn.init.call(this,e),e=this.options,e.fill=i(e.fill),e.stroke=i(e.stroke)},options:{stroke:{color:"gray",width:1},fill:{color:W}},fill:function(e,t){this._fill({color:r(e),opacity:t})},stroke:function(e,t,n){this._stroke({color:r(e),width:t,opacity:n})},redraw:function(e){var t,n;e&&(t=e.stroke,n=e.fill,t&&this._stroke(i(t)),n&&this._fill(i(n)),h.fn.redraw.call(this,e))},_hover:function(e){var t,n=this.drawingElement,r=this.options,o=r.hover;o&&o.fill&&(t=e?i(o.fill):r.fill,n.fill(t.color,t.opacity))},_stroke:function(e){var t,n=this.options;I(n,{stroke:e}),t=n.stroke,this.drawingElement.stroke(t.color,t.width,t.opacity)},_fill:function(e){var t,n=this.options;I(n,{fill:e}),t=n.fill,this.drawingElement.fill(t.color,t.opacity)}}),f=p.extend({init:function(e){this._textColor(e),p.fn.init.call(this,e),this._font(),this._initText(),this._initSize()},options:{fontSize:15,fontFamily:"sans-serif",stroke:{width:0},fill:{color:"black"},autoSize:!0},_initText:function(){var e=this.options;this.drawingElement=new O.Text(V(e.text)?e.text:"",new N.Point,{fill:e.fill,stroke:e.stroke,font:e.font})},_textColor:function(e){e&&e.color&&I(e,{fill:{color:e.color}})},_font:function(){var e=this.options;e.fontFamily&&V(e.fontSize)?e.font=e.fontSize+"px "+e.fontFamily:delete e.font},content:function(e){return this.drawingElement.content(e)},redraw:function(e){var t,n;e&&(t=!1,n=this.options,this._textColor(e),p.fn.redraw.call(this,e),(e.fontFamily||V(e.fontSize))&&(I(n,{fontFamily:e.fontFamily,fontSize:e.fontSize}),this._font(),this.drawingElement.options.set("font",n.font),t=!0),e.text&&(this.content(e.text),t=!0),!this._updateSize(e)&&t&&this._initSize())}}),I(f.fn,u),g=p.extend({init:function(e){p.fn.init.call(this,e),this._initPath(),this._setPosition()},_setPosition:function(){var e=this.options,t=e.x,n=e.y;(V(t)||V(n))&&this.position(t||0,n||0)},redraw:function(e){e&&(p.fn.redraw.call(this,e),this._diffNumericOptions(e,[$,Q])&&this._updatePath(),this._diffNumericOptions(e,[K,X])&&this._setPosition())},_initPath:function(){var e,t=this.options,n=t.width,i=t.height,r=this.drawingElement=new O.Path({fill:t.fill,stroke:t.stroke}),o=this._points=[new N.Point,new N.Point(n,0),new N.Point(n,i),new N.Point(0,i)];for(r.moveTo(o[0]),e=1;4>e;e++)r.lineTo(o[e]);r.close()},_updatePath:function(){var e=this._points,t=n(this.options),i=t.width,r=t.height;e[1].x=i,e[3].y=r,e[2].move(i,r)}}),m=p.extend({init:function(e){p.fn.init.call(this,e);var t=this.options.anchor;this.anchor=new N.Point(t.x,t.y),this.createElement()},options:{stroke:{color:W,width:0},fill:{color:"black"}},_transformToPath:function(e,t){var n=t.transform();return e&&n&&(e=e.transformCopy(n)),e},redraw:function(e){e&&(e.position&&(this.options.position=e.position),p.fn.redraw.call(this,e))}}),v=m.extend({options:{radius:4,anchor:{x:0,y:0}},createElement:function(){var e=this.options;this.drawingElement=new O.Circle(new N.Circle(this.anchor,e.radius),{fill:e.fill,stroke:e.stroke})},positionMarker:function(e){var t,n,i=this.options,r=i.position,o=e.segments;t=r==G?o[0]:o[o.length-1],t&&(n=this._transformToPath(t.anchor(),e),this.drawingElement.transform(N.transform().translate(n.x,n.y)))}}),_=m.extend({options:{path:"M 0 0 L 10 5 L 0 10 L 3 5 z",anchor:{x:10,y:5}},createElement:function(){var e=this.options;this.drawingElement=O.Path.parse(e.path,{fill:e.fill,stroke:e.stroke})},positionMarker:function(e){var t,n,i=this._linePoints(e),r=i.start,a=i.end,s=N.transform();r&&s.rotate(o(r,a),a),a&&(t=this.anchor,n=a.clone().translate(-t.x,-t.y),s.translate(n.x,n.y)),this.drawingElement.transform(s)},_linePoints:function(e){var n,i,r,o,a,s=this.options,l=e.segments;return s.position==G?(r=l[0],r&&(i=r.anchor(),n=r.controlOut(),o=l[1],!n&&o&&(n=o.anchor()))):(r=l[l.length-1],r&&(i=r.anchor(),n=r.controlIn(),a=l[l.length-2],!n&&a&&(n=a.anchor()))),i?{start:this._transformToPath(n,e),end:this._transformToPath(i,e)}:t}}),y={_getPath:function(e){var n=this.drawingElement;return n instanceof O.MultiPath&&(n=e==G?n.paths[0]:n.paths[n.paths.length-1]),n&&n.segments.length?n:t},_removeMarker:function(e){var t=this._markers[e];t&&(this.drawingContainer().remove(t.drawingElement),delete this._markers[e])},_createMarkers:function(){var e=this.options,t=e.startCap,n=e.endCap;this._markers={},this._markers[G]=this._createMarker(t,G),this._markers[Y]=this._createMarker(n,Y)},_createMarker:function(e,n){var i,r,o=this._getPath(n);return o?(e==j.filledCircle?i=v:e==j.arrowStart||e==j.arrowEnd?i=_:this._removeMarker(n),i?(r=new i({position:n}),r.positionMarker(o),this.drawingContainer().append(r.drawingElement),r):t):(this._removeMarker(n),t)},_positionMarker:function(e){var t,n=this._markers[e];n&&(t=this._getPath(e),t?n.positionMarker(t):this._removeMarker(e))},_capMap:{start:"startCap",end:"endCap"},_redrawMarker:function(e,t,n){var i=this.options,r=this._capMap[t],o=n[r],a=!1;return o&&i[r]!=o?(i[r]=o,this._removeMarker(t),this._markers[t]=this._createMarker(o,t),a=!0):e&&!this._markers[t]&&i[r]&&(this._markers[t]=this._createMarker(i[r],t),a=!0),a},_redrawMarkers:function(e,t){!this._redrawMarker(e,G,t)&&e&&this._positionMarker(G),!this._redrawMarker(e,Y,t)&&e&&this._positionMarker(Y)}},w=p.extend({init:function(e){p.fn.init.call(this,e),this.container=new O.Group,this._createElements(),this._initSize()},options:{autoSize:!0},drawingContainer:function(){return this.container},data:function(e){var n=this.options;return e?(n.data!=e&&(n.data=e,this._setData(e),this._initSize(),this._redrawMarkers(!0,{})),t):n.data},redraw:function(e){var t,n;e&&(p.fn.redraw.call(this,e),t=this.options,n=e.data,V(n)&&t.data!=n?(t.data=n,this._setData(n),this._updateSize(e)||this._initSize(),this._redrawMarkers(!0,e)):(this._updateSize(e),this._redrawMarkers(!1,e)))},_createElements:function(){var e=this.options;this.drawingElement=O.Path.parse(e.data||"",{fill:e.fill,stroke:e.stroke}),this.container.append(this.drawingElement),this._createMarkers()},_setData:function(e){var t,n=this.drawingElement,i=O.Path.parse(e||"").paths;for(n.paths=i,t=0;i.length>t;t++)i[t].observer=n;n.geometryChange()}}),I(w.fn,u),I(w.fn,y),k=p.extend({init:function(e){p.fn.init.call(this,e),this.container=new O.Group,this._initPath(),this._createMarkers()},drawingContainer:function(){return this.container},redraw:function(e){var t,n;e&&(e=e||{},t=e.from,n=e.to,t&&(this.options.from=t),n&&(this.options.to=n),t||n?(this._updatePath(),this._redrawMarkers(!0,e)):this._redrawMarkers(!1,e),p.fn.redraw.call(this,e))},_initPath:function(){var e=this.options,t=e.from||new M,n=e.to||new M,i=this.drawingElement=new O.Path({fill:e.fill,stroke:e.stroke});this._from=new N.Point(t.x,t.y),this._to=new N.Point(n.x,n.y),i.moveTo(this._from),i.lineTo(this._to),this.container.append(i)},_updatePath:function(){var e=this.options,t=e.from,n=e.to;this._from.x=t.x,this._from.y=t.y,this._to.move(n.x,n.y)}}),I(k.fn,y),b=p.extend({init:function(e){p.fn.init.call(this,e),this.container=new O.Group,this._initPath(),this._createMarkers()},drawingContainer:function(){return this.container},points:function(e){var n=this.options;return e?(n.points=e,this._updatePath(),t):n.points},redraw:function(e){if(e){var t=e.points;p.fn.redraw.call(this,e),t&&this._pointsDiffer(t)?(this.points(t),this._redrawMarkers(!0,e)):this._redrawMarkers(!1,e)}},_initPath:function(){var e=this.options;this.drawingElement=new O.Path({fill:e.fill,stroke:e.stroke}),this.container.append(this.drawingElement),e.points&&this._updatePath()},_pointsDiffer:function(e){var t,n=this.options.points,i=n.length!==e.length;if(!i)for(t=0;e.length>t;t++)if(n[t].x!==e[t].x||n[t].y!==e[t].y){i=!0;break}return i},_updatePath:function(){var e,t,n,i=this.drawingElement,r=this.options,o=r.points,a=i.segments=[];for(n=0;o.length>n;n++)e=o[n],t=new O.Segment(new N.Point(e.x,e.y)),t.observer=i,a.push(t);i.geometryChange()},options:{points:[]}}),I(b.fn,y),x=h.extend({init:function(e){h.fn.init.call(this,e),this._initImage()},redraw:function(e){e&&(e.source&&this.drawingElement.src(e.source),this._diffNumericOptions(e,[$,Q,K,X])&&this.drawingElement.rect(this._rect()),h.fn.redraw.call(this,e))},_initImage:function(){var e=this.options,t=this._rect();this.drawingElement=new O.Image(e.source,t,{})},_rect:function(){var e=n(this.options),t=new N.Point(e.x,e.y),i=new N.Size(e.width,e.height);return new N.Rect(t,i)}}),C=h.extend({init:function(e){this.children=[],h.fn.init.call(this,e),this.drawingElement=new O.Group,this._initSize()},options:{autoSize:!1},append:function(e){this.drawingElement.append(e.drawingContainer()),this.children.push(e),this._childrenChange=!0},remove:function(e){this._remove(e)&&(this._childrenChange=!0)},_remove:function(e){var n=U(e,this.children);return n>=0?(this.drawingElement.removeAt(n),this.children.splice(n,1),!0):t},clear:function(){this.drawingElement.clear(),this.children=[],this._childrenChange=!0},toFront:function(e){var t,n;for(n=0;e.length>n;n++)t=e[n],this._remove(t)&&this.append(t)},toBack:function(e){this._reorderChildren(e,0)},toIndex:function(e,t){this._reorderChildren(e,t)},_reorderChildren:function(e,t){var n,i,r,o,a,s=this.drawingElement,l=s.children.slice(0),d=this.children,c=R(t);for(n=0;e.length>n;n++)a=e[n],o=a.drawingContainer(),i=U(a,d),i>=0&&(l.splice(i,1),d.splice(i,1),r=c?t:t[n],l.splice(r,0,o),d.splice(r,0,a));s.clear(),s.append.apply(s,l)},redraw:function(e){e&&(this._childrenChange?(this._childrenChange=!1,this._updateSize(e)||this._initSize()):this._updateSize(e),h.fn.redraw.call(this,e))},_boundingBox:function(){var e,t,n,i,r=this.children;for(i=0;r.length>i;i++)t=r[i],t.visible()&&t._includeInBBox!==!1&&(n=t.drawingContainer().bbox(null),n&&(e=e?e.wrap(n):n));return e}}),I(C.fn,u),T=p.extend({init:function(e){p.fn.init.call(this,e),this._initCircle()},redraw:function(e){if(e){var t=this.options;e.center&&(I(t,{center:e.center}),this._center.move(t.center.x,t.center.y)),this._diffNumericOptions(e,["radius"])&&this._circle.setRadius(t.radius),p.fn.redraw.call(this,e)}},_initCircle:function(){var e,t=this.options,n=t.width,i=t.height,r=t.radius;V(r)||(V(n)||(n=i),V(i)||(i=n),t.radius=r=Math.min(n,i)/2),e=t.center||{x:r,y:r},this._center=new N.Point(e.x,e.y),this._circle=new N.Circle(this._center,r),this.drawingElement=new O.Circle(this._circle,{fill:t.fill,stroke:t.stroke})}}),S=E.extend({init:function(e,t){t=t||{},this.element=e,this.surface=O.Surface.create(e,t),D.isFunction(this.surface.translate)&&(this.translate=this._translate),this.drawingElement=new O.Group,this._viewBox=new z(0,0,t.width,t.height),this.size(this._viewBox)},bounds:function(){var e=this.drawingElement.bbox();return new z(0,0,e.width(),e.height())},size:function(e){var t=this._viewBox;return V(e)&&(t.width=e.width,t.height=e.height,this.surface.setSize(e)),{width:t.width,height:t.height}},_translate:function(e,t){var n=this._viewBox;return V(e)&&V(t)&&(n.x=e,n.y=t,this.surface.translate({x:e,y:t})),{x:n.x,y:n.y}},draw:function(){this.surface.draw(this.drawingElement)},append:function(e){return this.drawingElement.append(e.drawingContainer()),this},remove:function(e){this.drawingElement.remove(e.drawingContainer())},insertBefore:function(){},clear:function(){this.drawingElement.clear()},destroy:function(t){this.surface.destroy(),t&&e(this.element).remove()}}),D.deepExtend(A,{init:function(e){D.init(e,A.ui)},diffNumericOptions:a,Element:h,Scale:s,Translation:l,Rotation:d,Circle:T,Group:C,Rectangle:g,Canvas:S,Path:w,Line:k,MarkerBase:m,ArrowMarker:_,CircleMarker:v,Polyline:b,CompositeTransform:c,TextBlock:f,Image:x,VisualBase:p})}(window.kendo.jQuery),function(e,t){function n(e,t){e.isSelected?t.ctrlKey&&e.select(!1):e.diagram.select(e,{addToSelection:t.ctrlKey})}function i(e,t){return t.charCodeAt(0)==e||t.toUpperCase().charCodeAt(0)==e}function r(e,t){var n;return-1==e.x&&-1==e.y?n=t.bottomRight():1==e.x&&1==e.y?n=t.topLeft():-1==e.x&&1==e.y?n=t.topRight():1==e.x&&-1==e.y?n=t.bottomLeft():0===e.x&&-1==e.y?n=t.bottom():0===e.x&&1==e.y?n=t.top():1==e.x&&0===e.y?n=t.left():-1==e.x&&0===e.y&&(n=t.right()),n}var o,a,s,l,d,c,u,h,p,f,g,m,v,_,y,w,k,b,x,C,T,S,D,A,E,I,P,M,z,F,L,R,H=window.kendo,B=H.dataviz,N=B.diagram,O=H.Class,V=N.Group,U=N.Rect,W=N.Rectangle,j=N.Utils,q=j.isUndefined,G=N.Point,Y=N.Circle,$=N.Path,Q=N.Ticker,K=H.deepExtend,X=H.ui.Movable,Z=H.support.browser,J=B.defined,et=e.proxy,tt={arrow:"default",grip:"pointer",cross:"pointer",add:"pointer",move:"move",select:"pointer",south:"s-resize",east:"e-resize",west:"w-resize",north:"n-resize",rowresize:"row-resize",colresize:"col-resize"},nt=10,it="Auto",rt="Top",ot="Right",at="Left",st="Bottom",lt=[rt,ot,st,at,it],dt="itemRotate",ct="itemBoundsChange",ut="zoomStart",ht="zoomEnd",pt=-2e4,ft=2e4,gt=.9,mt=.93,vt=5,_t="transparent",yt="pan";N.Cursors=tt,o=H.Class.extend({init:function(e){this.layoutState=e,this.diagram=e.diagram},initState:function(){function e(e,t){var n=this.diagram.getShapeById(e);n&&(this.subjects.push(n),this.froms.push(n.bounds().topLeft()),this.tos.push(t.topLeft()))}this.froms=[],this.tos=[],this.subjects=[],this.layoutState.nodeMap.forEach(e,this)},update:function(e){if(!(0>=this.subjects.length))for(var t=0;this.subjects.length>t;t++)this.subjects[t].position(new G(this.froms[t].x+(this.tos[t].x-this.froms[t].x)*e,this.froms[t].y+(this.tos[t].y-this.froms[t].y)*e))}}),a=O.extend({init:function(e,t,n){this.animate=q(n)?!1:n,this._initialState=e,this._finalState=t,this.title="Diagram layout"},undo:function(){this.setState(this._initialState)},redo:function(){this.setState(this._finalState)},setState:function(e){var t,n=e.diagram;this.animate?(e.linkMap.forEach(function(e,t){var i=n.getShapeById(e);i.visible(!1),i&&i.points(t)}),t=new Q,t.addAdapter(new o(e)),t.onComplete(function(){e.linkMap.forEach(function(e){var t=n.getShapeById(e);t.visible(!0)})}),t.play()):(e.nodeMap.forEach(function(e,t){var i=n.getShapeById(e);i&&i.position(t.topLeft())}),e.linkMap.forEach(function(e,t){var i=n.getShapeById(e);i&&i.points(t)}))}}),s=O.extend({init:function(e){this.units=[],this.title="Composite unit",e!==t&&this.units.push(e)},add:function(e){this.units.push(e)},undo:function(){for(var e=0;this.units.length>e;e++)this.units[e].undo()},redo:function(){for(var e=0;this.units.length>e;e++)this.units[e].redo()}}),l=O.extend({init:function(e,t,n){this.item=e,this._redoSource=t,this._redoTarget=n,this._undoSource=e.source(),this._undoTarget=e.target(),this.title="Connection Editing"},undo:function(){this._undoSource!==t&&this.item.source(this._undoSource,!1),this._undoTarget!==t&&this.item.target(this._undoTarget,!1)},redo:function(){this._redoSource!==t&&this.item.source(this._redoSource,!1),this._redoTarget!==t&&this.item.target(this._redoTarget,!1)}}),d=O.extend({init:function(e,t,n){this.item=e,this._undoSource=t,this._undoTarget=n,this._redoSource=e.source(),this._redoTarget=e.target(),this.title="Connection Editing"},undo:function(){this.item.source(this._undoSource,!1),this.item.target(this._undoTarget,!1)},redo:function(){this.item.source(this._redoSource,!1),this.item.target(this._redoTarget,!1)}}),c=O.extend({init:function(e){this.connection=e,this.diagram=e.diagram,this.targetConnector=e.targetConnector,this.title="Delete connection"},undo:function(){this.diagram.addConnection(this.connection,!1)},redo:function(){this.diagram.remove(this.connection,!1)}}),u=O.extend({init:function(e){this.shape=e,this.diagram=e.diagram,this.title="Deletion"},undo:function(){this.diagram.addShape(this.shape,{undoable:!1}),this.shape.select(!1)},redo:function(){this.shape.select(!1),this.diagram.remove(this.shape,!1)}}),h=O.extend({init:function(e,t,n){var i,r;for(this.shapes=e,this.undoStates=t,this.title="Transformation",this.redoStates=[],this.adorner=n,i=0;this.shapes.length>i;i++)r=this.shapes[i],this.redoStates.push(r.bounds())},undo:function(){var e,t;for(e=0;this.shapes.length>e;e++)t=this.shapes[e],t.bounds(this.undoStates[e]),t.hasOwnProperty("layout")&&t.layout(t,this.redoStates[e],this.undoStates[e]);this.adorner&&(this.adorner.refreshBounds(),this.adorner.refresh())},redo:function(){var e,t;for(e=0;this.shapes.length>e;e++)t=this.shapes[e],t.bounds(this.redoStates[e]),t.hasOwnProperty("layout")&&t.layout(t,this.undoStates[e],this.redoStates[e]);this.adorner&&(this.adorner.refreshBounds(),this.adorner.refresh())}}),p=O.extend({init:function(e,t){this.connection=e,this.diagram=t,this.title="New connection"},undo:function(){this.diagram.remove(this.connection,!1)},redo:function(){this.diagram.addConnection(this.connection,!1)}}),f=O.extend({init:function(e,t){this.shape=e,this.diagram=t,this.title="New shape"},undo:function(){this.diagram.remove(this.shape,!1)},redo:function(){this.diagram.addShape(this.shape,{undoable:!1})}}),g=O.extend({init:function(e,t,n){this.initial=e,this.finalPos=t,this.diagram=n,this.title="Pan Unit"},undo:function(){this.diagram.pan(this.initial)},redo:function(){this.diagram.pan(this.finalPos)}}),m=O.extend({init:function(e,t,n){var i,r;for(this.shapes=t,this.undoRotates=n,this.title="Rotation",this.redoRotates=[],this.redoAngle=e._angle,this.adorner=e,this.center=e._innerBounds.center(),i=0;this.shapes.length>i;i++)r=this.shapes[i],this.redoRotates.push(r.rotate().angle)},undo:function(){var e,t;for(e=0;this.shapes.length>e;e++)t=this.shapes[e],t.rotate(this.undoRotates[e],this.center),t.hasOwnProperty("layout")&&t.layout(t);this.adorner&&(this.adorner._initialize(),this.adorner.refresh())},redo:function(){var e,t;for(e=0;this.shapes.length>e;e++)t=this.shapes[e],t.rotate(this.redoRotates[e],this.center),t.hasOwnProperty("layout")&&t.layout(t);this.adorner&&(this.adorner._initialize(),this.adorner.refresh())}}),v=O.extend({init:function(e,t,n){this.diagram=e,this.indices=n,this.items=t,this.title="Rotate Unit"},undo:function(){this.diagram._toIndex(this.items,this.indices)},redo:function(){this.diagram.toFront(this.items,!1)}}),_=O.extend({init:function(e,t,n){this.diagram=e,this.indices=n,this.items=t,this.title="Rotate Unit"},undo:function(){this.diagram._toIndex(this.items,this.indices)},redo:function(){this.diagram.toBack(this.items,!1)}}),y=O.extend({init:function(){this.stack=[],this.index=0,this.capacity=100},begin:function(){this.composite=new s},cancel:function(){this.composite=t},commit:function(){this.composite.units.length>0&&this._restart(this.composite),this.composite=t},addCompositeItem:function(e){this.composite?this.composite.add(e):this.add(e)},add:function(e,t){this._restart(e,t)},count:function(){return this.stack.length},undo:function(){this.index>0&&(this.index--,this.stack[this.index].undo())},redo:function(){this.stack.length>0&&this.stack.length>this.index&&(this.stack[this.index].redo(),this.index++)},_restart:function(e,t){this.stack.splice(this.index,this.stack.length-this.index),this.stack.push(e),q(t)||t&&t===!0?this.redo():this.index++,this.stack.length>this.capacity&&(this.stack.splice(0,this.stack.length-this.capacity),this.index=this.capacity)},clear:function(){this.stack=[],this.index=0}}),w=O.extend({init:function(e){this.toolService=e},start:function(){},move:function(){},end:function(){},tryActivate:function(){return!1},getCursor:function(){return tt.arrow}}),k=w.extend({init:function(t){var n,i,r,o,a=this,s=H.support.mobileOS?mt:gt;w.fn.init.call(a,t),n=a.toolService.diagram,i=n.canvas,r=n.scroller=a.scroller=e(n.scrollable).kendoMobileScroller({friction:s,velocityMultiplier:vt,mousewheelScrolling:!1,zoom:!1,scroll:et(a._move,a)}).data("kendoMobileScroller"),i.translate&&(a.movableCanvas=new X(i.element)),o=function(e,t,n){e.makeVirtual(),e.virtualSize(t||pt,n||ft)},o(r.dimensions.x),o(r.dimensions.y),r.disable()},tryActivate:function(e,n){return this.toolService.hoveredItem===t&&n.ctrlKey},start:function(){this.scroller.enable()},move:function(){},_move:function(e){var t=this,n=t.toolService.diagram,i=n.canvas,r=new G(e.scrollLeft,e.scrollTop);i.translate?(n._storePan(r.times(-1)),t.movableCanvas.moveTo(r),i.translate(r.x,r.y)):r=r.plus(n._pan.times(-1)),n.trigger(yt,{pan:r})},end:function(){this.scroller.disable()},getCursor:function(){return tt.move}}),b=O.extend({init:function(e){this.toolService=e},tryActivate:function(){return!0},start:function(e,t){var i=this.toolService,r=i.diagram,o=i.hoveredItem,a=r.options.selectable!==!1;o&&(a&&n(o,t),o.adorner&&(this.adorner=o.adorner,this.handle=this.adorner._hitTest(e))),this.handle||(this.handle=r._resizingAdorner._hitTest(e),this.handle&&(this.adorner=r._resizingAdorner)),this.adorner&&this.adorner.start(e)},move:function(e){var t=this;this.adorner&&this.adorner.move(t.handle,e)},end:function(e,n){var i,r=this.toolService.diagram,o=this.toolService;this.adorner&&(i=this.adorner.stop(),i&&r.undoRedoService.add(i,!1)),o.hoveredItem&&this.toolService.triggerClick({item:o.hoveredItem,point:e,meta:n}),this.adorner=t,this.handle=t},getCursor:function(e){return this.toolService.hoveredItem?this.toolService.hoveredItem._getCursor(e):tt.arrow}}),x=O.extend({init:function(e){this.toolService=e},tryActivate:function(){var e=this.toolService,t=e.diagram,n=t.options.selectable!==!1;return n&&!J(e.hoveredItem)&&!J(e.hoveredAdorner)},start:function(e){var t=this.toolService.diagram;t.deselect(),t.selector.start(e)},move:function(e){var t=this.toolService.diagram;t.selector.move(e)},end:function(e,t){var n=this.toolService.diagram,i=this.toolService.hoveredItem,r=n.selector.bounds();i&&i.isSelected||t.ctrlKey||n.deselect(),r.isEmpty()||n.selectArea(r),n.selector.end()},getCursor:function(){return tt.arrow}}),C=O.extend({init:function(e){this.toolService=e,this.type="ConnectionTool"},tryActivate:function(e,t){return this.toolService._hoveredConnector&&!t.ctrlKey},start:function(e,t){var i=this.toolService.diagram,r=this.toolService._hoveredConnector,o=i.connect(r._c,e);this.toolService._connectionManipulation(o,r._c.shape,!0),this.toolService._removeHover(),n(this.toolService.activeConnection,t)
},move:function(e){return this.toolService.activeConnection.target(e),!0},end:function(){var e=this.toolService.activeConnection,t=this.toolService.hoveredItem,n=this.toolService._hoveredConnector;n&&n._c!=e.sourceConnector?e.target(n._c):t&&e.target(t),this.toolService._connectionManipulation()},getCursor:function(){return tt.arrow}}),T=O.extend({init:function(e){this.toolService=e,this.type="ConnectionTool"},tryActivate:function(){var e=this.toolService,t=e.diagram,n=t.options.selectable!==!1,i=e.hoveredItem,r=n&&i&&i.path;return r&&(this._c=i),r},start:function(e,t){n(this._c,t),this.handle=this._c.adorner._hitTest(e),this._c.adorner.start(e)},move:function(e){return this._c.adorner.move(this.handle,e),!0},end:function(e,t){this.toolService.triggerClick({item:this._c,point:e,meta:t});var n=this._c.adorner.stop(e);this.toolService.diagram.undoRedoService.add(n,!1)},getCursor:function(){return tt.move}}),S=O.extend({init:function(e){this.diagram=e,this.tools=[new k(this),new T(this),new C(this),new x(this),new b(this)],this.activeTool=t},start:function(e,t){return t=K({},t),this.activeTool&&this.activeTool.end(e,t),this._updateHoveredItem(e),this._activateTool(e,t),this.activeTool.start(e,t),this._updateCursor(e),this.diagram.focus(),this.startPoint=e,!0},move:function(e,t){t=K({},t);var n=!0;return this.activeTool&&(n=this.activeTool.move(e,t)),n&&this._updateHoveredItem(e),this._updateCursor(e),!0},end:function(e,n){return n=K({},n),this.activeTool&&this.activeTool.end(e,n),this.activeTool=t,this._updateCursor(e),!0},keyDown:function(e,t){var n=this.diagram;if(t=K({ctrlKey:!1,metaKey:!1,altKey:!1},t),!t.ctrlKey&&!t.metaKey||t.altKey){if(46===e||8===e)return n.remove(n.select(),!0),!0;if(27===e)return this._discardNewConnection(),n.deselect(),!0}else{if(i(e,"a"))return n.selectAll(),!0;if(i(e,"z"))return n.undo(),!0;if(i(e,"y"))return n.redo(),!0;i(e,"c")?n.copy():i(e,"x")?n.cut():i(e,"v")?n.paste():i(e,"l")?n.layout():i(e,"d")&&(n.copy(),n.paste())}},wheel:function(e,t){var n=this.diagram,i=t.delta,r=n.zoom(),o=n.options,a=o.zoomRate,s={point:e,meta:t,zoom:r};return n.trigger(ut,s),0>i?r+=a:r-=a,r=H.dataviz.round(Math.max(o.minZoom,Math.min(o.maxZoom,r)),2),s.zoom=r,n.zoom(r,s),n.trigger(ht,s),!0},setTool:function(e,t){e.toolService=this,this.tools[t]=e},triggerClick:function(e){this.startPoint.equals(e.point)&&this.diagram.trigger("click",e)},_discardNewConnection:function(){this.newConnection&&(this.diagram.remove(this.newConnection),this.newConnection=t)},_activateTool:function(e,t){var n,i;for(n=0;this.tools.length>n;n++)if(i=this.tools[n],i.tryActivate(e,t)){this.activeTool=i;break}},_updateCursor:function(e){var t=this.diagram.element,n=this.activeTool?this.activeTool.getCursor(e):this.hoveredAdorner?this.hoveredAdorner._getCursor(e):this.hoveredItem?this.hoveredItem._getCursor(e):tt.arrow;t.css({cursor:n}),Z.msie&&7==Z.version&&(t[0].style.cssText=t[0].style.cssText)},_connectionManipulation:function(e,n,i){this.activeConnection=e,this.disabledShape=n,this.newConnection=i?this.activeConnection:t},_updateHoveredItem:function(e){var n=this._hitTest(e);n==this.hoveredItem||this.disabledShape&&n==this.disabledShape||(this.hoveredItem&&this.hoveredItem._hover(!1),n&&n.options.enable?(this.hoveredItem=n,this.hoveredItem._hover(!0)):this.hoveredItem=t)},_removeHover:function(){this.hoveredItem&&(this.hoveredItem._hover(!1),this.hoveredItem=t)},_hitTest:function(e){var n,i,r,o,a=this.diagram;if(this._hoveredConnector&&(this._hoveredConnector._hover(!1),this._hoveredConnector=t),a._connectorsAdorner._visible&&(n=a._connectorsAdorner._hitTest(e)))return n;if(n=this.diagram._resizingAdorner._hitTest(e)){if(this.hoveredAdorner=a._resizingAdorner,0!==n.x&&0!==n.y)return;n=t}else this.hoveredAdorner=t;if(!this.activeTool||"ConnectionTool"!==this.activeTool.type){for(o=[],r=0;a._selectedItems.length>r;r++)i=a._selectedItems[r],i instanceof N.Connection&&o.push(i);n=this._hitTestItems(o,e)}return n||this._hitTestItems(a.shapes,e)||this._hitTestItems(a.connections,e)},_hitTestItems:function(e,t){var n,i,r;for(n=e.length-1;n>=0;n--)if(i=e[n],r=i._hitTest(t))return r}}),D=H.Class.extend({init:function(){}}),A=D.extend({init:function(e){var t=this;D.fn.init.call(t),this.connection=e},hitTest:function(e){var t=this.getBounds().inflate(10);return t.contains(e)?N.Geometry.distanceToPolyline(e,this.connection.allPoints())<nt:!1},getBounds:function(){var e,t=this.connection.allPoints(),n=t[0],i=t[t.length-1],r=Math.max(n.x,i.x),o=Math.min(n.x,i.x),a=Math.min(n.y,i.y),s=Math.max(n.y,i.y);for(e=1;t.length-1>e;++e)r=Math.max(r,t[e].x),o=Math.min(o,t[e].x),a=Math.min(a,t[e].y),s=Math.max(s,t[e].y);return new U(o,a,r-o,s-a)}}),E=A.extend({init:function(e){var t=this;A.fn.init.call(t),this.connection=e},route:function(){}}),I=A.extend({init:function(e){var t=this;A.fn.init.call(t),this.connection=e},route:function(){function e(){if(null!==u){if(u===ot||u===at)return!0;if(u===rt||u===st)return!1}return Math.abs(o.x-a.x)>Math.abs(o.y-a.y)}var t,n,i,r=this.connection,o=this.connection.sourcePoint(),a=this.connection.targetPoint(),s=[o,o,a,a],l=a.x-o.x,d=a.y-o.y,c=s.length,u=null,h=null;if(j.isDefined(r._resolvedSourceConnector)&&(u=r._resolvedSourceConnector.options.name),j.isDefined(r._resolvedTargetConnector)&&(h=r._resolvedTargetConnector.options.name),null!==u&&null!==h&&j.contains(lt,u)&&j.contains(lt,h))this.connection.points(u===rt||u==st?h==rt||h==st?[new G(o.x,o.y+d/2),new G(a.x,o.y+d/2)]:[new G(o.x,o.y+d)]:h==at||h==ot?[new G(o.x+l/2,o.y),new G(o.x+l/2,o.y+d)]:[new G(a.x,o.y)]);else{for(this.connection.cascadeStartHorizontal=e(this.connection),i=1;c-1>i;++i)r.cascadeStartHorizontal?i%2!==0?(t=l/(c/2),n=0):(t=0,n=d/((c-1)/2)):i%2!==0?(t=0,n=d/(c/2)):(t=l/((c-1)/2),n=0),s[i]=new G(s[i-1].x+t,s[i-1].y+n);i--,s[c-2]=r.cascadeStartHorizontal&&i%2!==0||!r.cascadeStartHorizontal&&i%2===0?new G(s[c-1].x,s[c-2].y):new G(s[c-2].x,s[c-1].y),this.connection.points([s[1],s[2]])}}}),P=O.extend({init:function(e,t){var n=this;n.diagram=e,n.options=K({},n.options,t),n.visual=new V,n.diagram._adorners.push(n)},refresh:function(){}}),M=P.extend({init:function(e,t){var n,i,r,o=this;o.connection=e,n=o.connection.diagram,o._ts=n.toolService,P.fn.init.call(o,n,t),i=o.connection.sourcePoint(),r=o.connection.targetPoint(),o.spVisual=new Y(K(o.options.handles,{center:i})),o.epVisual=new Y(K(o.options.handles,{center:r})),o.visual.append(o.spVisual),o.visual.append(o.epVisual)},options:{handles:{}},_getCursor:function(){return tt.move},start:function(e){switch(this.handle=this._hitTest(e),this.startPoint=e,this._initialSource=this.connection.source(),this._initialTarget=this.connection.target(),this.handle){case-1:this.connection.targetConnector&&this._ts._connectionManipulation(this.connection,this.connection.targetConnector.shape);break;case 1:this.connection.sourceConnector&&this._ts._connectionManipulation(this.connection,this.connection.sourceConnector.shape)}},move:function(e,t){switch(e){case-1:this.connection.source(t);break;case 1:this.connection.target(t);break;default:var n=t.minus(this.startPoint);this.startPoint=t,this.connection.sourceConnector||this.connection.source(this.connection.sourcePoint().plus(n)),this.connection.targetConnector||this.connection.target(this.connection.targetPoint().plus(n))}return this.refresh(),!0},stop:function(e){var n,i=this.diagram.toolService,r=i.hoveredItem;if(n=i._hoveredConnector?i._hoveredConnector._c:r&&!r.line?r:e,this.handle!==t)switch(this.handle){case-1:this.connection.source(n);break;case 1:this.connection.target(n)}return this.handle=t,this._ts._connectionManipulation(),new d(this.connection,this._initialSource,this._initialTarget)},_hitTest:function(e){var t=this.connection.sourcePoint(),n=this.connection.targetPoint(),i=this.options.handles.width/2,r=this.options.handles.height/2,o=new U(t.x,t.y).inflate(i,r),a=new U(n.x,n.y).inflate(i,r);return o.contains(e)?-1:a.contains(e)?1:0},refresh:function(){this.spVisual.redraw({center:this.diagram.modelToLayer(this.connection.sourcePoint())}),this.epVisual.redraw({center:this.diagram.modelToLayer(this.connection.targetPoint())})}}),z=P.extend({init:function(e,t){var n=this;P.fn.init.call(n,e,t),n._refreshHandler=function(e){e.item==n.shape&&n.refresh()}},show:function(e){var t,n,i,r=this;for(r._visible=!0,r.shape=e,r.diagram.bind(ct,r._refreshHandler),t=e.connectors.length,r.connectors=[],r.visual.clear(),n=0;t>n;n++)i=new R(e.connectors[n]),r.connectors.push(i),r.visual.append(i.visual);r.visual.visible(!0),r.refresh()},destroy:function(){var e=this;e.diagram.unbind(ct,e._refreshHandler),e.shape=t,e._visible=t,e.visual.visible(!1)},_hitTest:function(e){var t,n;for(n=0;this.connectors.length>n;n++)if(t=this.connectors[n],t._hitTest(e)){t._hover(!0),this.diagram.toolService._hoveredConnector=t;break}},refresh:function(){if(this.shape){var t=this.shape.bounds();t=this.diagram.modelToLayer(t),this.visual.position(t.topLeft()),e.each(this.connectors,function(){this.refresh()})}}}),F=P.extend({init:function(e,t){var n=this;P.fn.init.call(n,e,t),n._manipulating=!1,n.map=[],n.shapes=[],n._initSelection(),n._createHandles(),n._createThumb(),n.redraw(),n.diagram.bind("select",function(e){n._initialize(e.selected)}),n._refreshHandler=function(){n._internalChange||(n.refreshBounds(),n.refresh())},n._rotatedHandler=function(){1==n.shapes.length&&(n._angle=n.shapes[0].rotate().angle),n._refreshHandler()},n.diagram.bind(ct,n._refreshHandler).bind(dt,n._rotatedHandler),n.refreshBounds(),n.refresh()},options:{editable:{rotate:{thumb:{data:"M7.115,16C3.186,16,0,12.814,0,8.885C0,5.3,2.65,2.336,6.099,1.843V0l4.85,2.801l-4.85,2.8V3.758 c-2.399,0.473-4.21,2.588-4.21,5.126c0,2.886,2.34,5.226,5.226,5.226s5.226-2.34,5.226-5.226c0-1.351-0.513-2.582-1.354-3.51 l1.664-0.961c0.988,1.222,1.581,2.777,1.581,4.472C14.23,12.814,11.045,16,7.115,16L7.115,16z",y:-30}}},selectable:{stroke:{color:"#778899",width:1,dashType:"dash"},fill:{color:_t}},offset:10},_initSelection:function(){var e=this,t=e.diagram,n=t.options.selectable,i=K({},e.options.selectable,n);e.rect=new W(i),e.visual.append(e.rect)},_createThumb:function(){var e=this,t=e.options.editable,n=t.rotate;t&&n&&(e.rotationThumb=new $(n.thumb),e.visual.append(e.rotationThumb))},_createHandles:function(){var e,t,n,i,r=this.options.editable;if(r&&r.resize)for(e=r.resize.handles,i=-1;1>=i;i++)for(n=-1;1>=n;n++)(0!==i||0!==n)&&(t=new W(e),t.drawingElement._hover=et(this._hover,this),this.map.push({x:i,y:n,visual:t}),this.visual.append(t))},bounds:function(e){return e?(this._innerBounds=e.clone(),this._bounds=this.diagram.modelToLayer(e).inflate(this.options.offset,this.options.offset),t):this._bounds},_hitTest:function(e){var n,i,r,o,a=this.diagram.modelToLayer(e),s=this.options.editable,l=this.map.length;if(this._angle&&(a=a.clone().rotate(this._bounds.center(),this._angle)),s&&s.rotate&&this._rotationThumbBounds&&this._rotationThumbBounds.contains(a))return new G(-1,-2);if(s&&s.resize)for(n=0;l>n;n++)if(o=this.map[n],i=new G(o.x,o.y),r=this._getHandleBounds(i),r.offset(this._bounds.x,this._bounds.y),r.contains(a))return i;return this._bounds.contains(a)?new G(0,0):t},_getHandleBounds:function(e){var n,i,r,o,a=this.options.editable;return a&&a.resize?(n=a.resize.handles||{},i=n.width,r=n.height,o=new U(0,0,i,r),0>e.x?o.x=-i/2:0===e.x?o.x=Math.floor(this._bounds.width/2)-i/2:e.x>0&&(o.x=this._bounds.width+1-i/2),0>e.y?o.y=-r/2:0===e.y?o.y=Math.floor(this._bounds.height/2)-r/2:e.y>0&&(o.y=this._bounds.height+1-r/2),o):t},_getCursor:function(e){var t,n=this._hitTest(e);if(n&&n.x>=-1&&1>=n.x&&n.y>=-1&&1>=n.y&&this.options.editable&&this.options.editable.resize){if(t=this._angle,t&&(t=360-t,n.rotate(new G(0,0),t),n=new G(Math.round(n.x),Math.round(n.y))),-1==n.x&&-1==n.y)return"nw-resize";if(1==n.x&&1==n.y)return"se-resize";if(-1==n.x&&1==n.y)return"sw-resize";if(1==n.x&&-1==n.y)return"ne-resize";if(0===n.x&&-1==n.y)return"n-resize";if(0===n.x&&1==n.y)return"s-resize";if(1==n.x&&0===n.y)return"e-resize";if(-1==n.x&&0===n.y)return"w-resize"}return this._manipulating?tt.move:tt.select},_initialize:function(){var e,t,n=this,i=n.diagram.select();for(n.shapes=[],e=0;i.length>e;e++)t=i[e],t instanceof N.Shape&&(n.shapes.push(t),t._rotationOffset=new G);n._angle=1==n.shapes.length?n.shapes[0].rotate().angle:0,n._startAngle=n._angle,n._rotates(),n._positions(),n.refreshBounds(),n.refresh(),n.redraw()},_rotates:function(){var e,t,n=this;for(n.initialRotates=[],e=0;n.shapes.length>e;e++)t=n.shapes[e],n.initialRotates.push(t.rotate().angle)},_positions:function(){var e,t,n=this;for(n.initialStates=[],e=0;n.shapes.length>e;e++)t=n.shapes[e],n.initialStates.push(t.bounds())},_hover:function(e,t){var n,i,r,o,a=this.options.editable;a&&a.resize&&(n=a.resize.handles,i=n.hover,r=n.stroke,o=n.fill,e&&j.isDefined(i.stroke)&&(r=K({},r,i.stroke)),e&&j.isDefined(i.fill)&&(o=i.fill),t.stroke(r.color,r.width,r.opacity),t.fill(o.color,o.opacity))},start:function(e){var t,n;for(this._sp=e,this._cp=e,this._lp=e,this._manipulating=!0,this._internalChange=!0,this.shapeStates=[],t=0;this.shapes.length>t;t++)n=this.shapes[t],this.shapeStates.push(n.bounds())},redraw:function(){var e,t,n=this,i=n.options.editable,r=i.resize,o=i.rotate,a=i&&r?!0:!1,s=i&&o?!0:!1;for(e=0;this.map.length>e;e++)t=this.map[e],t.visual.visible(a);n.rotationThumb&&n.rotationThumb.visible(s)},move:function(e,n){var i,o,a,s,l,d,c,u,h,p,f,g,m,v,_=new G,y=new G,w=0;if(-2===e.y&&-1===e.x){for(s=this._innerBounds.center(),this._angle=this._truncateAngle(j.findAngle(s,n)),d=0;this.shapes.length>d;d++)l=this.shapes[d],c=(this._angle+this.initialRotates[d]-this._startAngle)%360,l.rotate(c,s),l.hasOwnProperty("layout")&&l.layout(l),this._rotating=!0;this.refresh()}else{if(this.diagram.options.snap.enabled===!0){if(g=this._truncateDistance(n.minus(this._lp)),0===g.x&&0===g.y)return this._cp=n,t;i=g,this._lp=new G(this._lp.x+g.x,this._lp.y+g.y)}else i=n.minus(this._cp);for(0===e.x&&0===e.y?(y=_=i,o=!0):(this._angle&&i.rotate(new G(0,0),this._angle),-1==e.x?_.x=i.x:1==e.x&&(y.x=i.x),-1==e.y?_.y=i.y:1==e.y&&(y.y=i.y)),o||(h=r(e,this._innerBounds),p=(this._innerBounds.width+i.x*e.x)/this._innerBounds.width,f=(this._innerBounds.height+i.y*e.y)/this._innerBounds.height),d=0;this.shapes.length>d;d++)l=this.shapes[d],a=l.bounds(),o?u=this._displaceBounds(a,_,y,o):(u=a.clone(),u.scale(p,f,h,this._innerBounds.center(),l.rotate().angle),m=u.center(),m.rotate(a.center(),-this._angle),u=new U(m.x-u.width/2,m.y-u.height/2,u.width,u.height)),u.width>=l.options.minWidth&&u.height>=l.options.minHeight&&(v=a,l.bounds(u),l.hasOwnProperty("layout")&&l.layout(l,v,u),l.rotate(l.rotate().angle),w+=1);w==d&&(u=this._displaceBounds(this._innerBounds,_,y,o),this.bounds(u),this.refresh()),this._positions()}this._cp=n},_truncatePositionToGuides:function(e){return this.diagram.ruler?this.diagram.ruler.truncatePositionToGuides(e):e},_truncateSizeToGuides:function(e){return this.diagram.ruler?this.diagram.ruler.truncateSizeToGuides(e):e},_truncateAngle:function(e){var t=Math.max(this.diagram.options.snap.angle,5);return this.diagram.options.snap.enabled===!0?Math.floor(e%360/t)*t:e%360},_truncateDistance:function(e){if(e instanceof N.Point)return new N.Point(this._truncateDistance(e.x),this._truncateDistance(e.y));var t=Math.max(this.diagram.options.snap.size,5);return this.diagram.options.snap.enabled===!0?Math.floor(e/t)*t:e},_displaceBounds:function(e,t,n,i){var r,o=e.topLeft().plus(t),a=e.bottomRight().plus(n),s=U.fromPoints(o,a);return i||(r=s.center(),r.rotate(e.center(),-this._angle),s=new U(r.x-s.width/2,r.y-s.height/2,s.width,s.height)),s},stop:function(){var e,n,i,r;if(this._cp!=this._sp)if(this._rotating)e=new m(this,this.shapes,this.initialRotates),this._rotating=!1;else{if(this.diagram.ruler)for(n=0;this.shapes.length>n;n++)i=this.shapes[n],r=i.bounds(),r=this._truncateSizeToGuides(this._truncatePositionToGuides(r)),i.bounds(r),this.refreshBounds(),this.refresh();e=new h(this.shapes,this.shapeStates,this)}return this._manipulating=t,this._internalChange=t,this._rotating=t,e},refreshBounds:function(){var e=1==this.shapes.length?this.shapes[0].bounds().clone():this.diagram.boundingBox(this.shapes,!0);this.bounds(e)},refresh:function(){var t,n,i,r,o=this;this.shapes.length>0?(n=this.bounds(),this.visual.visible(!0),this.visual.position(n.topLeft()),e.each(this.map,function(){t=o._getHandleBounds(new G(this.x,this.y)),this.visual.position(t.topLeft())}),this.visual.position(n.topLeft()),i=new G(n.width/2,n.height/2),this.visual.rotate(this._angle,i),this.rect.redraw({width:n.width,height:n.height}),this.rotationThumb&&(r=this.options.editable.rotate.thumb,this._rotationThumbBounds=new U(n.center().x,n.y+r.y,0,0).inflate(r.width),this.rotationThumb.redraw({x:n.width/2-r.width/2}))):this.visual.visible(!1)}}),L=O.extend({init:function(e){var t=e.options.selectable;this.options=K({},this.options,t),this.visual=new W(this.options),this.diagram=e},options:{stroke:{color:"#778899",width:1,dashType:"dash"},fill:{color:_t}},start:function(e){this._sp=this._ep=e,this.refresh(),this.diagram._adorn(this,!0)},end:function(){this._sp=this._ep=t,this.diagram._adorn(this,!1)},bounds:function(e){return e&&(this._bounds=e),this._bounds},move:function(e){this._ep=e,this.refresh()},refresh:function(){if(this._sp){var e=U.fromPoints(this.diagram.modelToLayer(this._sp),this.diagram.modelToLayer(this._ep));this.bounds(U.fromPoints(this._sp,this._ep)),this.visual.position(e.topLeft()),this.visual.redraw({height:e.height+1,width:e.width+1})}}}),R=O.extend({init:function(e){this.options=K({},e.options),this._c=e,this.visual=new Y(this.options),this.refresh()},_hover:function(e){var t=this.options,n=t.hover,i=t.stroke,r=t.fill;e&&j.isDefined(n.stroke)&&(i=K({},i,n.stroke)),e&&j.isDefined(n.fill)&&(r=n.fill),this.visual.redraw({stroke:i,fill:r})},refresh:function(){var e=this._c.shape.diagram.modelToView(this._c.position()),t=e.minus(this._c.shape.bounds("transformed").topLeft()),n=new U(e.x,e.y,0,0);n.inflate(this.options.width/2,this.options.height/2),this._visualBounds=n,this.visual.redraw({center:new G(t.x,t.y)})},_hitTest:function(e){var t=this._c.shape.diagram.modelToView(e);return this._visualBounds.contains(t)}}),K(N,{CompositeUnit:s,TransformUnit:h,PanUndoUnit:g,AddShapeUnit:f,AddConnectionUnit:p,DeleteShapeUnit:u,DeleteConnectionUnit:c,ConnectionEditAdorner:M,UndoRedoService:y,ResizingAdorner:F,Selector:L,ToolService:S,ConnectorsAdorner:z,LayoutUndoUnit:a,ConnectionEditUnit:l,ToFrontUnit:v,ToBackUnit:_,ConnectionRouterBase:D,PolylineRouter:E,CascadingRouter:I,SelectionTool:x,PointerTool:b,ConnectionEditTool:T})}(window.kendo.jQuery),function(e){var t=window.kendo,n=t.dataviz.diagram,i=n.Graph,r=n.Node,o=n.Link,a=t.deepExtend,s=n.Size,l=n.Rect,d=n.Dictionary,c=n.Set,u=n.Graph,h=n.Utils,p=n.Point,f=1e-6,g=Math.PI/180,m=h.contains,v=e.grep,_=t.Class.extend({defaultOptions:{type:"Tree",subtype:"Down",roots:null,animate:!1,limitToView:!1,friction:.9,nodeDistance:50,iterations:300,horizontalSeparation:90,verticalSeparation:50,underneathVerticalTopOffset:15,underneathHorizontalOffset:15,underneathVerticalSeparation:15,grid:{width:1500,offsetX:50,offsetY:50,componentSpacingX:20,componentSpacingY:20},layerSeparation:50,layeredIterations:2,startRadialAngle:0,endRadialAngle:360,radialSeparation:150,radialFirstLevelSeparation:200,keepComponentsInOneRadialLayout:!1,ignoreContainers:!0,layoutContainerChildren:!1,ignoreInvisible:!0,animateTransitions:!1},init:function(){},gridLayoutComponents:function(e){var t,n,i,r,o,a,s,l,d,c,u,f,g,m,v;if(!e)throw"No components supplied.";for(h.forEach(e,function(e){e.calcBounds()}),e.sort(function(e,t){return t.bounds.width-e.bounds.width}),t=this.options.grid.width,n=this.options.grid.componentSpacingX,i=this.options.grid.componentSpacingY,r=0,o=this.options.grid.offsetX,a=this.options.grid.offsetY,s=o,l=a,c=[],u=[];e.length>0;){for(s>=t&&(s=o,l+=r+i,r=0),f=e.pop(),this.moveToOffset(f,new p(s,l)),d=0;f.nodes.length>d;d++)u.push(f.nodes[d]);for(d=0;f.links.length>d;d++)c.push(f.links[d]);g=f.bounds,m=g.height,(0>=m||isNaN(m))&&(m=0),v=g.width,(0>=v||isNaN(v))&&(v=0),m>=r&&(r=m),s+=v+n}return{nodes:u,links:c}},moveToOffset:function(e,t){var n,i,r,o,a,s,d,c,u=e.bounds,h=t.x-u.x,f=t.y-u.y;for(n=0;e.nodes.length>n;n++)r=e.nodes[n],o=r.bounds(),0===o.width&&0===o.height&&0===o.x&&0===o.y&&(o=new l(0,0,0,0)),o.x+=h,o.y+=f,r.bounds(o);for(n=0;e.links.length>n;n++)if(a=e.links[n],a.points){for(s=[],d=a.points,i=0;d.length>i;i++)c=d[i],c.x+=h,c.y+=f,s.push(c);a.points=s}return this.currentHorizontalOffset+=u.width+this.options.grid.offsetX,new p(h,f)},transferOptions:function(e){this.options=t.deepExtend({},this.defaultOptions),h.isUndefined(e)||(this.options=t.deepExtend(this.options,e||{}))}}),y=t.Class.extend({init:function(e){this.nodeMap=new d,this.shapeMap=new d,this.nodes=[],this.edges=[],this.edgeMap=new d,this.finalNodes=[],this.finalLinks=[],this.ignoredConnections=[],this.ignoredShapes=[],this.hyperMap=new d,this.hyperTree=new i,this.finalGraph=null,this.diagram=e},convert:function(e){if(h.isUndefined(this.diagram))throw"No diagram to convert.";return this.options=t.deepExtend({ignoreInvisible:!0,ignoreContainers:!0,layoutContainerChildren:!1},e||{}),this.clear(),this._renormalizeShapes(),this._renormalizeConnections(),this.finalNodes=new d(this.nodes),this.finalLinks=new d(this.edges),this.finalGraph=new i,this.finalNodes.forEach(function(e){this.finalGraph.addNode(e)},this),this.finalLinks.forEach(function(e){this.finalGraph.addExistingLink(e)},this),this.finalGraph},mapConnection:function(e){return this.edgeMap.first(function(t){return m(this.edgeMap.get(t),e)})},mapShape:function(e){var t,n,i,r=this.nodeMap.keys();for(t=0,n=r.length;n>t;t++)if(i=r[t],m(this.nodeMap.get(i),e))return i},getEdge:function(e,t){return h.first(e.links,function(n){return n.getComplement(e)===t})},clear:function(){this.finalGraph=null,this.hyperTree=!this.options.ignoreContainers&&this.options.layoutContainerChildren?new u:null,this.hyperMap=!this.options.ignoreContainers&&this.options.layoutContainerChildren?new d:null,this.nodeMap=new d,this.shapeMap=new d,this.nodes=[],this.edges=[],this.edgeMap=new d,this.ignoredConnections=[],this.ignoredShapes=[],this.finalNodes=[],this.finalLinks=[]},listToRoot:function(e){var t=[],n=e.container;if(!n)return t;for(t.push(n);n.parentContainer;)n=n.parentContainer,t.push(n);return t.reverse(),t},firstNonIgnorableContainer:function(e){return e.isContainer&&!this._isIgnorableItem(e)?e:e.parentContainer?this.firstNonIgnorableContainer(e.parentContainer):null},isContainerConnection:function(e,t){return e.isContainer&&this.isDescendantOf(e,t)?!0:t.isContainer&&this.isDescendantOf(t,e)},isDescendantOf:function(e,t){var n,i,r,o;if(!e.isContainer)throw"Expecting a container.";if(e===t)return!1;if(m(e.children,t))return!0;for(n=[],i=0,r=e.children.length;r>i;i++)o=e.children[i],o.isContainer&&this.isDescendantOf(o,t)&&n.push(o);return n.length>0},isIgnorableItem:function(e){return this.options.ignoreInvisible?e.isCollapsed&&this._isVisible(e)?!1:!e.isCollapsed&&this._isVisible(e)?!1:!0:e.isCollapsed&&!this._isTop(e)},isShapeMapped:function(e){return e.isCollapsed&&!this._isVisible(e)&&!this._isTop(e)},leastCommonAncestor:function(e,t){var n,i,r,o,a,s;if(!e)throw"Parameter should not be null.";if(!t)throw"Parameter should not be null.";if(!this.hyperTree)throw"No hypertree available.";if(n=this.listToRoot(e),i=this.listToRoot(t),r=null,h.isEmpty(n)||h.isEmpty(i))return this.hyperTree.root.data;for(o=n[0],a=i[0],s=0;o===a&&(r=n[s],s++,!(s>=n.length||s>=i.length));)o=n[s],a=i[s];return r?v(this.hyperTree.nodes,function(e){return e.data.container===r}):this.hyperTree.root.data},_isTop:function(e){return!e.parentContainer},_isVisible:function(e){return e.visible()?e.parentContainer?this._isVisible(e.parentContainer):e.visible():!1},_isCollapsed:function(e){return e.isContainer&&e.isCollapsed?!0:e.parentContainer&&this._isCollapsed(e.parentContainer)},_renormalizeShapes:function(){var e,t,n,i;if(!this.options.ignoreContainers)throw"Containers are not supported yet, but stay tuned.";for(e=0,t=this.diagram.shapes.length;t>e;e++)n=this.diagram.shapes[e],this.options.ignoreInvisible&&!this._isVisible(n)||n.isContainer?this.ignoredShapes.push(n):(i=new r(n.id,n),i.isVirtual=!1,this.nodeMap.add(i,[n]),this.nodes.push(i))},_renormalizeConnections:function(){var e,t,n,i,r,a,s,l;if(0!==this.diagram.connections.length)for(e=0,t=this.diagram.connections.length;t>e;e++)if(n=this.diagram.connections[e],this.isIgnorableItem(n))this.ignoredConnections.push(n);else if(i=n.sourceConnector?n.sourceConnector.shape:null,r=n.targetConnector?n.targetConnector.shape:null,i&&r)if(!m(this.ignoredShapes,i)||this.shapeMap.containsKey(i))if(!m(this.ignoredShapes,r)||this.shapeMap.containsKey(r))if(this.shapeMap.containsKey(i)&&(i=this.shapeMap[i]),this.shapeMap.containsKey(r)&&(r=this.shapeMap[r]),a=this.mapShape(i),s=this.mapShape(r),a===s||this.areConnectedAlready(a,s))this.ignoredConnections.push(n);else{if(null===a||null===s)throw"A shape was not mapped to a node.";if(!this.options.ignoreContainers)throw"Containers are not supported yet, but stay tuned.";a.isVirtual||s.isVirtual?this.ignoredConnections.push(n):(l=new o(a,s,n.id,n),this.edgeMap.add(l,[n]),this.edges.push(l))}else this.ignoredConnections.push(n);else this.ignoredConnections.push(n);else this.ignoredConnections.push(n)},areConnectedAlready:function(e,t){return h.any(this.edges,function(n){return n.source===e&&n.target===t||n.source===t&&n.target===e})}}),w=_.extend({init:function(e){var t=this;if(_.fn.init.call(t),h.isUndefined(e))throw"Diagram is not specified.";this.diagram=e},layout:function(e){var t,i,r,o,a,s;if(this.transferOptions(e),t=new y(this.diagram),i=t.convert(e),!i.isEmpty()&&(r=i.getConnectedComponents(),!h.isEmpty(r))){for(o=0;r.length>o;o++)a=r[o],this.layoutGraph(a,e);return s=this.gridLayoutComponents(r),new n.LayoutState(this.diagram,s)}},layoutGraph:function(e,t){var n,i,r;for(h.isDefined(t)&&this.transferOptions(t),this.graph=e,n=9*this.options.nodeDistance,this.temperature=n,i=this._expectedBounds(),this.width=i.width,this.height=i.height,r=0;this.options.iterations>r;r++)this.refineStage=r>=5*this.options.iterations/6,this.tick(),this.temperature=this.refineStage?n/30:n*(1-r/(2*this.options.iterations))},tick:function(){var e,t,n;for(e=0;this.graph.nodes.length>e;e++)this._repulsion(this.graph.nodes[e]);for(e=0;this.graph.links.length>e;e++)this._attraction(this.graph.links[e]);for(e=0;this.graph.nodes.length>e;e++){if(t=this.graph.nodes[e],n=Math.sqrt(t.dx*t.dx+t.dy*t.dy),0===n)return;t.x+=Math.min(n,this.temperature)*t.dx/n,t.y+=Math.min(n,this.temperature)*t.dy/n,this.options.limitToView&&(t.x=Math.min(this.width,Math.max(t.width/2,t.x)),t.y=Math.min(this.height,Math.max(t.height/2,t.y)))}},_shake:function(e){var t=Math.random()*this.options.nodeDistance/4,n=2*Math.random()*Math.PI;e.x+=t*Math.cos(n),e.y-=t*Math.sin(n)},_InverseSquareForce:function(e,t,n){var i,r,o,a,s,l,d;return this.refineStage?(r=t.x-n.x,o=t.y-n.y,a=t.width/2,s=t.height/2,l=n.width/2,d=n.height/2,i=Math.pow(r,2)/Math.pow(a+l+this.options.nodeDistance,2)+Math.pow(o,2)/Math.pow(s+d+this.options.nodeDistance,2)):i=Math.pow(e,2)/Math.pow(this.options.nodeDistance,2),4*i/3},_SquareForce:function(e,t,n){return 1/this._InverseSquareForce(e,t,n)},_repulsion:function(e){e.dx=0,e.dy=0,h.forEach(this.graph.nodes,function(t){var n,i,r,o;if(t!==e){for(;e.x===t.x&&e.y===t.y;)this._shake(t);n=e.x-t.x,i=e.y-t.y,r=Math.sqrt(n*n+i*i),o=2*this._SquareForce(r,e,t),e.dx+=n/r*o,e.dy+=i/r*o}},this)},_attraction:function(e){var t,n,i,r,o,a,s=e.target,l=e.source;if(l!==s){for(;l.x===s.x&&l.y===s.y;)this._shake(s);t=l.x-s.x,n=l.y-s.y,i=Math.sqrt(t*t+n*n),r=5*this._InverseSquareForce(i,l,s),o=t/i*r,a=n/i*r,s.dx+=o,s.dy+=a,l.dx-=o,l.dy-=a}},_expectedBounds:function(){var e,t,n,i,r,o=this.graph.nodes.length,a=1.5,s=4;return 0===o?e:(e=h.fold(this.graph.nodes,function(e,t){var n=t.width*t.height;return n>0?e+=Math.sqrt(n):0},0,this),t=e/o,n=t*Math.ceil(Math.sqrt(o)),i=n*Math.sqrt(a),r=n/Math.sqrt(a),{width:i*s,height:r*s})}}),k=t.Class.extend({init:function(e){this.center=null,this.options=e},layout:function(e,t){if(this.graph=e,this.graph.nodes&&0!==this.graph.nodes.length){if(!m(this.graph.nodes,t))throw"The given root is not in the graph.";this.center=t,this.graph.cacheRelationships(),this.layoutSwitch()}},layoutLeft:function(e){var t,n,i,r,o,a,l,d;for(this.setChildrenDirection(this.center,"Left",!1),this.setChildrenLayout(this.center,"Default",!1),t=0,n=0,r=0;e.length>r;r++)o=e[r],o.TreeDirection="Left",a=this.measure(o,s.Empty),n=Math.max(n,a.Width),t+=a.height+this.options.verticalSeparation;for(t-=this.options.verticalSeparation,l=this.center.x-this.options.horizontalSeparation,i=this.center.y+(this.center.height-t)/2,r=0;e.length>r;r++)o=e[r],d=new p(l-o.Size.width,i),this.arrange(o,d),i+=o.Size.height+this.options.verticalSeparation},layoutRight:function(e){var t,n,i,r,o,a,l,d;for(this.setChildrenDirection(this.center,"Right",!1),this.setChildrenLayout(this.center,"Default",!1),t=0,n=0,r=0;e.length>r;r++)o=e[r],o.TreeDirection="Right",a=this.measure(o,s.Empty),n=Math.max(n,a.Width),t+=a.height+this.options.verticalSeparation;for(t-=this.options.verticalSeparation,l=this.center.x+this.options.horizontalSeparation+this.center.width,i=this.center.y+(this.center.height-t)/2,r=0;e.length>r;r++)o=e[r],d=new p(l,i),this.arrange(o,d),i+=o.Size.height+this.options.verticalSeparation},layoutUp:function(e){var t,n,i,r,o,a,l;for(this.setChildrenDirection(this.center,"Up",!1),this.setChildrenLayout(this.center,"Default",!1),t=0,r=0;e.length>r;r++)i=e[r],i.TreeDirection="Up",o=this.measure(i,s.Empty),t+=o.width+this.options.horizontalSeparation;for(t-=this.options.horizontalSeparation,a=this.center.x+this.center.width/2-t/2,r=0;e.length>r;r++)i=e[r],n=this.center.y-this.options.verticalSeparation-i.Size.height,l=new p(a,n),this.arrange(i,l),a+=i.Size.width+this.options.horizontalSeparation},layoutDown:function(e){var t,n,i,r,o,a,l;for(this.setChildrenDirection(this.center,"Down",!1),this.setChildrenLayout(this.center,"Default",!1),i=0,n=0;e.length>n;n++)t=e[n],t.treeDirection="Down",o=this.measure(t,s.Empty),i+=o.width+this.options.horizontalSeparation;for(i-=this.options.horizontalSeparation,a=this.center.x+this.center.width/2-i/2,r=this.center.y+this.options.verticalSeparation+this.center.height,n=0;e.length>n;n++)t=e[n],l=new p(a,r),this.arrange(t,l),a+=t.Size.width+this.options.horizontalSeparation},layoutRadialTree:function(){var e,t;if(this.setChildrenDirection(this.center,"Radial",!1),this.setChildrenLayout(this.center,"Default",!1),this.previousRoot=null,e=this.options.startRadialAngle*g,t=this.options.endRadialAngle*g,e>=t)throw"Final angle should not be less than the start angle.";this.maxDepth=0,this.origin=new p(this.center.x,this.center.y),this.calculateAngularWidth(this.center,0),this.maxDepth>0&&this.radialLayout(this.center,this.options.radialFirstLevelSeparation,e,t),this.center.Angle=t-e},tipOverTree:function(e,t){var n,i,r,o,a,l,d;for(h.isUndefined(t)&&(t=0),this.setChildrenDirection(this.center,"Down",!1),this.setChildrenLayout(this.center,"Default",!1),this.setChildrenLayout(this.center,"Underneath",!1,t),n=0,o=0;e.length>o;o++)r=e[o],r.TreeDirection="Down",a=this.measure(r,s.Empty),n+=a.width+this.options.horizontalSeparation;for(n-=this.options.horizontalSeparation,n-=e[e.length-1].width,n+=e[e.length-1].associatedShape.bounds().width,l=this.center.x+this.center.width/2-n/2,i=this.center.y+this.options.verticalSeparation+this.center.height,o=0;e.length>o;o++)r=e[o],d=new p(l,i),this.arrange(r,d),l+=r.Size.width+this.options.horizontalSeparation},calculateAngularWidth:function(e,t){var n,i,r,o,a,s,l;if(t>this.maxDepth&&(this.maxDepth=t),n=0,i=1e3,r=1e3,o=0===t?0:Math.sqrt(i*i+r*r)/t,e.children.length>0){for(a=0,s=e.children.length;s>a;a++)l=e.children[a],n+=this.calculateAngularWidth(l,t+1);
n=Math.max(o,n)}else n=o;return e.sectorAngle=n,n},sortChildren:function(e){var t,n,i,r,o,a,s,l,d,c,u,f=0;if(e.parents.length>1)throw"Node is not part of a tree.";if(n=e.parents[0],n&&(i=new p(n.x,n.y),r=new p(e.x,e.y),f=this.normalizeAngle(Math.atan2(i.y-r.y,i.x-r.x))),o=e.children.length,0===o)return null;for(a=[],s=[],t=0;o>t;++t)l=e.children[t],d=new p(l.x,l.y),s[t]=t,a[t]=this.normalizeAngle(-f+Math.atan2(d.y-d.y,d.x-d.x));for(h.bisort(a,s),c=[],u=e.children,t=0;o>t;++t)c.push(u[s[t]]);return c},normalizeAngle:function(e){for(;e>2*Math.PI;)e-=2*Math.PI;for(;0>e;)e+=2*Math.PI;return e},radialLayout:function(e,t,n,i){var r,o,a,s,l,d=i-n,c=d/2,u=e.sectorAngle,h=0,p=this.sortChildren(e);for(r=0,o=p.length;o>r;r++)a=p[r],s=a,l=s.sectorAngle/u,a.children.length>0&&this.radialLayout(a,t+this.options.radialSeparation,n+h*d,n+(h+l)*d),this.setPolarLocation(a,t,n+h*d+l*c),s.angle=l*d,h+=l},setPolarLocation:function(e,t,n){e.x=this.origin.x+t*Math.cos(n),e.y=this.origin.y+t*Math.sin(n),e.BoundingRectangle=new l(e.x,e.y,e.width,e.height)},setChildrenDirection:function(e,t,n){var i=e.treeDirection;this.graph.depthFirstTraversal(e,function(e){e.treeDirection=t}),n||(e.treeDirection=i)},setChildrenLayout:function(e,t,n,i){h.isUndefined(i)&&(i=0);var r=e.childrenLayout;i>0?(this.graph.assignLevels(e),this.graph.depthFirstTraversal(e,function(e){e.level>=i+1&&(e.childrenLayout=t)})):(this.graph.depthFirstTraversal(e,function(e){e.childrenLayout=t}),n||(e.childrenLayout=r))},measure:function(e,t){var n,i,r,o,a,l,d,c=0,u=0,p=new s(0,0);if(!e)throw"";if(i=e.associatedShape.bounds(),r=i.width,o=i.height,1!==e.parents.length)throw"Node not in a spanning tree.";if(a=e.parents[0],"Undefined"===e.treeDirection&&(e.treeDirection=a.treeDirection),h.isEmpty(e.children))p=new s(Math.abs(r)<f?50:r,Math.abs(o)<f?25:o);else if(1===e.children.length){switch(e.treeDirection){case"Radial":n=this.measure(e.children[0],t),c=r+this.options.radialSeparation*Math.cos(e.AngleToParent)+n.width,u=o+Math.abs(this.options.radialSeparation*Math.sin(e.AngleToParent))+n.height;break;case"Left":case"Right":switch(e.childrenLayout){case"TopAlignedWithParent":break;case"BottomAlignedWithParent":break;case"Underneath":n=this.measure(e.children[0],t),c=r+n.width+this.options.underneathHorizontalOffset,u=o+this.options.underneathVerticalTopOffset+n.height;break;case"Default":n=this.measure(e.children[0],t),c=r+this.options.horizontalSeparation+n.width,u=Math.max(o,n.height);break;default:throw"Unhandled TreeDirection in the Radial layout measuring."}break;case"Up":case"Down":switch(e.childrenLayout){case"TopAlignedWithParent":case"BottomAlignedWithParent":break;case"Underneath":n=this.measure(e.children[0],t),c=Math.max(r,n.width+this.options.underneathHorizontalOffset),u=o+this.options.underneathVerticalTopOffset+n.height;break;case"Default":n=this.measure(e.children[0],t),u=o+this.options.verticalSeparation+n.height,c=Math.max(r,n.width);break;default:throw"Unhandled TreeDirection in the Down layout measuring."}break;default:throw"Unhandled TreeDirection in the layout measuring."}p=new s(c,u)}else{switch(e.treeDirection){case"Left":case"Right":switch(e.childrenLayout){case"TopAlignedWithParent":case"BottomAlignedWithParent":break;case"Underneath":for(c=r,u=o+this.options.underneathVerticalTopOffset,l=0;e.children.length>l;l++)d=e.children[l],n=this.measure(d,t),c=Math.max(c,n.width+this.options.underneathHorizontalOffset),u+=n.height+this.options.underneathVerticalSeparation;u-=this.options.underneathVerticalSeparation;break;case"Default":for(c=r,u=0,l=0;e.children.length>l;l++)d=e.children[l],n=this.measure(d,t),c=Math.max(c,r+this.options.horizontalSeparation+n.width),u+=n.height+this.options.verticalSeparation;u-=this.options.verticalSeparation;break;default:throw"Unhandled TreeDirection in the Right layout measuring."}break;case"Up":case"Down":switch(e.childrenLayout){case"TopAlignedWithParent":case"BottomAlignedWithParent":break;case"Underneath":for(c=r,u=o+this.options.underneathVerticalTopOffset,l=0;e.children.length>l;l++)d=e.children[l],n=this.measure(d,t),c=Math.max(c,n.width+this.options.underneathHorizontalOffset),u+=n.height+this.options.underneathVerticalSeparation;u-=this.options.underneathVerticalSeparation;break;case"Default":for(c=0,u=0,l=0;e.children.length>l;l++)d=e.children[l],n=this.measure(d,t),c+=n.width+this.options.horizontalSeparation,u=Math.max(u,n.height+this.options.verticalSeparation+o);c-=this.options.horizontalSeparation;break;default:throw"Unhandled TreeDirection in the Down layout measuring."}break;default:throw"Unhandled TreeDirection in the layout measuring."}p=new s(c,u)}return e.SectorAngle=Math.sqrt(c*c/4+u*u/4),e.Size=p,p},arrange:function(e,t){var n,i,r,o,a,s,d,c,u=e.associatedShape.bounds(),g=u.width,m=u.height;if(h.isEmpty(e.children))e.x=t.x,e.y=t.y,e.BoundingRectangle=new l(t.x,t.y,g,m);else switch(e.treeDirection){case"Left":switch(e.childrenLayout){case"TopAlignedWithParent":case"BottomAlignedWithParent":break;case"Underneath":for(c=t,e.x=c.x,e.y=c.y,e.BoundingRectangle=new l(e.x,e.y,e.width,e.height),d=t.y+m+this.options.underneathVerticalTopOffset,n=0;o.children.length>n;n++)o=o.children[n],s=c.x-o.associatedShape.width-this.options.underneathHorizontalOffset,i=new p(s,d),this.arrange(o,i),d+=o.Size.height+this.options.underneathVerticalSeparation;break;case"Default":for(c=new p(t.x+e.Size.width-g,t.y+(e.Size.height-m)/2),e.x=c.x,e.y=c.y,e.BoundingRectangle=new l(e.x,e.y,e.width,e.height),s=c.x-this.options.horizontalSeparation,d=t.y,n=0;e.children.length>n;n++)o=e.children[n],i=new p(s-o.Size.width,d),this.arrange(o,i),d+=o.Size.height+this.options.verticalSeparation;break;default:throw"Unsupported TreeDirection"}break;case"Right":switch(e.childrenLayout){case"TopAlignedWithParent":case"BottomAlignedWithParent":break;case"Underneath":for(c=t,e.x=c.x,e.y=c.y,e.BoundingRectangle=new l(e.x,e.y,e.width,e.height),s=t.x+g+this.options.underneathHorizontalOffset,d=t.y+m+this.options.underneathVerticalTopOffset,n=0;e.children.length>n;n++)o=e.children[n],i=new p(s,d),this.arrange(o,i),d+=o.Size.height+this.options.underneathVerticalSeparation;break;case"Default":for(c=new p(t.x,t.y+(e.Size.height-m)/2),e.x=c.x,e.y=c.y,e.BoundingRectangle=new l(e.x,e.y,e.width,e.height),s=t.x+g+this.options.horizontalSeparation,d=t.y,n=0;e.children.length>n;n++)o=e.children[n],i=new p(s,d),this.arrange(o,i),d+=o.Size.height+this.options.verticalSeparation;break;default:throw"Unsupported TreeDirection"}break;case"Up":if(c=new p(t.x+(e.Size.width-g)/2,t.y+e.Size.height-m),e.x=c.x,e.y=c.y,e.BoundingRectangle=new l(e.x,e.y,e.width,e.height),Math.abs(c.x-t.x)<f){for(a=0,n=0;e.children.length>n;n++)r=e.children[n],a+=r.Size.width+this.options.horizontalSeparation;a-=this.options.horizontalSeparation,s=t.x+(g-a)/2}else s=t.x;for(n=0;e.children.length>n;n++)o=e.children[n],d=c.y-this.options.verticalSeparation-o.Size.height,i=new p(s,d),this.arrange(o,i),s+=o.Size.width+this.options.horizontalSeparation;break;case"Down":switch(e.childrenLayout){case"TopAlignedWithParent":case"BottomAlignedWithParent":break;case"Underneath":for(c=t,e.x=c.x,e.y=c.y,e.BoundingRectangle=new l(e.x,e.y,e.width,e.height),s=t.x+this.options.underneathHorizontalOffset,d=t.y+m+this.options.underneathVerticalTopOffset,n=0;e.children.length>n;n++)o=e.children[n],i=new p(s,d),this.arrange(o,i),d+=o.Size.height+this.options.underneathVerticalSeparation;break;case"Default":if(c=new p(t.x+(e.Size.width-g)/2,t.y),e.x=c.x,e.y=c.y,e.BoundingRectangle=new l(e.x,e.y,e.width,e.height),Math.abs(c.x-t.x)<f){for(a=0,n=0;e.children.length>n;n++)r=e.children[n],a+=r.Size.width+this.options.horizontalSeparation;a-=this.options.horizontalSeparation,s=t.x+(g-a)/2}else s=t.x;for(n=0;e.children.length>n;n++)o=e.children[n],d=c.y+this.options.verticalSeparation+m,i=new p(s,d),this.arrange(o,i),s+=o.Size.width+this.options.horizontalSeparation;break;default:throw"Unsupported TreeDirection"}break;case"None":break;default:throw"Unsupported TreeDirection"}},layoutSwitch:function(){var e,t,n,i,r,o;if(this.center&&!h.isEmpty(this.center.children))switch(e=this.options.subtype,h.isUndefined(e)&&(e="Down"),o=this.center.children,e.toLowerCase()){case"radial":case"radialtree":this.layoutRadialTree();break;case"mindmaphorizontal":case"mindmap":t=this.center.children,1===this.center.children.length?this.layoutRight(t):(r=o.length/2,n=v(this.center.children,function(e){return h.indexOf(o,e)<r}),i=v(this.center.children,function(e){return h.indexOf(o,e)>=r}),this.layoutLeft(n),this.layoutRight(i));break;case"mindmapvertical":t=this.center.children,1===this.center.children.length?this.layoutDown(t):(r=o.length/2,n=v(this.center.children,function(e){return h.indexOf(o,e)<r}),i=v(this.center.children,function(e){return h.indexOf(o,e)>=r}),this.layoutUp(n),this.layoutDown(i));break;case"right":this.layoutRight(this.center.children);break;case"left":this.layoutLeft(this.center.children);break;case"up":case"bottom":this.layoutUp(this.center.children);break;case"down":case"top":this.layoutDown(this.center.children);break;case"tipover":case"tipovertree":if(0>this.options.tipOverTreeStartLevel)throw"The tip-over level should be a positive integer.";this.tipOverTree(this.center.children,this.options.tipOverTreeStartLevel);break;case"undefined":case"none":}}}),b=_.extend({init:function(e){var t=this;if(_.fn.init.call(t),h.isUndefined(e))throw"No diagram specified.";this.diagram=e},layout:function(e){var t,i;return this.transferOptions(e),t=new y(this.diagram),this.graph=t.convert(),i=this.layoutComponents(),new n.LayoutState(this.diagram,i)},layoutComponents:function(){var e,t,n,i,r,o,a,s;if(!this.graph.isEmpty()&&(e=this.graph.getConnectedComponents(),!h.isEmpty(e))){for(t=new k(this.options),n=[],i=0;e.length>i;i++){if(r=e[i],o=this.getTree(r),!o)throw"Failed to find a spanning tree for the component.";a=o.root,s=o.tree,t.layout(s,a),n.push(s)}return this.gridLayoutComponents(n)}},getTree:function(e){var t,n,i,r,o,a=null;if(this.options.roots&&this.options.roots.length>0)for(t=0,n=e.nodes.length;n>t;t++)for(i=e.nodes[t],r=0;this.options.roots.length>r;r++)if(o=this.options.roots[r],o===i.associatedShape){a=i;break}if(!a&&(a=e.root(),!a))throw"Unable to find a root for the tree.";return this.getTreeForRoot(e,a)},getTreeForRoot:function(e,t){var n=e.getSpanningTree(t);return h.isUndefined(n)||n.isEmpty()?null:{tree:n,root:n.root}}}),x=_.extend({init:function(e){var t=this;if(_.fn.init.call(t),h.isUndefined(e))throw"Diagram is not specified.";this.diagram=e},layout:function(e){var t,i,r,o,a,s;if(this.transferOptions(e),t=new y(this.diagram),i=t.convert(e),!i.isEmpty()&&(r=i.getConnectedComponents(),!h.isEmpty(r))){for(o=0;r.length>o;o++)a=r[o],this.layoutGraph(a,e);return s=this.gridLayoutComponents(r),new n.LayoutState(this.diagram,s)}},_initRuntimeProperties:function(){var e,t;for(e=0;this.graph.nodes.length>e;e++)t=this.graph.nodes[e],t.layer=-1,t.downstreamLinkCount=0,t.upstreamLinkCount=0,t.isVirtual=!1,t.uBaryCenter=0,t.dBaryCenter=0,t.upstreamPriority=0,t.downstreamPriority=0,t.gridPosition=0},_prepare:function(e){var t,n,i,r,o,a,s,l,c,u,p,f,g=[];for(n=0;e.links.length>n;n++)e.links[n].depthOfDumminess=0;for(r=new d,h.forEach(e.nodes,function(e){0===e.incoming.length&&(r.set(e,0),g.push(e))});g.length>0;)for(o=g.shift(),t=0;o.outgoing.length>t;t++)i=o.outgoing[t],a=i.target,r.containsKey(a)?r.set(a,Math.max(r.get(o)+1,r.get(a))):r.set(a,r.get(o)+1),m(g,a)||g.push(a);for(s=0,r.forEachValue(function(e){s=Math.max(s,e)}),l=[],h.addRange(l,r.keys()),l.sort(function(e,t){var n=r.get(e),i=r.get(t);return h.sign(i-n)}),c=0;l.length>c;++c)if(u=l[c],p=Number.MAX_VALUE,0!==u.outgoing.length){for(n=0;u.outgoing.length>n;++n)i=u.outgoing[n],p=Math.min(p,r.get(i.target));p>1&&r.set(u,p-1)}for(this.layers=[],t=0;s+1>t;t++)this.layers.push([]);for(r.forEach(function(e,t){e.layer=t,this.layers[t].push(e)},this),n=0;this.layers.length>n;n++)for(f=this.layers[n],t=0;f.length>t;t++)f[t].gridPosition=t},layoutGraph:function(e,t){if(h.isUndefined(e))throw"No graph given or graph analysis of the diagram failed.";h.isDefined(t)&&this.transferOptions(t),this.graph=e,e.setItemIndices();var n=e.makeAcyclic();this._initRuntimeProperties(),this._prepare(e,t),this._dummify(),this._optimizeCrossings(),this._swapPairs(),this.arrangeNodes(),this._moveThingsAround(),this._dedummify(),h.forEach(n,function(e){e.points&&e.points.reverse()})},setMinDist:function(e,t,n){var i=e.layer,r=e.layerIndex;this.minDistances[i][r]=n},getMinDist:function(e,t){var n,i=0,r=e.layerIndex,o=t.layerIndex,a=e.layer,s=Math.min(r,o),l=Math.max(r,o);for(n=s;l>n;++n)i+=this.minDistances[a][n];return i},placeLeftToRight:function(e){var t,n,i,r,o,a,s,l,c,u,p=new d;for(i=0;this.layers.length>i;++i)if(r=e[i]){for(t=0;r.length>t;t++)n=r[t],p.containsKey(n)||this.placeLeft(n,p,i);for(o=Number.POSITIVE_INFINITY,t=0;r.length>t;t++)n=r[t],a=this.rightSibling(n),a&&this.nodeLeftClass.get(a)!==i&&(o=Math.min(o,p.get(a)-p.get(n)-this.getMinDist(n,a)));if(o===Number.POSITIVE_INFINITY){for(s=[],t=0;r.length>t;t++)for(n=r[t],l=[],h.addRange(l,this.upNodes.get(n)),h.addRange(l,this.downNodes.get(n)),c=0;l.length>c;c++)u=l[c],this.nodeLeftClass.get(u)<i&&s.push(p.get(u)-p.get(n));s.sort(),o=0===s.length?0:s.length%2===1?s[this.intDiv(s.length,2)]:(s[this.intDiv(s.length,2)-1]+s[this.intDiv(s.length,2)])/2}for(t=0;r.length>t;t++)n=r[t],p.set(n,p.get(n)+o)}return p},placeRightToLeft:function(e){var t,n,i,r,o,a,s,l,c,u,p=new d;for(i=0;this.layers.length>i;++i)if(r=e[i]){for(t=0;r.length>t;t++)n=r[t],p.containsKey(n)||this.placeRight(n,p,i);for(o=Number.NEGATIVE_INFINITY,t=0;r.length>t;t++)n=r[t],a=this.leftSibling(n),a&&this.nodeRightClass.get(a)!==i&&(o=Math.max(o,p.get(a)-p.get(n)+this.getMinDist(a,n)));if(o===Number.NEGATIVE_INFINITY){for(s=[],t=0;r.length>t;t++)for(n=r[t],l=[],h.addRange(l,this.upNodes.get(n)),h.addRange(l,this.downNodes.get(n)),c=0;l.length>c;c++)u=l[c],this.nodeRightClass.get(u)<i&&s.push(p.get(n)-p.get(u));s.sort(),o=0===s.length?0:s.length%2===1?s[this.intDiv(s.length,2)]:(s[this.intDiv(s.length,2)-1]+s[this.intDiv(s.length,2)])/2}for(t=0;r.length>t;t++)n=r[t],p.set(n,p.get(n)+o)}return p},_getLeftWing:function(){var e={value:null},t=this.computeClasses(e,1);return this.nodeLeftClass=e.value,t},_getRightWing:function(){var e={value:null},t=this.computeClasses(e,-1);return this.nodeRightClass=e.value,t},computeClasses:function(e,t){var n,i,r,o,a,s,l,c,u,h=0,p=e.value=new d;for(n=0;this.layers.length>n;++n)for(h=n,i=this.layers[n],r=1===t?0:i.length-1;r>=0&&i.length>r;r+=t)if(o=i[r],p.containsKey(o))h=p.get(o);else if(p.set(o,h),o.isVirtual)for(a=this._nodesInLink(o),s=0;a.length>s;s++)l=a[s],p.set(l,h);for(c=[],u=0;this.layers.length>u;u++)c.push(null);return p.forEach(function(e,t){null===c[t]&&(c[t]=[]),c[t].push(e)}),c},_isVerticalLayout:function(){return"up"===this.options.subtype.toLowerCase()||"down"===this.options.subtype.toLowerCase()||"vertical"===this.options.subtype.toLowerCase()},_isHorizontalLayout:function(){return"right"===this.options.subtype.toLowerCase()||"left"===this.options.subtype.toLowerCase()||"horizontal"===this.options.subtype.toLowerCase()},_isIncreasingLayout:function(){return"right"===this.options.subtype.toLowerCase()||"down"===this.options.subtype.toLowerCase()},_moveThingsAround:function(){function e(e,t){var n,i,r=Number.MIN_VALUE;for(n=0;e.length>n;++n)i=e[n],r=t._isVerticalLayout()?Math.max(r,i.height):Math.max(r,i.width);return r}var t,n,i,r,o,a,s,l,c,u,p,f,g,m,v,_,y,w,k,b,x,C,T,S,D,A,E;for(n=0;this.layers.length>n;++n)r=this.layers[n],r.sort(this._gridPositionComparer);for(this.minDistances=[],n=0;this.layers.length>n;++n)for(r=this.layers[n],this.minDistances[n]=[],o=0;r.length>o;++o)i=r[o],i.layerIndex=o,this.minDistances[n][o]=this.options.nodeDistance,r.length-1>o&&(this.minDistances[n][o]+=this._isVerticalLayout()?(i.width+r[o+1].width)/2:(i.height+r[o+1].height)/2);for(this.downNodes=new d,this.upNodes=new d,h.forEach(this.graph.nodes,function(e){this.downNodes.set(e,[]),this.upNodes.set(e,[])},this),h.forEach(this.graph.links,function(e){var t=e.source,n=e.target,i=null,r=null;t.layer>n.layer?(i=e.source,r=e.target):(r=e.source,i=e.target),this.downNodes.get(r).push(i),this.upNodes.get(i).push(r)},this),this.downNodes.forEachValue(function(e){e.sort(this._gridPositionComparer)},this),this.upNodes.forEachValue(function(e){e.sort(this._gridPositionComparer)},this),n=0;this.layers.length-1>n;++n)for(r=this.layers[n],a=0;r.length-1>a;a++)if(s=r[a],s.isVirtual&&(l=this.downNodes.get(s)[0],l.isVirtual))for(o=a+1;r.length>o;++o)i=r[o],i.isVirtual&&(c=this.downNodes.get(i)[0],c.isVirtual&&l.gridPosition>c.gridPosition&&(u=l.gridPosition,l.gridPosition=c.gridPosition,c.gridPosition=u,p=l.layerIndex,f=c.layerIndex,this.layers[n+1][p]=c,this.layers[n+1][f]=l,l.layerIndex=f,c.layerIndex=p));for(g=this._getLeftWing(),m=this._getRightWing(),v=this.placeLeftToRight(g),_=this.placeRightToLeft(m),y=new d,h.forEach(this.graph.nodes,function(e){y.set(e,(v.get(e)+_.get(e))/2)}),w=new d,k=new d,n=0;this.layers.length>n;++n)for(r=this.layers[n],b=-1,x=-1,o=0;r.length>o;++o)i=r[o],w.set(i,0),k.set(i,!1),i.isVirtual&&(-1===b?b=o:b===o-1?b=o:(x=o,w.set(r[b],0),y.get(i)-y.get(r[b])===this.getMinDist(r[b],i)?k.set(r[b],!0):k.set(r[b],!1),b=o));for(C=[1,-1],h.forEach(C,function(e){var n,i,r,o,a,s,l,d=1===e?0:this.layers.length-1;for(n=d;n>=0&&this.layers.length>n;n+=e){if(i=this.layers[n],r=this._firstVirtualNode(i),o=null,a=null,-1!==r)for(o=i[r],a=[],t=0;r>t;t++)a.push(i[t]);else o=null,a=i;if(a.length>0){for(this._sequencer(y,null,o,e,a),t=0;a.length-1>t;++t)this.setMinDist(a[t],a[t+1],y.get(a[t+1])-y.get(a[t]));o&&this.setMinDist(a[a.length-1],o,y.get(o)-y.get(a[a.length-1]))}for(;o;){if(s=this.nextVirtualNode(i,o)){if(w.get(o)===e){for(r=o.layerIndex,l=s.layerIndex,a=[],t=r+1;l>t;t++)a.push(i[t]);a.length>0&&this._sequencer(y,o,s,e,a),k.set(o,!0)}}else{for(r=o.layerIndex,a=[],t=r+1;i.length>t;t++)a.push(i[t]);if(a.length>0){for(this._sequencer(y,o,null,e,a),t=0;a.length-1>t;++t)this.setMinDist(a[t],a[t+1],y.get(a[t+1])-y.get(a[t]));this.setMinDist(o,a[0],y.get(a[0])-y.get(o))}}o=s}this.adjustDirections(n,e,w,k)}},this),T=this._isIncreasingLayout()?0:this.layers.length-1,S=function(e,t){return t._isIncreasingLayout()?t.layers.length>e:e>=0},D=this._isIncreasingLayout()?1:-1,A=0,t=T;S(t,this);t+=D){for(r=this.layers[t],E=e(r,this),o=0;r.length>o;++o)i=r[o],this._isVerticalLayout()?(i.x=y.get(i),i.y=A+E/2):(i.x=A+E/2,i.y=y.get(i));A+=this.options.layerSeparation+E}},adjustDirections:function(e,t,n,i){var r,o,a,s,l,d,c,u,h,p,f,g,m,v;if(!(0>e+t||e+t>=this.layers.length))for(r=null,o=null,a=this.layers[e+t],s=0;a.length>s;++s)if(l=a[s],l.isVirtual&&(d=this.getNeighborOnLayer(l,e),d.isVirtual)){if(r){for(c=i.get(o),u=this.layers[e],h=o.layerIndex,p=d.layerIndex,f=h+1;p>f;++f)u[f].isVirtual&&(c=c&&i.get(u[f]));if(c)for(n.set(r,t),g=r.layerIndex,m=l.layerIndex,v=g+1;m>v;++v)a[v].isVirtual&&n.set(a[v],t)}r=l,o=d}},getNeighborOnLayer:function(e,t){var n=this.upNodes.get(e)[0];return n.layer===t?n:(n=this.downNodes.get(e)[0],n.layer===t?n:null)},_sequencer:function(e,t,n,i,r){if(1===r.length&&this._sequenceSingle(e,t,n,i,r[0]),r.length>1){var o=r.length,a=this.intDiv(o,2);this._sequencer(e,t,n,i,r.slice(0,a)),this._sequencer(e,t,n,i,r.slice(a)),this.combineSequences(e,t,n,i,r)}},_sequenceSingle:function(e,t,n,i,r){var o=-1===i?this.downNodes.get(r):this.upNodes.get(r),a=o.length;0!==a&&(a%2===1?e.set(r,e.get(o[this.intDiv(a,2)])):e.set(r,(e.get(o[this.intDiv(a,2)-1])+e.get(o[this.intDiv(a,2)]))/2),t&&e.set(r,Math.max(e.get(r),e.get(t)+this.getMinDist(t,r))),n&&e.set(r,Math.min(e.get(r),e.get(n)-this.getMinDist(r,n))))},combineSequences:function(e,t,n,i,r){var o,a,s,l,d,c,u,h,p,f,g=r.length,m=this.intDiv(g,2),v=[];for(o=0;m>o;++o){for(a=0,l=-1===i?this.downNodes.get(r[o]):this.upNodes.get(r[o]),s=0;l.length>s;++s)d=l[s],e.get(d)>=e.get(r[o])?a++:(a--,v.push({k:e.get(d)+this.getMinDist(r[o],r[m-1]),v:2}));v.push({k:e.get(r[o])+this.getMinDist(r[o],r[m-1]),v:a})}for(t&&v.push({k:e.get(t)+this.getMinDist(t,r[m-1]),v:Number.MAX_VALUE}),v.sort(this._positionDescendingComparer),u=[],o=m;g>o;++o){for(a=0,l=-1===i?this.downNodes.get(r[o]):this.upNodes.get(r[o]),s=0;l.length>s;++s)d=l[s],e.get(d)<=e.get(r[o])?a++:(a--,u.push({k:e.get(d)-this.getMinDist(r[o],r[m]),v:2}));u.push({k:e.get(r[o])-this.getMinDist(r[o],r[m]),v:a})}for(n&&u.push({k:e.get(n)-this.getMinDist(n,r[m]),v:Number.MAX_VALUE}),u.sort(this._positionAscendingComparer),h=0,p=0,f=this.getMinDist(r[m-1],r[m]);e.get(r[m])-e.get(r[m-1])<f;)if(p>h){if(0===v.length){e.set(r[m-1],e.get(r[m])-f);break}c=v.shift(),h+=c.v,e.set(r[m-1],c.k),e.set(r[m-1],Math.max(e.get(r[m-1]),e.get(r[m])-f))}else{if(0===u.length){e.set(r[m],e.get(r[m-1])+f);break}c=u.shift(),p+=c.v,e.set(r[m],c.k),e.set(r[m],Math.min(e.get(r[m]),e.get(r[m-1])+f))}for(o=m-2;o>=0;o--)e.set(r[o],Math.min(e.get(r[o]),e.get(r[m-1])-this.getMinDist(r[o],r[m-1])));for(o=m+1;g>o;o++)e.set(r[o],Math.max(e.get(r[o]),e.get(r[m])+this.getMinDist(r[o],r[m])))},placeLeft:function(e,t,n){var i=Number.NEGATIVE_INFINITY;h.forEach(this._getComposite(e),function(e){var r=this.leftSibling(e);r&&this.nodeLeftClass.get(r)===this.nodeLeftClass.get(e)&&(t.containsKey(r)||this.placeLeft(r,t,n),i=Math.max(i,t.get(r)+this.getMinDist(r,e)))},this),i===Number.NEGATIVE_INFINITY&&(i=0),h.forEach(this._getComposite(e),function(e){t.set(e,i)})},placeRight:function(e,t,n){var i=Number.POSITIVE_INFINITY;h.forEach(this._getComposite(e),function(e){var r=this.rightSibling(e);r&&this.nodeRightClass.get(r)===this.nodeRightClass.get(e)&&(t.containsKey(r)||this.placeRight(r,t,n),i=Math.min(i,t.get(r)-this.getMinDist(e,r)))},this),i===Number.POSITIVE_INFINITY&&(i=0),h.forEach(this._getComposite(e),function(e){t.set(e,i)})},leftSibling:function(e){var t=this.layers[e.layer],n=e.layerIndex;return 0===n?null:t[n-1]},rightSibling:function(e){var t=this.layers[e.layer],n=e.layerIndex;return n===t.length-1?null:t[n+1]},_getComposite:function(e){return e.isVirtual?this._nodesInLink(e):[e]},arrangeNodes:function(){var e,t,n,i,r,o,a,s;for(t=0;this.layers.length>t;t++)for(i=this.layers[t],n=0;i.length>n;n++)r=i[n],r.upstreamPriority=r.upstreamLinkCount,r.downstreamPriority=r.downstreamLinkCount;for(o=2,a=0;o>a;a++){for(e=this.layers.length-1;e>=1;e--)this.layoutLayer(!1,e);for(e=0;this.layers.length-1>e;e++)this.layoutLayer(!0,e)}for(s=Number.MAX_VALUE,t=0;this.layers.length>t;t++)for(i=this.layers[t],n=0;i.length>n;n++)r=i[n],s=Math.min(s,r.gridPosition);if(0>s)for(t=0;this.layers.length>t;t++)for(i=this.layers[t],n=0;i.length>n;n++)r=i[n],r.gridPosition=r.gridPosition-s},layoutLayer:function(e,t){var n,i,r,o;for(i=e?this.layers[n=t+1]:this.layers[n=t-1],r=[],o=0;i.length>o;o++)r.push(i[o]);r.sort(function(e,t){var n=(e.upstreamPriority+e.downstreamPriority)/2,i=(t.upstreamPriority+t.downstreamPriority)/2;return Math.abs(n-i)<1e-4?0:i>n?1:-1}),h.forEach(r,function(e){var t=e.gridPosition,n=this.calcBaryCenter(e),r=(e.upstreamPriority+e.downstreamPriority)/2;if(!(Math.abs(t-n)<1e-4||Math.abs(t-n)<.2501))if(n>t)for(;n>t&&this.moveRight(e,i,r);)t=e.gridPosition;else for(;t>n&&this.moveLeft(e,i,r);)t=e.gridPosition},this),n>0&&this.calcDownData(n-1),this.layers.length-1>n&&this.calcUpData(n+1)},moveRight:function(e,t,n){var i,r,o=h.indexOf(t,e);return o===t.length-1?(e.gridPosition=e.gridPosition+.5,!0):(i=t[o+1],r=(i.upstreamPriority+i.downstreamPriority)/2,i.gridPosition>e.gridPosition+1?(e.gridPosition=e.gridPosition+.5,!0):r>n||Math.abs(r-n)<1e-4?!1:this.moveRight(i,t,n)?(e.gridPosition=e.gridPosition+.5,!0):!1)},moveLeft:function(e,t,n){var i,r,o=h.indexOf(t,e);return 0===o?(e.gridPosition=e.gridPosition-.5,!0):(i=t[o-1],r=(i.upstreamPriority+i.downstreamPriority)/2,e.gridPosition-1>i.gridPosition?(e.gridPosition=e.gridPosition-.5,!0):r>n||Math.abs(r-n)<1e-4?!1:this.moveLeft(i,t,n)?(e.gridPosition=e.gridPosition-.5,!0):!1)},mapVirtualNode:function(e,t){this.nodeToLinkMap.set(e,t),this.linkToNodeMap.containsKey(t)||this.linkToNodeMap.set(t,[]),this.linkToNodeMap.get(t).push(e)},_nodesInLink:function(e){return this.linkToNodeMap.get(this.nodeToLinkMap.get(e))},_dummify:function(){var e,t,n,i,a,s,l,c,u,p,f,g,m,v,_,y,w,k;for(this.linkToNodeMap=new d,this.nodeToLinkMap=new d,u=this.graph.links.slice(0),c=0;u.length>c;c++){if(p=u[c],f=p.source,g=p.target,m=f.layer,v=g.layer,_=f.gridPosition,y=g.gridPosition,w=(y-_)/Math.abs(v-m),k=f,m-v>1){for(l=m-1;l>v;l--){for(n=new r,n.x=f.x,n.y=f.y,n.width=f.width/100,n.height=f.height/100,e=this.layers[l],t=(l-v)*w+_,t>e.length&&(t=e.length),_>=this.layers[m].length-1&&y>=this.layers[v].length-1?t=e.length:0===_&&0===y&&(t=0),n.layer=l,n.uBaryCenter=0,n.dBaryCenter=0,n.upstreamLinkCount=0,n.downstreamLinkCount=0,n.gridPosition=t,n.isVirtual=!0,h.insert(e,n,t),a=t+1;e.length>a;a++)i=e[a],i.gridPosition=i.gridPosition+1;s=new o(k,n),s.depthOfDumminess=0,k=n,this.graph.nodes.push(n),this.graph.addLink(s),n.index=this.graph.nodes.length-1,this.mapVirtualNode(n,p)}p.changeSource(k),p.depthOfDumminess=m-v-1}if(-1>m-v){for(l=m+1;v>l;l++){for(n=new r,n.x=f.x,n.y=f.y,n.width=f.width/100,n.height=f.height/100,e=this.layers[l],t=(l-m)*w+_,t>e.length&&(t=e.length),_>=this.layers[m].length-1&&y>=this.layers[v].length-1?t=e.length:0===_&&0===y&&(t=0),n.layer=l,n.uBaryCenter=0,n.dBaryCenter=0,n.upstreamLinkCount=0,n.downstreamLinkCount=0,n.gridPosition=t,n.isVirtual=!0,t&=t,h.insert(e,n,t),a=t+1;e.length>a;a++)i=e[a],i.gridPosition=i.gridPosition+1;s=new o(k,n),s.depthOfDumminess=0,k=n,this.graph.nodes.push(n),this.graph.addLink(s),n.index=this.graph.nodes.length-1,this.mapVirtualNode(n,p)}p.changeSource(k),p.depthOfDumminess=v-m-1}}},_dedummify:function(){for(var e,t,n,i,r,o,a,s,l=!0;l;)for(l=!1,e=0;this.graph.links.length>e;e++)if(t=this.graph.links[e],0!==t.depthOfDumminess){for(n=[],n.unshift({x:t.target.x,y:t.target.y}),n.unshift({x:t.source.x,y:t.source.y}),i=t,r=t.depthOfDumminess,o=0;r>o;o++)a=i.source,s=a.incoming[0],n.unshift({x:s.source.x,y:s.source.y}),i=s;t.changeSource(i.source),t.depthOfDumminess=0,n.length>2?(n.splice(0,1),n.splice(n.length-1),t.points=n):t.points=[],l=!0;break}},_optimizeCrossings:function(){for(var e,t=-1,n=3,i=0;0!==t&&!(i++>n);){for(t=0,e=this.layers.length-1;e>=1;e--)t+=this.optimizeLayerCrossings(!1,e);for(e=0;this.layers.length-1>e;e++)t+=this.optimizeLayerCrossings(!0,e)}},calcUpData:function(e){var t,n,i,r,o,a,s,l,d;if(0!==e){for(t=this.layers[e],o=new c,a=this.layers[e-1],n=0;a.length>n;n++)o.add(a[n]);for(n=0;t.length>n;n++){for(s=t[n],l=0,d=0,i=0;s.incoming.length>i;i++)r=s.incoming[i],o.contains(r.source)&&(d++,l+=r.source.gridPosition);for(i=0;s.outgoing.length>i;i++)r=s.outgoing[i],o.contains(r.target)&&(d++,l+=r.target.gridPosition);d>0?(s.uBaryCenter=l/d,s.upstreamLinkCount=d):(s.uBaryCenter=n,s.upstreamLinkCount=0)}}},calcDownData:function(e){var t,n,i,r,o,a,s,l,d;if(e!==this.layers.length-1){for(t=this.layers[e],o=new c,a=this.layers[e+1],n=0;a.length>n;n++)o.add(a[n]);for(n=0;t.length>n;n++){for(s=t[n],l=0,d=0,i=0;s.incoming.length>i;i++)r=s.incoming[i],o.contains(r.source)&&(d++,l+=r.source.gridPosition);for(i=0;s.outgoing.length>i;i++)r=s.outgoing[i],o.contains(r.target)&&(d++,l+=r.target.gridPosition);d>0?(s.dBaryCenter=l/d,s.downstreamLinkCount=d):(s.dBaryCenter=n,s.downstreamLinkCount=0)}}},optimizeLayerCrossings:function(e,t){var n,i,r,o,a,s,l,d;for(i=e?this.layers[n=t+1]:this.layers[n=t-1],r=i.slice(0),e?this.calcUpData(n):this.calcDownData(n),o=this,i.sort(function(e,t){var n,i=o.calcBaryCenter(e),r=o.calcBaryCenter(t);return Math.abs(i-r)<1e-4?e.degree()===t.degree()?o.compareByIndex(e,t):e.degree()<t.degree()?1:-1:(n=1e3*(r-i),n>0?-1:0>n?1:o.compareByIndex(e,t))}),s=0,a=0;i.length>a;a++)i[a]!==r[a]&&s++;if(s>0)for(l=0,a=0;i.length>a;a++)d=i[a],d.gridPosition=l++;return s},_swapPairs:function(){for(var e,t,n,i,r,o,a,s,l,d,c,u,h,p,f,g,m,v=this.options.layeredIterations,_=0;;){if(_++>v)break;for(e=1>=_%4,t=_%4===1,n=e?0:this.layers.length-1;e?this.layers.length-1>=n:n>=0;n+=e?1:-1){for(i=this.layers[n],r=!1,o=!0,a=0,s=0;i.length-1>s;s++)l=0,d=0,c=0,o?(0!==n&&(l=this.countLinksCrossingBetweenTwoLayers(n-1,n)),n!==this.layers.length-1&&(d=this.countLinksCrossingBetweenTwoLayers(n,n+1)),e?l*=2:d*=2,c=l+d):c=a,0!==c&&(u=i[s],h=i[s+1],p=u.gridPosition,f=h.gridPosition,i[s]=h,i[s+1]=u,u.gridPosition=f,h.gridPosition=p,l=0,0!==n&&(l=this.countLinksCrossingBetweenTwoLayers(n-1,n)),d=0,n!==this.layers.length-1&&(d=this.countLinksCrossingBetweenTwoLayers(n,n+1)),e?l*=2:d*=2,g=l+d,m=!1,m=t?g>=c:g>c,m?(u=i[s],h=i[s+1],p=u.gridPosition,f=h.gridPosition,i[s]=h,i[s+1]=u,u.gridPosition=f,h.gridPosition=p,a=c,o=!1):(r=!0,o=!0));r&&(n!==this.layers.length-1&&this.calcUpData(n+1),0!==n&&this.calcDownData(n-1))}}},countLinksCrossingBetweenTwoLayers:function(e,t){var n,i,r,o,a,s,l,d,u,p,f,g,m,v,_,y,w,k,b,x,C=0,T=new c,S=this.layers[e];for(n=0;S.length>n;n++)T.add(S[n]);for(i=new c,r=this.layers[t],n=0;r.length>n;n++)i.add(r[n]);for(o=new c,a=[],s=[],T.forEach(function(e){h.addRange(s,e.incoming),h.addRange(s,e.outgoing)}),l=0;s.length>l;l++)d=s[l],T.contains(d.source)&&i.contains(d.target)?(o.add(d),a.push(d)):i.contains(d.source)&&T.contains(d.target)&&a.push(d);for(u=0;a.length>u;u++)for(p=a[u],f=0;a.length>f;f++)u!==f&&(g=a[f],o.contains(p)?(m=p.source,v=p.target):(m=p.target,v=p.source),o.contains(g)?(_=g.source,y=g.target):(_=g.target,y=g.source),w=m.gridPosition,k=v.gridPosition,b=_.gridPosition,x=y.gridPosition,0>(w-b)*(k-x)&&C++);return C/2},calcBaryCenter:function(e){var t=e.upstreamLinkCount,n=e.downstreamLinkCount,i=e.uBaryCenter,r=e.dBaryCenter;return t>0&&n>0?(i+r)/2:t>0?i:n>0?r:0},_gridPositionComparer:function(e,t){return t.gridPosition>e.gridPosition?-1:e.gridPosition>t.gridPosition?1:0},_positionAscendingComparer:function(e,t){return t.k>e.k?-1:e.k>t.k?1:0},_positionDescendingComparer:function(e,t){return t.k>e.k?1:e.k>t.k?-1:0},_firstVirtualNode:function(e){for(var t=0;e.length>t;t++)if(e[t].isVirtual)return t;return-1},compareByIndex:function(e,t){var n=e.index,i=t.index;return i>n?1:n>i?-1:0},intDiv:function(e,t){return(e-e%t)/t},nextVirtualNode:function(e,t){var n,i=t.layerIndex;for(n=i+1;e.length>n;++n)if(e[n].isVirtual)return e[n];return null}}),C=t.Class.extend({init:function(e,t){if(h.isUndefined(e))throw"No diagram given";this.diagram=e,this.nodeMap=new d,this.linkMap=new d,this.capture(t?t:e)},capture:function(e){var t,i,r,o,a,s,d,c,u;if(e instanceof n.Graph){for(o=0;e.nodes.length>o;o++)t=e.nodes[o],r=t.associatedShape,this.nodeMap.set(r.visual.id,new l(t.x,t.y,t.width,t.height));for(o=0;e.links.length>o;o++)s=e.links[o],a=s.associatedConnection,this.linkMap.set(a.visual.id,s.points())}else if(e instanceof Array)for(i=e,o=0;i.length>o;o++)t=i[o],r=t.associatedShape,r&&this.nodeMap.set(r.visual.id,new l(t.x,t.y,t.width,t.height));else if(e.hasOwnProperty("links")&&e.hasOwnProperty("nodes")){for(i=e.nodes,d=e.links,o=0;i.length>o;o++)t=i[o],r=t.associatedShape,r&&this.nodeMap.set(r.visual.id,new l(t.x,t.y,t.width,t.height));for(o=0;d.length>o;o++)s=d[o],a=s.associatedConnection,a&&this.linkMap.set(a.visual.id,s.points)}else{for(c=this.diagram.shapes,u=this.diagram.connections,o=0;c.length>o;o++)r=c[o],this.nodeMap.set(r.visual.id,r.bounds());for(o=0;u.length>o;o++)a=u[o],this.linkMap.set(a.visual.id,a.points())}}});a(n,{init:function(e){t.init(e,n.ui)},SpringLayout:w,TreeLayout:b,GraphAdapter:y,LayeredLayout:x,LayoutBase:_,LayoutState:C})}(window.kendo.jQuery),function(e,t){function n(e){var t=e.originalEvent,n=0;return t.wheelDelta?(n=-t.wheelDelta/40,n=n>0?Z.ceil(n):Z.floor(n)):t.detail&&(n=t.detail),n}function i(e){return e.options.name.toLowerCase()===at.toLowerCase()}function r(e){var t,n,r,a,s,d,c,u,h,p,f=ut,g=e.source(),m=e.target(),v=[0,2,3,1,4];if(g instanceof I?t=g:g instanceof l&&(i(g)?r=g.shape:(e._resolvedSourceConnector=g,t=g.position())),m instanceof I?n=m:m instanceof l&&(i(m)?a=m.shape:(e._resolvedTargetConnector=m,n=m.position())),t)a&&(e._resolvedTargetConnector=o(t,a));
else if(r)if(n)e._resolvedSourceConnector=o(n,r);else if(a)for(c=0;r.connectors.length>c;c++)d=5==r.connectors.length?v[c]:c,s=r.connectors[d],i(s)||(u=s.position(),h=o(u,a),p=Z.round(h.position().distanceTo(u)),f>p&&(f=p,e._resolvedSourceConnector=s,e._resolvedTargetConnector=h))}function o(e,t){var n,r,o,a,s=ut,l=t.connectors;for(r=0;l.length>r;r++)o=l[r],i(o)||(a=e.distanceTo(o.position()),s>a&&(s=a,n=o));return n}function a(e,t){var n,i,r,o=[],a=e.drawingContainer().children,s=a.length;for(n=0;t.length>n;n++)for(i=t[n],r=0;s>r;r++)if(a[r]==i.drawingContainer()){o.push(r);break}return o}var s,l,d,c,u,h=kendo.dataviz,p=h.diagram,f=kendo.ui.Widget,g=kendo.Class,m=e.proxy,v=kendo.deepExtend,_=kendo.data.HierarchicalDataSource,y=p.Canvas,w=p.Group,k=p.Rectangle,b=p.Circle,x=p.CompositeTransform,C=p.Rect,T=p.Path,S=p.DeleteShapeUnit,D=p.DeleteConnectionUnit,A=p.TextBlock,E=p.Image,I=p.Point,P=p.Intersect,M=p.ConnectionEditAdorner,z=p.UndoRedoService,F=p.ToolService,L=p.Selector,R=p.ResizingAdorner,H=p.ConnectorsAdorner,B=p.Cursors,N=p.Utils,O=kendo.Observable,V=p.ToBackUnit,U=p.ToFrontUnit,W=p.Dictionary,j=p.PolylineRouter,q=p.CascadingRouter,G=N.isUndefined,Y=N.isDefined,$=h.util.defined,Q=e.isArray,K=kendo.isFunction,X=N.isString,Z=Math,J=".kendoDiagram",et="Cascading",tt="Polyline",nt="itemBoundsChange",it="change",rt="click",ot="error",at="Auto",st="Top",lt="Right",dt="Left",ct="Bottom",ut=9007199254740992,ht="select",pt="itemRotate",ft="pan",gt="zoomStart",mt="zoomEnd",vt="none",_t=600,yt=600,wt="rectangle",kt=100,bt=100,xt=20,Ct=20,Tt=0,St="Yellow",Dt=Number.MAX_VALUE,At=-Number.MAX_VALUE,Et="absolute",It="transformed",Pt="rotated",Mt="transparent",zt="width",Ft="height",Lt="x",Rt="y",Ht="DOMMouseScroll"+J+" mousewheel"+J,Bt=.05,Nt=5;p.DefaultConnectors=[{name:st,description:"Top Connector"},{name:lt,description:"Right Connector"},{name:ct,description:"Bottom Connector"},{name:dt,Description:"Left Connector"},{name:at,Description:"Auto Connector",position:function(e){return e.getPosition("center")}}],p.shapeDefaults=function(e){var t={type:wt,path:"",autoSize:!0,visual:null,x:Tt,y:Tt,minWidth:xt,minHeight:Ct,width:kt,height:bt,hover:{},editable:{connect:!0},connectors:p.DefaultConnectors,rotation:{angle:0}};return N.simpleExtend(t,e),t},s=O.extend({init:function(e,t){var n=this;O.fn.init.call(n),n.options=v({id:p.randomId()},n.options,e),n.isSelected=!1,n.dataItem=t,n.visual=new w({id:n.options.id,autoSize:n.options.autoSize}),n._template()},options:{hover:{},cursor:B.grip,content:{align:"center middle",text:""},selectable:!0,serializable:!0,enable:!0},_getCursor:function(e){return this.adorner?this.adorner._getCursor(e):this.options.cursor},visible:function(e){return G(e)?this.visual.visible():(this.visual.visible(e),t)},bounds:function(){},refresh:function(){this.visual.redraw()},position:function(e){this.options.x=e.x,this.options.y=e.y,this.visual.position(e)},toString:function(){return this.options.id},serialize:function(){var e=v({},{options:this.options});return this.dataItem&&(e.dataItem=""+this.dataItem),e},content:function(e){var n,i,r,o;return e!==t&&(n=this.options,i=this.bounds(),p.Utils.isString(e)?n.content.text=e:v(n.content,e),r=n.content,o=this._contentVisual,!o&&r.text?(this._contentVisual=new A(r),this._contentVisual._includeInBBox=!1,this.visual.append(this._contentVisual)):o&&o.redraw(r)),this.options.content.text},_hitTest:function(e){var t=this.bounds();return this.visible()&&t.contains(e)&&this.options.enable},_template:function(){var e,t,n=this;n.options.content.template&&(e=n.dataItem||{},t=kendo.template(n.options.content.template,{paramName:"item"}),n.options.content.text=t(e))},_canSelect:function(){return this.options.selectable!==!1}}),l=g.extend({init:function(e,t){this.options=v({},this.options,t),this.connections=[],this.shape=e},options:{width:7,height:7,fill:{color:St},hover:{}},position:function(){return this.options.position?this.options.position(this.shape):this.shape.getPosition(this.options.name)},toString:function(){return{shapeId:""+this.shape,connector:this.options.name}}}),l.parse=function(e,t){var n,i,r=t.split(":"),o=r[0],a=r[1]||at;for(n=0;e.shapes.length>n;n++)if(i=e.shapes[n],i.options.id==o)return i.getConnector(a.trim())},d=s.extend({init:function(e,n){var i=this,r=e.diagram;delete e.diagram,s.fn.init.call(i,e,n),i.options.diagram=r,e=i.options,i.connectors=[],i.type=e.type,i.shapeVisual=d.createShapeVisual(i.options),i.visual.append(this.shapeVisual),i.updateBounds(),i.content(i.content()),i._createConnectors(),i.parentContainer=null,i.isContainer=!1,i.isCollapsed=!1,i.id=i.visual.id,e.hasOwnProperty("layout")&&e.layout!==t&&(i.layout=e.layout.bind(e))},options:p.shapeDefaults(),updateBounds:function(){var e=this.visual._measure(!0),t=this.options;this.bounds(new C(t.x,t.y,e.width,e.height)),this._rotate(),this._alignContent()},content:function(e){return $(e)?(s.fn.content.call(this,e),this._alignContent(),this):this.options.content.text},_alignContent:function(){var e,t,n,i,r,o=this.options.content||{},a=this._contentVisual;a&&o.align&&(e=this.visual._measure(),t=new p.RectAlign(e),n=a.drawingElement.bbox(null),i=new C(0,0,n.width(),n.height()),r=t.align(i,o.align),a.position(r.topLeft()))},_createConnectors:function(){var e,t,n=this.options,i=n.connectors.length,r=n.connectorDefaults;for(t=0;i>t;t++)e=new l(this,v({},r,n.connectors[t])),this.connectors.push(e)},bounds:function(e){var t,n;if(e)if(X(e))switch(e){case It:t=this._transformedBounds();break;case Et:t=this._transformedBounds(),n=this.diagram._pan,t.x+=n.x,t.y+=n.y;break;case Pt:t=this._rotatedBounds();break;default:t=this._bounds}else this._setBounds(e),this.refreshConnections(),this._triggerBoundsChange();else t=this._bounds;return t},_setBounds:function(e){var t=this.options,n=e.topLeft(),i=t.x=n.x,r=t.y=n.y,o=t.width=Z.max(e.width,t.minWidth),a=t.height=Z.max(e.height,t.minHeight);this._bounds=new C(i,r,o,a),this.visual.redraw({x:i,y:r,width:o,height:a})},position:function(e){return e?(this.bounds(new C(e.x,e.y,this._bounds.width,this._bounds.height)),t):this._bounds.topLeft()},clone:function(){var e,t=this.serialize();return t.options.id=p.randomId(),e=new d(t.options),e.diagram=this.diagram,e},select:function(e){var n,i,r=this.diagram;return G(e)&&(e=!0),this._canSelect()&&this.isSelected!=e?(n=[],i=[],this.isSelected=e,this.isSelected?(r._selectedItems.push(this),n.push(this)):(N.remove(r._selectedItems,this),i.push(this)),r._internalSelection||r._selectionChanged(n,i),!0):t},rotate:function(e,n){var i,r,o,a,s=this.visual.rotate();return e!==t&&(i=this.bounds(),r=new I(i.width/2,i.height/2),n&&(o=e-s.angle,a=i.center().rotate(n,360-o).minus(r),this._rotationOffset=this._rotationOffset.plus(a.minus(i.topLeft())),this.position(a)),this.visual.rotate(e,r),this.options.rotation.angle=e,this.diagram&&this.diagram._connectorsAdorner&&this.diagram._connectorsAdorner.refresh(),this.refreshConnections(),this.diagram&&this.diagram.trigger(pt,{item:this})),s},connections:function(e){var t,n,i,r,o,a,s,l=[];for(t=0;this.connectors.length>t;t++)for(o=this.connectors[t],r=o.connections,n=0,r;r.length>n;n++)i=r[n],"out"==e?(a=i.source(),a.shape&&a.shape==this&&l.push(i)):"in"==e?(s=i.target(),s.shape&&s.shape==this&&l.push(i)):l.push(i);return l},refreshConnections:function(){e.each(this.connections(),function(){this.refresh()})},getConnector:function(e){var t,n;if(!X(e))return e instanceof I?o(e,this):this.connectors.length?this.connectors[0]:null;for(e=e.toLocaleLowerCase(),t=0;this.connectors.length>t;t++)if(n=this.connectors[t],n.options.name.toLocaleLowerCase()==e)return n},getPosition:function(e){var t=this.bounds(),n=e.charAt(0).toLowerCase()+e.slice(1);return K(t[n])?this._transformPoint(t[n]()):t.center()},redraw:function(e){var t,n;e&&(t=this.options,this.shapeVisual.redraw(this._visualOptions(e)),this._diffNumericOptions(e,[zt,Ft,Lt,Rt])&&(this.bounds(new C(t.x,t.y,t.width,t.height)),n=!0),t=v(t,e),(e.rotation||n)&&this._rotate(),e.content&&this.content(e.content))},_diffNumericOptions:p.diffNumericOptions,_visualOptions:function(e){return{data:e.path,source:e.source,hover:e.hover,fill:e.fill,stroke:e.stroke,startCap:e.startCap,endCap:e.endCap}},_triggerBoundsChange:function(){this.diagram&&this.diagram.trigger(nt,{item:this,bounds:this._bounds.clone()})},_transformPoint:function(e){var t=this.rotate(),n=this.bounds(),i=n.topLeft();return t.angle&&e.rotate(t.center().plus(i),360-t.angle),e},_transformedBounds:function(){var e=this.bounds(),t=e.topLeft(),n=e.bottomRight();return C.fromPoints(this.diagram.modelToView(t),this.diagram.modelToView(n))},_rotatedBounds:function(){var e=this.bounds().rotatedBounds(this.rotate().angle),t=e.topLeft(),n=e.bottomRight();return C.fromPoints(t,n)},_rotate:function(){var e=this.options.rotation;e&&e.angle&&this.rotate(e.angle),this._rotationOffset=new I},_hover:function(e){var t=this.options,n=t.hover,i=t.stroke,r=t.fill;e&&Y(n.stroke)&&(i=v({},i,n.stroke)),e&&Y(n.fill)&&(r=n.fill),this.shapeVisual.redraw({stroke:i,fill:r}),t.editable&&t.editable.connect&&this.diagram._showConnectors(this,e)},_hitTest:function(e){if(this.visible()){var t,n=this.bounds(),i=this.rotate().angle;if(e.isEmpty&&!e.isEmpty())return P.rects(e,n,i?i:0);if(t=e.clone().rotate(n.center(),i),n.contains(t))return this}}}),d.createShapeVisual=function(e){function t(e,t){switch(e.toLocaleLowerCase()){case"rectangle":return new k(t);case"circle":return new b(t);case"text":return new A(t);case"image":return new E(t);default:var n=new T(t);return n}}function n(e,t){return t.data=e,new T(t)}function i(e,t,n){return e.call(t,n)}var r,o,a;return delete e.diagram,r=v({},e,{x:0,y:0}),o=r.visual,a=r.type,K(o)?i(o,this,r):r.path?n(r.path,r):X(a)?t(r.type.toLocaleLowerCase(),r):new k(r)},c=s.extend({init:function(e,t,n,i){var r=this;s.fn.init.call(r,n,i),r._router=new j(this),r.path=new p.Polyline(r.options),r.path.fill(Mt),r.visual.append(r.path),r._sourcePoint=r._targetPoint=new I,r.source(e),r.target(t),r.content(r.options.content),r.definers=[],$(n)&&n.points&&r.points(n.points),r.refresh()},options:{hover:{stroke:{}},startCap:vt,endCap:vt,points:[],selectable:!0},sourcePoint:function(){return this._resolvedSourceConnector?this._resolvedSourceConnector.position():this._sourcePoint},source:function(e,n){return Y(e)&&(n&&this.diagram?this.diagram.undoRedoService.addCompositeItem(new p.ConnectionEditUnit(this,e)):(e!==t&&(this.from=e),null===e?this.sourceConnector&&(this._sourcePoint=this._resolvedSourceConnector.position(),this._clearSourceConnector()):e instanceof l?(this.sourceConnector=e,this.sourceConnector.connections.push(this),this.refresh()):e instanceof I?(this._sourcePoint=e,this.sourceConnector&&this._clearSourceConnector(),this.refresh()):e instanceof d&&(this.sourceConnector=e.getConnector(at),this.sourceConnector.connections.push(this),this.refresh()))),this.sourceConnector?this.sourceConnector:this._sourcePoint},sourceDefiner:function(e){if(!e)return this._sourceDefiner||(this._sourceDefiner=new p.PathDefiner(this.sourcePoint(),null,null)),this._sourceDefiner;if(!(e instanceof p.PathDefiner))throw"The sourceDefiner needs to be a PathDefiner.";e.left=null,this._sourceDefiner=e,this.source(e.point)},targetPoint:function(){return this._resolvedTargetConnector?this._resolvedTargetConnector.position():this._targetPoint},target:function(e,n){return Y(e)&&(n&&this.diagram?this.diagram.undoRedoService.addCompositeItem(new p.ConnectionEditUnit(this,e)):(e!==t&&(this.to=e),null===e?this.targetConnector&&(this._targetPoint=this._resolvedTargetConnector.position(),this._clearTargetConnector()):e instanceof l?(this.targetConnector=e,this.targetConnector.connections.push(this),this.refresh()):e instanceof I?(this._targetPoint=e,this.targetConnector&&this._clearTargetConnector(),this.refresh()):e instanceof d&&(this.targetConnector=e.getConnector(at),this.targetConnector&&(this.targetConnector.connections.push(this),this.refresh())))),this.targetConnector?this.targetConnector:this._targetPoint},targetDefiner:function(e){if(!e)return this._targetDefiner||(this._targetDefiner=new p.PathDefiner(this.targetPoint(),null,null)),this._targetDefiner;if(!(e instanceof p.PathDefiner))throw"The sourceDefiner needs to be a PathDefiner.";e.right=null,this._targetDefiner=e,this.target(e.point)},content:function(e){var t=s.fn.content.call(this,e);return $(e)&&this.refresh(),t},select:function(e){var n,i,r=this.diagram;return this._canSelect()&&this.isSelected!==e?(this.isSelected=e,n=[],i=[],this.isSelected?(this.adorner=new M(this,this.options.selection),r._adorn(this.adorner,!0),r._selectedItems.push(this),n.push(this)):this.adorner&&(r._adorn(this.adorner,!1),N.remove(r._selectedItems,this),this.adorner=t,i.push(this)),this.refresh(),r._internalSelection||r._selectionChanged(n,i),!0):t},bounds:function(e){return!e||X(e)?this._bounds:(this._bounds=e,t)},type:function(e){if(!e)return this._type;if(e!==this._type){switch(this._type=e,e.toLowerCase()){case et.toLowerCase():this._router=new q(this);break;case tt.toLowerCase():this._router=new j(this);break;default:throw"Unsupported connection type."}this.refresh()}},points:function(e){var t,n,i,r;if(!e){if(i=[],Y(this.definers))for(r=0;this.definers.length>r;r++)i.push(this.definers[r].point);return i}for(this.definers=[],t=0;e.length>t;t++)if(n=e[t],n instanceof p.Point)this.definers.push(new p.PathDefiner(n));else{if(!n.hasOwnProperty("x")||!n.hasOwnProperty("y"))throw"A Connection point needs to be a Point or an object with x and y properties.";this.definers.push(new p.PathDefiner(new I(n.x,n.y)))}},allPoints:function(){var e,t=[this.sourcePoint()];if(this.definers)for(e=0;this.definers.length>e;e++)t.push(this.definers[e].point);return t.push(this.targetPoint()),t},refresh:function(){r(this);var e,t,n,i,o=this.sourcePoint(),a=this.targetPoint();this._refreshPath(),e=this._bounds.topLeft(),t=o.minus(e),n=a.minus(e),this._contentVisual&&(i=I.fn.middleOf(t,n),this._contentVisual.position(new I(i.x+e.x,i.y+e.y))),this.adorner&&this.adorner.refresh()},redraw:function(e){if(e){this.options=v({},this.options,e);var t=this.options.points;e&&e.content&&this.content(e.content),$(t)&&t.length>0&&(this.points(t),this._refreshPath()),this.path.redraw({fill:e.fill,stroke:e.stroke,startCap:e.startCap,endCap:e.endCap})}},clone:function(){var e=this.serialize(),t=new c(this.from,this.to,e.options);return t.diagram=this.diagram,t},serialize:function(){var e=v({},{options:this.options,from:""+this.from,to:""+this.to});return this.dataItem&&(e.dataItem=""+this.dataItem),e.options.points=this.points(),e},_hitTest:function(e){if(this.visible()){var t=new I(e.x,e.y),n=this.sourcePoint(),i=this.targetPoint();if(e.isEmpty&&!e.isEmpty()&&e.contains(n)&&e.contains(i))return this;if(this._router.hitTest(t))return this}},_hover:function(e){var t=(this.options.stroke||{}).color;e&&Y(this.options.hover.stroke.color)&&(t=this.options.hover.stroke.color),this.path.redraw({stroke:{color:t}})},_refreshPath:function(){$(this.path)&&(this._drawPath(),this.bounds(this._router.getBounds()))},_drawPath:function(){var e,t,n;this._router&&this._router.route(),e=this.sourcePoint(),t=this.targetPoint(),n=this.points(),this.path.redraw({points:[e].concat(n,[t])})},_clearSourceConnector:function(){N.remove(this.sourceConnector.connections,this),this.sourceConnector=t,this._resolvedSourceConnector=t},_clearTargetConnector:function(){N.remove(this.targetConnector.connections,this),this.targetConnector=t,this._resolvedTargetConnector=t}}),u=f.extend({init:function(e,t){var n=this;kendo.destroy(e),f.fn.init.call(n,e,t),n._initElements(),n._initTheme(),n._extendLayoutOptions(n.options),n._initShapeDefaults(),n._initCanvas(),n.mainLayer=new w({id:"main-layer"}),n.canvas.append(n.mainLayer),n._pan=new I,n._adorners=[],n.adornerLayer=new w({id:"adorner-layer"}),n.canvas.append(n.adornerLayer),n._createHandlers(),n._initialize(),n._fetchFreshData(),n._resizingAdorner=new R(n,{editable:n.options.editable}),n._connectorsAdorner=new H(n),n._adorn(n._resizingAdorner,!0),n._adorn(n._connectorsAdorner,!0),n.selector=new L(n),n._clipboard=[],n.options.layout&&n.layout(n.options.layout),n.pauseMouseHandlers=!1,n._createShapes(),n._createConnections(),n.zoom(n.options.zoom),n.canvas.draw()},options:{name:"Diagram",theme:"default",layout:"",zoomRate:.1,zoom:1,minZoom:0,maxZoom:2,dataSource:{},draggable:!0,template:"",autoBind:!0,editable:{rotate:{},resize:{},text:!0},tooltip:{enabled:!0,format:"{0}"},copy:{enabled:!0,offsetX:20,offsetY:20},snap:{enabled:!0,size:10,angle:10},shapeDefaults:p.shapeDefaults({undoable:!0}),connectionDefaults:{},shapes:[],connections:[]},events:[mt,gt,ft,ht,pt,nt,it,rt],_initElements:function(){this.wrapper=this.element.empty().css("position","relative").attr("tabindex",0).addClass("k-widget k-diagram"),this.scrollable=e("<div />").appendTo(this.element)},_initShapeDefaults:function(){var e=this.options;e.editable===!1&&v(e.shapeDefaults,{editable:{connect:!1}})},_initCanvas:function(){var t=e("<div class='k-layer'></div>").appendTo(this.scrollable)[0],n=this.viewport();this.canvas=new y(t,{width:n.width||_t,height:n.height||yt})},_createHandlers:function(){var e=this;kendo.support.touch||kendo.support.mobileOS?(e._userEvents=new kendo.UserEvents(e.element,{multiTouch:!0}),e._userEvents.bind(["gesturestart","gesturechange","gestureend"],{gesturestart:m(e._gestureStart,e),gesturechange:m(e._gestureChange,e),gestureend:m(e._gestureEnd,e)}),e.toolService=new F(e),e.scroller.enable()):(e.toolService=new F(e),e.element.on("mousemove"+J,m(e._mouseMove,e)).on("mouseup"+J,m(e._mouseUp,e)).on("mousedown"+J,m(e._mouseDown,e)).on(Ht,m(e._wheel,e)).on("keydown"+J,m(e._keydown,e)).on("mouseover"+J,m(e._mouseover,e)).on("mouseout"+J,m(e._mouseout,e))),e._resizeHandler=m(e.resize,e),kendo.onResize(e._resizeHandler)},_gestureStart:function(e){this.scroller.disable(),this._gesture=e,this._initialCenter=this.documentToModel(new I(e.center.x,e.center.y)),this.trigger(gt,{point:this._initialCenter,zoom:this.zoom()})},_gestureChange:function(e){var t,n,i=this._gesture,r=this._initialCenter,o=this.documentToView(new I(e.center.x,e.center.y)),a=e.distance/i.distance,s=this._zoom,l=!1;Z.abs(a-1)>=Bt&&(this._zoom=s=this._getValidZoom(s*a),this.options.zoom=s,this._gesture=e,l=!0),t=r.times(s),n=o.minus(t),(l||this._pan.distanceTo(n)>=Nt)&&this._panTransform(n),e.preventDefault()},_gestureEnd:function(){this.scroller.enable(),this.trigger(mt,{point:this._initialCenter,zoom:this.zoom()})},_resize:function(e){this.canvas&&this.canvas.size(e)},_mouseover:function(e){var t=e.target._kendoNode;t&&t.srcElement._hover&&t.srcElement._hover(!0,t.srcElement)},_mouseout:function(e){var t=e.target._kendoNode;t&&t.srcElement._hover&&t.srcElement._hover(!1,t.srcElement)},_initTheme:function(){var e=this,t=h.ui.themes||{},n=((e.options||{}).theme||"").toLowerCase(),i=(t[n]||{}).diagram;e.options=v({},i,e.options)},_createShapes:function(){var e,t,n=this,i=n.options,r=i.shapes;for(t=0;r.length>t;t++)e=r[t],n.addShape(e)},_createConnections:function(){var e,t,n,i,r=this,o=r.options,a=o.connectionDefaults,s=o.connections;for(i=0;s.length>i;i++)e=s[i],t=r._findConnectionShape(e.from),n=r._findConnectionShape(e.to),r.connect(t,n,v({},a,e))},_findConnectionShape:function(e){var t=this,n=X(e)?e:e.shapeId,i=t.getShapeById(n);return i.getConnector(e.connector||at)},destroy:function(){var e=this;f.fn.destroy.call(e),this._userEvents&&this._userEvents.destroy(),kendo.unbindResize(e._resizeHandler),e.clear(),e.element.off(J),e.canvas.destroy(!0),e.canvas=t,e.destroyScroller()},destroyScroller:function(){var e=this.scroller;e&&(e.destroy(),e.element.remove(),this.scroller=null)},save:function(){var e,t,n,i,r={};for(r.shapes=[],r.connections=[],e=0;this.shapes.length>e;e++)t=this.shapes[e],t.options.serializable&&r.shapes.push(t.options);for(e=0;this.connections.length>e;e++)n=this.connections[e],i=v({},{from:""+n.from,to:""+n.to},n.options),r.connections.push(i);return r},focus:function(){if(!this.element.is(kendo._activeElement())){var e,t=this.element,n=t[0],i=[],r=[],o=document.documentElement;do n=n.parentNode,n.scrollHeight>n.clientHeight&&(i.push(n),r.push(n.scrollTop));while(n!=o);for(t.focus(),e=0;i.length>e;e++)i[e].scrollTop=r[e]}},load:function(e){this.clear(),this.setOptions(e),this._createShapes(),this._createConnections()},setOptions:function(e){v(this.options,e)},clear:function(){var e=this;e.select(!1),e.mainLayer.clear(),e._initialize()},connect:function(e,t,n){var i=v({},this.options.connectionDefaults,n),r=new c(e,t,i);return this.addConnection(r)},connected:function(e,t){var n,i;for(n=0;this.connections.length>n;n++)if(i=this.connections[n],i.from==e&&i.to==t)return!0;return!1},addConnection:function(e,n){if(n===t&&(n=!0),n){var i=new p.AddConnectionUnit(e,this);this.undoRedoService.add(i)}else e.diagram=this,this.mainLayer.append(e.visual),this.connections.push(e);return e},addShape:function(e,t){var n,i=this.options.shapeDefaults;if(e instanceof d)i=v({},i,t),e.redraw(t),n=e;else{if(e instanceof kendo.Class)return;i=v({},i,e),n=new d(i)}return i.undoable?this.undoRedoService.add(new p.AddShapeUnit(n,this)):(this.shapes.push(n),n.diagram=this,this.mainLayer.append(n.visual)),this.trigger(it,{added:[n],removed:[]}),n.redraw(),n.hasOwnProperty("layout")&&n.layout(n),n},remove:function(e,t){var n,i=Q(e);if(G(t)&&(t=!0),t&&this.undoRedoService.begin(),i)for(e=e.slice(0),n=0;e.length>n;n++)this._removeItem(e[n],t);else(e instanceof d||e instanceof c)&&this._removeItem(e,t);t&&this.undoRedoService.commit(),this.trigger(it,{added:[],removed:i?e:[e]})},undo:function(){this.undoRedoService.undo()},redo:function(){this.undoRedoService.redo()},select:function(e,t){if(!Y(e))return this._selectedItems;t=v({addToSelection:!1},t);var n,i,r=t.addToSelection,o=[],a=[];for(r||this.deselect(),this._internalSelection=!0,e instanceof Array?o=e:e instanceof s&&(o=[e]),n=0;o.length>n;n++)i=o[n],i.select(!0)&&a.push(i);this._selectionChanged(a,[]),this._internalSelection=!1},selectAll:function(){this.select(this.shapes.concat(this.connections))},selectArea:function(e){var t,n,i,r;if(this._internalSelection=!0,r=[],e instanceof C)for(n=this.shapes.concat(this.connections),t=0;n.length>t;t++)i=n[t],e&&!i._hitTest(e)||!i.options.enable||i.select(!0)&&r.push(i);this._selectionChanged(r,[]),this._internalSelection=!1},deselect:function(e){this._internalSelection=!0;var t,n,i=[],r=[];for(e instanceof Array?r=e:e instanceof s?r.push(e):Y(e)||(r=this._selectedItems.slice(0)),n=0;r.length>n;n++)t=r[n],t.select(!1)&&i.push(t);this._selectionChanged([],i),this._internalSelection=!1},toFront:function(e,t){var n,i,r;e||(e=this._selectedItems.slice()),n=this._getDiagramItems(e),!$(t)||t?(i=a(this.mainLayer,n.visuals),r=new U(this,e,i),this.undoRedoService.add(r)):(this.mainLayer.toFront(n.visuals),this._fixOrdering(n,!0))},toBack:function(e,t){var n,i,r;e||(e=this._selectedItems.slice()),n=this._getDiagramItems(e),!$(t)||t?(i=a(this.mainLayer,n.visuals),r=new V(this,e,i),this.undoRedoService.add(r)):(this.mainLayer.toBack(n.visuals),this._fixOrdering(n,!1))},bringIntoView:function(e,t){var n,i,r,o,a=this.viewport(),l=new p.RectAlign(a);0!==a.width&&0!==a.height&&(t=v({animate:!1,align:"center middle"},t),"none"==t.align&&(t.align="center middle"),e instanceof s?i=e.bounds(It):Q(e)?i=this.boundingBox(e):e instanceof C&&(i=e.clone()),r=i.clone(),i.zoom(this._zoom),this._storePan(new I),(i.width>a.width||i.height>a.height)&&(this._zoom=this._getValidZoom(Z.min(a.width/r.width,a.height/r.height)),i=r.clone().zoom(this._zoom)),this._zoomMainLayer(),n=i.clone(),l.align(i,t.align),o=i.topLeft().minus(n.topLeft()),this.pan(o.times(-1),t.animate))},alignShapes:function(e){var t,n,i,r,o,a,s;if(G(e)&&(e="Left"),t=this.select(),0!==t.length){switch(e.toLowerCase()){case"left":case"top":n=Dt;break;case"right":case"bottom":n=At}for(r=0;t.length>r;r++)if(i=t[r],i instanceof d)switch(e.toLowerCase()){case"left":n=Z.min(n,i.options.x);break;case"top":n=Z.min(n,i.options.y);break;case"right":n=Z.max(n,i.options.x);break;case"bottom":n=Z.max(n,i.options.y)}for(o=[],a=[],r=0;t.length>r;r++)if(i=t[r],i instanceof d)switch(a.push(i),o.push(i.bounds()),e.toLowerCase()){case"left":case"right":i.position(new I(n,i.options.y));break;case"top":case"bottom":i.position(new I(i.options.x,n))}s=new p.TransformUnit(a,o),this.undoRedoService.add(s,!1)}},zoom:function(e,t){var n,i,r,o;return e&&(n=t?t.point:new p.Point(0,0),e=this._zoom=this._getValidZoom(e),G(n)||(n=new p.Point(Z.round(n.x),Z.round(n.y)),i=n.times(e),r=this.modelToView(n),o=r.minus(i),this._storePan(new p.Point(Z.round(o.x),Z.round(o.y)))),t&&(t.zoom=e),this._panTransform(),this._updateAdorners()),this._zoom},_getPan:function(e){var t=this.canvas;return t.translate||(e=e.plus(this._pan)),e},pan:function(e,t){var n,i;e instanceof I&&(n=this,i=n.scroller,e=n._getPan(e),e=e.times(-1),t?i.animatedScrollTo(e.x,e.y,function(){n._updateAdorners()}):(i.scrollTo(e.x,e.y),n._updateAdorners()))},viewport:function(){var e=this.element;return new C(0,0,e.width(),e.height())},copy:function(){var e,t;if(this.options.copy.enabled)for(this._clipboard=[],this._copyOffset=1,e=0;this._selectedItems.length>e;e++)t=this._selectedItems[e],this._clipboard.push(t)},cut:function(){var e,t;if(this.options.copy.enabled){for(this._clipboard=[],this._copyOffset=0,e=0;this._selectedItems.length>e;e++)t=this._selectedItems[e],this._clipboard.push(t);this.remove(this._clipboard)}},paste:function(){var e,t,n,i,r,o,a,s;if(this._clipboard.length>0){for(s=new W,e=this._copyOffset*this.options.copy.offsetX,t=this._copyOffset*this.options.copy.offsetY,this.deselect(),a=0;this._clipboard.length>a;a++)n=this._clipboard[a],n instanceof c||(i=n.clone(),s.set(n.id,i.id),this._addItem(i),i.position(new I(n.options.x+e,n.options.y+t)),i.select(!0));for(a=0;this._clipboard.length>a;a++)n=this._clipboard[a],n instanceof d||(i=n.clone(),n.source()instanceof l&&(r=n.source(),s.containsKey(r.shape.id)?(o=this.getShapeById(s.get(r.shape.id)),i.source(o.getConnector(r.options.name))):i.source(new I(n.sourcePoint().x+e,n.sourcePoint().y+t))),n.target()instanceof l&&(r=n.target(),s.containsKey(r.shape.id)?(o=this.getShapeById(s.get(r.shape.id)),i.target(o.getConnector(r.options.name))):i.target(new I(n.targetPoint().x+e,n.targetPoint().y+t))),this._addItem(i),i.position(new I(n.options.x+e,n.options.y+t)),i.select(!0));this._copyOffset+=1}},boundingBox:function(e,t){var n,i,r,o=C.empty(),a=Y(e)?this._getDiagramItems(e):{shapes:this.shapes};if(a.shapes.length>0)for(i=a.shapes[0],t===!0&&(o.x-=i._rotationOffset.x,o.y-=i._rotationOffset.y),o=i.bounds(Pt),r=1;a.shapes.length>r;r++)i=a.shapes[r],n=i.bounds(Pt),t===!0&&(n.x-=i._rotationOffset.x,n.y-=i._rotationOffset.y),o=o.union(n);return o},documentToView:function(e){var t=this.element.offset();return new I(e.x-t.left,e.y-t.top)},viewToDocument:function(e){var t=this.element.offset();return new I(e.x+t.left,e.y+t.top)},viewToModel:function(e){return this._transformWithMatrix(e,this._matrixInvert)},modelToView:function(e){return this._transformWithMatrix(e,this._matrix)},modelToLayer:function(e){return this._transformWithMatrix(e,this._layerMatrix)},layerToModel:function(e){return this._transformWithMatrix(e,this._layerMatrixInvert)},documentToModel:function(e){var t=this.documentToView(e);return this.canvas.translate||(t.x=t.x+this.scroller.scrollLeft,t.y=t.y+this.scroller.scrollTop),this.viewToModel(t)},modelToDocument:function(e){return this.viewToDocument(this.modelToView(e))},_transformWithMatrix:function(e,t){var n,i,r=e;return e instanceof I?t&&(r=t.apply(e)):(n=this._transformWithMatrix(e.topLeft(),t),i=this._transformWithMatrix(e.bottomRight(),t),r=C.fromPoints(n,i)),r},setDataSource:function(e){this.options.dataSource=e,this._dataSource(),this.options.autoBind&&this.dataSource.fetch()},layout:function(e){var t,n,i,r,o;switch(this.isLayouting=!0,G(e)&&(e=this.options.layout),t=G(e)||G(e.type)?"Tree":e.type,t.toLowerCase()){case"tree":n=new p.TreeLayout(this);break;case"layered":n=new p.LayeredLayout(this);break;case"forcedirected":case"force":case"spring":case"springembedder":n=new p.SpringLayout(this);break;default:throw"Layout algorithm '"+t+"' is not supported."}i=new p.LayoutState(this),r=n.layout(e),r&&(o=new p.LayoutUndoUnit(i,r,e?e.animate:null),this.undoRedoService.add(o)),this.isLayouting=!1},getShapeById:function(e){var t;return(t=N.first(this.shapes,function(t){return t.visual.id===e}))?t:t=N.first(this.connections,function(t){return t.visual.id===e})},_extendLayoutOptions:function(e){e.layout&&(e.layout=v(p.LayoutBase.fn.defaultOptions||{},e.layout))},_selectionChanged:function(e,t){(e.length||t.length)&&this.trigger(ht,{selected:e,deselected:t})},_getValidZoom:function(e){return Z.min(Z.max(e,this.options.minZoom),this.options.maxZoom)},_panTransform:function(e){var t=this,n=e||t._pan;t.canvas.translate?(t.scroller.scrollTo(n.x,n.y),t._zoomMainLayer()):(t._storePan(n),t._transformMainLayer())},_finishPan:function(){this.trigger(ft,{total:this._pan,delta:Number.NaN})},_storePan:function(e){this._pan=e,this._storeViewMatrix()},_zoomMainLayer:function(){var e=this._zoom,t=new x(0,0,e,e);t.render(this.mainLayer),this._storeLayerMatrix(t),this._storeViewMatrix()},_transformMainLayer:function(){var e=this._pan,t=this._zoom,n=new x(e.x,e.y,t,t);n.render(this.mainLayer),this._storeLayerMatrix(n),this._storeViewMatrix()},_storeLayerMatrix:function(e){this._layerMatrix=e.toMatrix(),this._layerMatrixInvert=e.invert().toMatrix()},_storeViewMatrix:function(){var e=this._pan,t=this._zoom,n=new x(e.x,e.y,t,t);this._matrix=n.toMatrix(),this._matrixInvert=n.invert().toMatrix()},_toIndex:function(e,t){var n=this._getDiagramItems(e);this.mainLayer.toIndex(n.visuals,t),this._fixOrdering(n,!1)},_fixOrdering:function(e,t){var n,i,r=t?this.shapes.length-1:0,o=t?this.connections.length-1:0;for(n=0;e.shapes.length>n;n++)i=e.shapes[n],N.remove(this.shapes,i),N.insert(this.shapes,i,r);for(n=0;e.cons.length>n;n++)i=e.cons[n],N.remove(this.connections,i),N.insert(this.connections,i,o)},_getDiagramItems:function(e){var t,n,i={},r=e;for(i.visuals=[],i.shapes=[],i.cons=[],e?Q(e)||(r=[e]):r=this._selectedItems.slice(),t=0;r.length>t;t++)n=r[t],n instanceof d?(i.shapes.push(n),i.visuals.push(n.visual)):n instanceof c&&(i.cons.push(n),i.visuals.push(n.visual));return i},_removeItem:function(e,t){e.select(!1),e instanceof d?this._removeShape(e,t):e instanceof c&&this._removeConnection(e,t),t||this.mainLayer.remove(e.visual)},_removeShape:function(e,t){var n,i,r,o,a=[],s=[];for(this.toolService._removeHover(),t?this.undoRedoService.addCompositeItem(new S(e)):N.remove(this.shapes,e),n=0;e.connectors.length>n;n++)for(r=e.connectors[n],o=0;r.connections.length>o;o++)i=r.connections[o],i.sourceConnector==r?a.push(i):i.targetConnector==r&&s.push(i);for(n=0;a.length>n;n++)a[n].source(null,t);for(n=0;s.length>n;n++)s[n].target(null,t)},_removeConnection:function(e,t){e.sourceConnector&&N.remove(e.sourceConnector.connections,e),e.targetConnector&&N.remove(e.targetConnector.connections,e),t?this.undoRedoService.addCompositeItem(new D(e)):N.remove(this.connections,e)},_removeDataItems:function(e,t){var n,i,r,o;for(e=Q(e)?e:[e];e.length;)if(n=e.shift(),r=this._dataMap[n.uid],r&&(this._removeShapeConnections(r),this._removeItem(r,!1),delete this._dataMap[n.uid],t&&n.hasChildren&&n.loaded()))for(i=n.children.data(),o=0;i.length>o;o++)e.push(i[o])},_removeShapeConnections:function(e){var t,n=e.connections();if(n)for(t=0;n.length>t;t++)this._removeItem(n[t],!1)},_addDataItem:function(e){var t,n;if($(e))return(t=this._dataMap[e.uid])?t:(n=v({},this.options.shapeDefaults,{dataItem:e}),t=new d(n,e),this.addShape(t),this._dataMap[e.uid]=t,t)},_addDataItems:function(e,t){var n,i,r,o,a;for(i=0;e.length>i;i++)n=e[i],r=this._addDataItem(n),o=this._addDataItem(t),o&&!this.connected(o,r)&&(a=this.connect(o,r),a.type(et))},_refreshSource:function(e){var t,n=this,i=e.node,r=e.action,o=e.items,a=n.options;
if(!e.field){if("remove"==r)this._removeDataItems(e.items,!0);else for(r||i||n.clear(),this._addDataItems(o,i),t=0;o.length>t;t++)o[t].load();a.layout&&n.layout(a.layout)}},_mouseDown:function(e){if(!this.pauseMouseHandlers){var t=this._calculatePosition(e);1==e.which&&this.toolService.start(t,this._meta(e))&&e.preventDefault()}},_addItem:function(e){e instanceof d?this.addShape(e):e instanceof c&&this.addConnection(e)},_mouseUp:function(e){if(!this.pauseMouseHandlers){var t=this._calculatePosition(e);1==e.which&&this.toolService.end(t,this._meta(e))&&e.preventDefault()}},_mouseMove:function(e){if(!this.pauseMouseHandlers){var t=this._calculatePosition(e);0!==e.which&&1!=e.which||!this.toolService.move(t,this._meta(e))||e.preventDefault()}},_keydown:function(e){this.toolService.keyDown(e.keyCode,this._meta(e))&&e.preventDefault()},_wheel:function(e){var t=n(e),i=this._calculatePosition(e),r=v(this._meta(e),{delta:t});this.toolService.wheel(i,r)&&e.preventDefault()},_meta:function(e){return{ctrlKey:e.ctrlKey,metaKey:e.metaKey,altKey:e.altKey}},_calculatePosition:function(e){var n=e.pageX===t?e.originalEvent:e,i=new I(n.pageX,n.pageY),r=this.documentToModel(i);return r},_normalizePointZoom:function(e){return e.times(1/this.zoom())},_initialize:function(){this.shapes=[],this._selectedItems=[],this.connections=[],this._dataMap={},this.undoRedoService=new z,this.id=p.randomId()},_fetchFreshData:function(){this._dataSource(),this.options.autoBind&&this.dataSource.fetch()},_dataSource:function(){var e=this,t=e.options,n=t.dataSource;n=Q(n)?{data:n}:n,n.fields||(n.fields=[{field:"text"},{field:"url"},{field:"spriteCssClass"},{field:"imageUrl"}]),e.dataSource&&e._refreshHandler&&e._unbindDataSource(),e._refreshHandler=m(e._refreshSource,e),e._errorHandler=m(e._error,e),e.dataSource=_.create(n).bind(it,e._refreshHandler).bind(ot,e._errorHandler)},_unbindDataSource:function(){var e=this;e.dataSource.unbind(it,e._refreshHandler).unbind(ot,e._errorHandler)},_error:function(){},_adorn:function(e,n){n!==t&&e&&(n?(this._adorners.push(e),this.adornerLayer.append(e.visual)):(N.remove(this._adorners,e),this.adornerLayer.remove(e.visual)))},_showConnectors:function(e,t){t?this._connectorsAdorner.show(e):this._connectorsAdorner.destroy()},_updateAdorners:function(){var e,t,n=this._adorners;for(e=0;n.length>e;e++)t=n[e],t.refreshBounds&&t.refreshBounds(),t.refresh()},_refresh:function(){var e;for(e=0;this.connections.length>e;e++)this.connections[e].refresh()}}),h.ui.plugin(u),kendo.deepExtend(p,{Shape:d,Connection:c,Connector:l})}(window.kendo.jQuery),window.kendo},"function"==typeof define&&define.amd?define:function(e,t){t()});