/*
* Kendo UI v2014.2.716 (http://www.telerik.com/kendo-ui)
* Copyright 2014 Telerik AD. All rights reserved.
*
* Kendo UI commercial licenses may be obtained at
* http://www.telerik.com/purchase/license-agreement/kendo-ui-complete
* If you do not own a commercial license, this file shall be governed by the trial license terms.
*/
!function(e,define){define(["./kendo.dom.min","./kendo.draganddrop.min"],e)}(function(){return function(e){function t(e){return delete e.name,delete e.prefix,delete e.views,e}function n(e){var t=[],n=e.workWeekStart;for(t.push(n);e.workWeekEnd!=n;)n>6?n-=7:n++,t.push(n);return t}function i(){var t=kendo._activeElement();"body"!==t.nodeName.toLowerCase()&&e(t).blur()}var r,a,o=kendo.ui.Widget,s=kendo.dom.element,l=kendo.dom.text,d=e.isPlainObject,c=e.extend,u=kendo.keys,p=kendo.data.Query,h=".kendoGanttTimeline",f="click",m="keydown",g=".",v=kendo.template("#=kendo.toString(start, 't')#"),_=kendo.template("#=kendo.toString(start, 'ddd M/dd')#"),k=kendo.template("#=kendo.toString(start, 'ddd M/dd')# - #=kendo.toString(kendo.date.addDays(end, -1), 'ddd M/dd')#"),b=kendo.template("#=kendo.toString(start, 'MMM')#"),w=kendo.template('<div class="#=styles.marquee#"><div class="#=styles.marqueeColor#"></div></div>'),y=kendo.template('<div style="z-index: 100002;" class="#=styles.tooltipWrapper#"><div class="#=styles.tooltipContent#"><div>Start: #=kendo.toString(start, "ddd M/dd HH:mm")#</div><div>End: #=kendo.toString(end, "ddd M/dd HH:mm")#</div></div></div>'),x=kendo.template('<div style="z-index: 100002;" class="#=styles.tooltipWrapper#" ><div class="#=styles.tooltipContent#">#=text#%</div><div class="#=styles.tooltipCallout#" style="left:13px;"></div></div>'),C={day:{type:"kendo.ui.GanttDayView"},week:{type:"kendo.ui.GanttWeekView"},month:{type:"kendo.ui.GanttMonthView"}},T={alt:"k-alt",nonWorking:"k-nonwork-hour",header:"k-header",gridHeader:"k-grid-header",gridHeaderWrap:"k-grid-header-wrap",gridContent:"k-grid-content",rowsTable:"k-gantt-rows",columnsTable:"k-gantt-columns",tasksTable:"k-gantt-tasks",task:"k-task",taskSingle:"k-task-single",taskMilestone:"k-task-milestone",taskSummary:"k-task-summary",taskWrap:"k-task-wrap",taskMilestoneWrap:"k-milestone-wrap",taskDot:"k-task-dot",taskDotStart:"k-task-start",taskDotEnd:"k-task-end",taskDragHandle:"k-task-draghandle",taskContent:"k-task-content",taskTemplate:"k-task-template",taskActions:"k-task-actions",taskDelete:"k-task-delete",taskComplete:"k-task-complete",link:"k-link",icon:"k-icon",iconDelete:"k-si-close",taskResizeHandle:"k-resize-handle",taskResizeHandleWest:"k-resize-w",taskResizeHandleEast:"k-resize-e",taskSummaryProgress:"k-task-summary-progress",taskSummaryComplete:"k-task-summary-complete",line:"k-line",lineHorizontal:"k-line-h",lineVertical:"k-line-v",arrowWest:"k-arrow-w",arrowEast:"k-arrow-e",dragHint:"k-drag-hint",dependencyHint:"k-dependency-hint",tooltipWrapper:"k-widget k-tooltip k-popup k-group k-reset",tooltipContent:"k-tooltip-content",tooltipCallout:"k-callout k-callout-s",callout:"k-callout",marquee:"k-marquee k-gantt-marquee",marqueeColor:"k-marquee-color"},S=kendo.ui.GanttView=o.extend({init:function(e,t){o.fn.init.call(this,e,t),this.title=this.options.title||this.options.name,this.header=this.element.find(g+S.styles.gridHeader),this.content=this.element.find(g+S.styles.gridContent),this.contentWidth=this.content.width(),this._workDays=n(this.options),this._headerTree=t.headerTree,this._taskTree=t.taskTree,this._dependencyTree=t.dependencyTree,this._taskCoordinates={}},destroy:function(){o.fn.destroy.call(this),this.headerRow=null,this.header=null,this.content=null,this._dragHint=null,this._resizeHint=null,this._resizeTooltip=null,this._percentCompleteResizeTooltip=null,this._headerTree=null,this._taskTree=null,this._dependencyTree=null},options:{showWorkHours:!1,showWorkDays:!1,workDayStart:new Date(1980,1,1,8,0,0),workDayEnd:new Date(1980,1,1,17,0,0),workWeekStart:1,workWeekEnd:5,hourSpan:1,slotSize:100},renderLayout:function(){this._slots=this._createSlots(),this._tableWidth=this._calculateTableWidth(),this.createLayout(this._layout()),this._slotDimensions(),this.content.height(this.element.height()-this.header.outerHeight())},createLayout:function(e){var t=this._headers(e),n=this._colgroup(),i=this._headerTree,r=s("thead",null,t),a=s("table",{style:{width:this._tableWidth+"px"}},[n,r]);i.render([a]),this.headerRow=this.header.find("table:first tr").last()},_slotDimensions:function(){var e,t,n,i,r=this.headerRow[0].children,a=this._timeSlots();for(n=0,i=r.length;i>n;n++)t=r[n],e=a[n],e.offsetLeft=t.offsetLeft,e.offsetWidth=t.offsetWidth},render:function(e){var t,n=e.length,i=S.styles,r=this._rowsTable(n),a=this._columnsTable(n),o=this._tasksTable(e);this._taskTree.render([r,a,o]),t=this.content.find(g+i.rowsTable),this._contentHeight=t.height(),this._rowHeight=t.find("tr").height(),this.content.find(g+i.columnsTable).height(this._contentHeight)},_rowsTable:function(e){var t,n,i=[],r=S.styles,a=[null,{className:r.alt}];for(n=0;e>n;n++)t=s("tr",a[n%2],[s("td",null,[l(" ")])]),i.push(t);return this._createTable(1,i,{className:r.rowsTable})},_columnsTable:function(){var e,t,n,i,r,a=[],o=S.styles,d=this._timeSlots(),c=d.length,u=0;for(r=0;c>r;r++)t=d[r],i={},n=t.span,u+=n,1!==n&&(i.colspan=n),t.isNonWorking&&(i.className=o.nonWorking),a.push(s("td",i,[l(" ")]));return e=s("tr",null,a),this._createTable(u,[e],{className:o.columnsTable})},_tasksTable:function(e){var t,n,i,r,a,o=[],l=this._taskCoordinates={},d=Math.round(this._calculateMilestoneWidth()),c=function(e){var t=n.left,r=t+n.width;i.isMilestone()&&(t-=d/2,r=t+d),l[i.id]={start:t,end:r,rowIndex:e}};for(r=0,a=e.length;a>r;r++)i=e[r],n=this._taskPosition(i),t=s("tr",null,[s("td",null,[this._renderTask(e[r],n)])]),o.push(t),c(r);return this._createTable(1,o,{className:S.styles.tasksTable})},_createTable:function(e,t,n){var i,r,a,o=[];for(a=0;e>a;a++)o.push(s("col"));return i=s("colgroup",null,o),r=s("tbody",null,t),n.style||(n.style={}),n.style.width=this._tableWidth+"px",s("table",n,[i,r])},_calculateTableWidth:function(){var e,t,n,i,r=this._timeSlots(),a=0,o=0;for(n=0,i=r.length;i>n;n++)e=r[n].span,o+=e,e>a&&(a=e);return t=Math.round(o*this.options.slotSize/a)},_calculateMilestoneWidth:function(){var t,n=S.styles.task+" "+S.styles.taskMilestone,i=e("<div class='"+n+"' style='visibility: hidden; position: absolute'>");return this.content.append(i),t=i[0].getBoundingClientRect().width,i.remove(),t},_renderTask:function(e,t){var n,i,r,a=this.options.editable,o=t.left,l=S.styles,d=l.taskWrap;return e.summary?i=this._renderSummary(e,t):e.isMilestone()?(i=this._renderMilestone(e,t),d+=" "+l.taskMilestoneWrap):i=this._renderSingleTask(e,t),n=s("div",{className:d,style:{left:o+"px"}},[i]),a&&(n.children.push(s("div",{className:l.taskDot+" "+l.taskDotStart})),n.children.push(s("div",{className:l.taskDot+" "+l.taskDotEnd}))),e.summary||e.isMilestone()||!a||(r=Math.round(t.width*e.percentComplete),n.children.push(s("div",{className:l.taskDragHandle,style:{left:r+"px"}}))),n},_renderSingleTask:function(e,t){var n,i=S.styles,r=Math.round(t.width*e.percentComplete),a=s("div",{className:i.taskContent},[s("div",{className:i.taskTemplate},[l(e.title)])]);return this.options.editable&&(a.children.push(s("span",{className:i.taskActions},[s("a",{className:i.link+" "+i.taskDelete,href:"#"},[s("span",{className:i.icon+" "+i.iconDelete})])])),a.children.push(s("span",{className:i.taskResizeHandle+" "+i.taskResizeHandleWest})),a.children.push(s("span",{className:i.taskResizeHandle+" "+i.taskResizeHandleEast}))),n=s("div",{className:i.task+" "+i.taskSingle,"data-uid":e.uid,style:{width:Math.max(t.width-2,0)+"px"}},[s("div",{className:i.taskComplete,style:{width:r+"px"}}),a])},_renderMilestone:function(e){var t=S.styles,n=s("div",{className:t.task+" "+t.taskMilestone,"data-uid":e.uid});return n},_renderSummary:function(e,t){var n=S.styles,i=Math.round(t.width*e.percentComplete),r=s("div",{className:n.task+" "+n.taskSummary,"data-uid":e.uid,style:{width:t.width+"px"}},[s("div",{className:n.taskSummaryProgress,style:{width:i+"px"}},[s("div",{className:n.taskSummaryComplete,style:{width:t.width+"px"}})])]);return r},_taskPosition:function(e){var t=Math.round,n=t(this._offset(e.start)),i=t(this._offset(e.end));return{left:n,width:i-n}},_offset:function(e){var t,n,i,r=this._timeSlots(),a=this._slotIndex("start",e),o=r[a];return e>o.end?o.offsetLeft+o.offsetWidth:o.start>e?o.offsetLeft:(t=e-o.start,n=o.end-o.start,i=t/n*o.offsetWidth,o.offsetLeft+i)},_slotIndex:function(e,t){var n,i=this._timeSlots(),r=0,a=i.length-1;do n=Math.ceil((a+r)/2),t>i[n][e]?r=n:(n===a&&n--,a=n);while(r!==a);return r},_timeByPosition:function(e,t,n){var i,r,a,o=this._slotByPosition(e);return t?n?o.end:o.start:(i=e-(this.content.offset().left-this.content.scrollLeft()),r=o.end-o.start,a=r*((i-o.offsetLeft)/o.offsetWidth),new Date(o.start.getTime()+a))},_slotByPosition:function(e){var t=e-(this.content.offset().left-this.content.scrollLeft()),n=this._slotIndex("offsetLeft",t);return this._timeSlots()[n]},_renderDependencies:function(e){var t,n,i=[],r=this._dependencyTree;for(t=0,n=e.length;n>t;t++)i.push.apply(i,this._renderDependency(e[t]));r.render(i)},_renderDependency:function(e){var t,n,i,r,a=this._taskCoordinates[e.predecessorId],o=this._taskCoordinates[e.successorId];if(!a||!o)return[];for(n="_render"+["FF","FS","SF","SS"][e.type],t=this[n](a,o),i=0,r=t.length;r>i;i++)t[i].attr["data-uid"]=e.uid;return t},_renderFF:function(e,t){var n=this._dependencyFF(e,t,!1);return n[n.length-1].children[0]=this._arrow(!0),n},_renderSS:function(e,t){var n=this._dependencyFF(t,e,!0);return n[0].children[0]=this._arrow(!1),n.reverse()},_renderFS:function(e,t){var n=this._dependencyFS(e,t,!1);return n[n.length-1].children[0]=this._arrow(!1),n},_renderSF:function(e,t){var n=this._dependencyFS(t,e,!0);return n[0].children[0]=this._arrow(!0),n.reverse()},_dependencyFF:function(e,t,n){var i,r=this,a=[],o=0,s=0,l=0,d=0,c=n?"start":"end",u=2,p=1,h=this._rowHeight,f=10,m=e.rowIndex*h+Math.floor(h/2)-1,g=t.rowIndex*h+Math.floor(h/2)-1,v=S.styles,_=function(){a.push(r._line(v.line+" "+v.lineHorizontal,{left:o+"px",top:s+"px",width:l+"px"}))},k=function(){a.push(r._line(v.line+" "+v.lineVertical,{left:o+"px",top:s+"px",height:d+"px"}))};return o=e[c],s=m,l=f,i=t[c]-e[c],i>0!==n&&(l=Math.abs(i)+f),n?(o-=l,l-=p,_()):(_(),o+=l-u),s>g?(d=s-g,d+=u,s=g,k()):(d=g-s,d+=u,k(),s+=d-u),l=Math.abs(o-t[c]),n||(l-=p,o-=l),_(),a},_dependencyFS:function(e,t,n){var i=this,r=[],a=0,o=0,s=0,l=0,d=this._rowHeight,c=Math.floor(d/2),u=10,p=2*u,h=t.start-e.end,f=2,m=1,g=e.rowIndex*d+Math.floor(d/2)-1,v=t.rowIndex*d+Math.floor(d/2)-1,_=S.styles,k=function(){r.push(i._line(_.line+" "+_.lineHorizontal,{left:a+"px",top:o+"px",width:s+"px"}))},b=function(){r.push(i._line(_.line+" "+_.lineVertical,{left:a+"px",top:o+"px",height:l+"px"}))};return a=e.end,o=g,s=u,n&&(a+=m,h>p&&(s=h-(u-f)),s-=m),k(),a+=s-f,p>=h&&(l=n?Math.abs(v-g)-c:c,g>v?(o-=l,l+=f,b()):(b(),o+=l),s=e.end-t.start+p,u>s&&(s=u),a-=s-f,k()),g>v?(l=o-v,o=v,l+=f,b()):(l=v-o,b(),o+=l),s=t.start-a,n||(s-=m),k(),r},_line:function(e,t){return s("div",{className:e,style:t})},_arrow:function(e){return s("span",{className:e?S.styles.arrowWest:S.styles.arrowEast})},_colgroup:function(){var e,t,n,i=this._timeSlots(),r=i.length,a=[];for(e=0;r>e;e++)for(t=0,n=i[e].span;n>t;t++)a.push(s("col"));return s("colgroup",null,a)},_createDragHint:function(e){this._dragHint=e.clone().addClass(S.styles.dragHint).css("cursor","move"),e.parent().append(this._dragHint)},_updateDragHint:function(e){var t=this._offset(e);this._dragHint.css({left:t})},_removeDragHint:function(){this._dragHint.remove(),this._dragHint=null},_createResizeHint:function(t){var n,i,r=S.styles,a=this._taskCoordinates[t.id].rowIndex*this._rowHeight;this._resizeHint=e(w({styles:r})).css({top:0,height:this._contentHeight}),this.content.append(this._resizeHint),this._resizeTooltip=e(y({styles:r,start:t.start,end:t.end})).css({top:0,left:0}),this.content.append(this._resizeTooltip),this._resizeTooltipWidth=this._resizeTooltip.outerWidth(),n=this._resizeTooltip.outerHeight(),i=a-n,0>i&&(i=a+this._rowHeight),this._resizeTooltipTop=i},_updateResizeHint:function(t,n,i){var r=this._offset(t),a=this._offset(n),o=a-r,s=i?r:a,l=this._tableWidth-17,d=this._resizeTooltipWidth;this._resizeHint.css({left:r,width:o}),this._resizeTooltip&&this._resizeTooltip.remove(),s-=Math.round(d/2),0>s?s=0:s+d>l&&(s=l-d),this._resizeTooltip=e(y({styles:S.styles,start:t,end:n})).css({top:this._resizeTooltipTop,left:s,"min-width":d}),this.content.append(this._resizeTooltip)},_removeResizeHint:function(){this._resizeHint.remove(),this._resizeHint=null,this._resizeTooltip.remove(),this._resizeTooltip=null},_updatePercentCompleteTooltip:function(t,n,i){var r,a,o,s;this._removePercentCompleteTooltip(),r=this._percentCompleteResizeTooltip=e(x({styles:S.styles,text:i})).appendTo(this.element),a=Math.round(r.outerWidth()/2),o=r.find(g+S.styles.callout),s=Math.round(o.outerWidth()/2),r.css({top:t-(r.outerHeight()+s),left:n-a}),o.css("left",a-s)},_removePercentCompleteTooltip:function(){this._percentCompleteResizeTooltip&&this._percentCompleteResizeTooltip.remove(),this._percentCompleteResizeTooltip=null},_updateDependencyDragHint:function(e,t,n){this._removeDependencyDragHint(),n?this._creteVmlDependencyDragHint(e,t):this._creteDependencyDragHint(e,t)},_creteDependencyDragHint:function(t,n){var i=S.styles,r=n.x-t.x,a=n.y-t.y,o=Math.sqrt(r*r+a*a),s=Math.atan(a/r);0>r&&(s+=Math.PI),e("<div class='"+i.line+" "+i.lineHorizontal+" "+i.dependencyHint+"'></div>").css({top:t.y,left:t.x,width:o,"transform-origin":"0% 0","-ms-transform-origin":"0% 0","-webkit-transform-origin":"0% 0",transform:"rotate("+s+"rad)","-ms-transform":"rotate("+s+"rad)","-webkit-transform":"rotate("+s+"rad)"}).appendTo(this.content)},_creteVmlDependencyDragHint:function(t,n){var i=e("<kvml:line class='"+S.styles.dependencyHint+"' style='position:absolute; top: 0px;' strokecolor='black' strokeweight='2px' from='"+t.x+"px,"+t.y+"px' to='"+n.x+"px,"+n.y+"px'></kvml:line>").appendTo(this.content);i[0].outerHTML=i[0].outerHTML},_removeDependencyDragHint:function(){this.content.find(g+S.styles.dependencyHint).remove()},_scrollTo:function(e){var t=e.offset().left,n=e.width(),i=t+n,r=e.closest("tr"),a=r.offset().top,o=r.height(),s=a+o,l=this.content,d=l.offset(),c=d.top,u=l.height(),p=c+u,h=d.left,f=l.width(),m=h+f,g=kendo.support.scrollbar();c>a?l.scrollTop(l.scrollTop()+(a-c)):s>p&&l.scrollTop(l.scrollTop()+(s+g-p)),h>t&&n>f&&m>i||i>m&&f>n?l.scrollLeft(l.scrollLeft()+(i+g-m)):(i>m&&n>f&&t>h||h>t&&f>n)&&l.scrollLeft(l.scrollLeft()+(t-h))},_timeSlots:function(){return this._slots[this._slots.length-1]},_headers:function(e){var t,n,i,r,a,o,d,c,u=[],p=S.styles;for(a=0,o=e.length;o>a;a++){for(t=e[a],n=[],d=0,c=t.length;c>d;d++)i=t[d],r=l(i.text),n.push(s("th",{colspan:i.span,className:p.header+(i.isNonWorking?" "+p.nonWorking:"")},[r]));u.push(s("tr",null,n))}return u},_hours:function(e,t){var n,i,r,a=[],o=this.options,s=o.workDayStart.getHours(),l=o.workDayEnd.getHours(),d=o.hourSpan;for(e=new Date(e),t=new Date(t);t>e;)n=new Date(e),r=n.getHours(),i=r>=s&&l>r,n.setHours(n.getHours()+d),r==n.getHours()&&n.setHours(n.getHours()+2*d),(!o.showWorkHours||i)&&a.push({start:e,end:n,isNonWorking:!i,span:1}),e=n;return a},_days:function(e,t){var n,i,r=[];for(e=new Date(e),t=new Date(t);t>e;)n=kendo.date.nextDay(e),i=this._isWorkDay(e),(!this.options.showWorkDays||i)&&r.push({start:e,end:n,isNonWorking:!i,span:1}),e=n;return r},_weeks:function(e,t){var n,i,r,a=[],o=this.calendarInfo().firstDay;for(e=new Date(e),t=new Date(t);t>e;)n=kendo.date.dayOfWeek(kendo.date.addDays(e,1),o,1),n>t&&(n=t),i=this._days(e,n),r=i.length,r>0&&a.push({start:i[0].start,end:i[r-1].end,span:r}),e=n;return a},_months:function(e,t){var n,i,r,a=[];for(e=new Date(e),t=new Date(t);t>e;)n=new Date(e),n.setMonth(n.getMonth()+1),i=this._days(e,n),r=i.length,r>0&&a.push({start:i[0].start,end:i[r-1].end,span:r}),e=n;return a},_slotHeaders:function(e,t){var n,i,r,a=[];for(i=0,r=e.length;r>i;i++)n=e[i],a.push({text:t(n),isNonWorking:!!n.isNonWorking,span:n.span});return a},_isWorkDay:function(e){var t,n,i=e.getDay(),r=this._workDays;for(t=0,n=r.length;n>t;t++)if(r[t]===i)return!0;return!1},calendarInfo:function(){return kendo.getCulture().calendars.standard}});c(!0,S,{styles:T}),kendo.ui.GanttDayView=S.extend({name:"day",options:{timeHeaderTemplate:v,dayHeaderTemplate:_},range:function(e){this.start=kendo.date.getDate(e.start),this.end=kendo.date.getDate(e.end),(kendo.date.getMilliseconds(e.end)>0||this.end.getTime()===this.start.getTime())&&(this.end=kendo.date.addDays(this.end,1))},_createSlots:function(){var e,t,n,i,r=[],a=this._days(this.start,this.end),o=[];for(n=0,i=a.length;i>n;n++)e=a[n],t=this._hours(e.start,e.end),e.span=t.length,o.push.apply(o,t);return r.push(a),r.push(o),r},_layout:function(){var e=[],t=this.options;return e.push(this._slotHeaders(this._slots[0],kendo.template(t.dayHeaderTemplate))),e.push(this._slotHeaders(this._slots[1],kendo.template(t.timeHeaderTemplate))),e}}),kendo.ui.GanttWeekView=S.extend({name:"week",options:{dayHeaderTemplate:_,weekHeaderTemplate:k},range:function(e){var t=this.calendarInfo(),n=t.firstDay;this.start=kendo.date.getDate(kendo.date.dayOfWeek(e.start,n,-1)),this.end=kendo.date.getDate(kendo.date.dayOfWeek(e.end,n,1))},_createSlots:function(){var e=[];return e.push(this._weeks(this.start,this.end)),e.push(this._days(this.start,this.end)),e},_layout:function(){var e=[],t=this.options;return e.push(this._slotHeaders(this._slots[0],kendo.template(t.weekHeaderTemplate))),e.push(this._slotHeaders(this._slots[1],kendo.template(t.dayHeaderTemplate))),e}}),kendo.ui.GanttMonthView=S.extend({name:"month",options:{weekHeaderTemplate:k,monthHeaderTemplate:b},range:function(e){this.start=kendo.date.firstDayOfMonth(e.start),this.end=kendo.date.addDays(kendo.date.getDate(kendo.date.lastDayOfMonth(e.end)),1)},_createSlots:function(){var e=[];return e.push(this._months(this.start,this.end)),e.push(this._weeks(this.start,this.end)),e},_layout:function(){var e=[],t=this.options;return e.push(this._slotHeaders(this._slots[0],kendo.template(t.monthHeaderTemplate))),e.push(this._slotHeaders(this._slots[1],kendo.template(t.weekHeaderTemplate))),e}}),r={wrapper:"k-timeline k-grid k-widget",gridHeader:"k-grid-header",gridHeaderWrap:"k-grid-header-wrap",gridContent:"k-grid-content",gridContentWrap:"k-grid-content",tasksWrapper:"k-gantt-tables",dependenciesWrapper:"k-gantt-dependencies",task:"k-task",line:"k-line",taskResizeHandle:"k-resize-handle",taskResizeHandleWest:"k-resize-w",taskDragHandle:"k-task-draghandle",taskComplete:"k-task-complete",taskDelete:"k-task-delete",taskWrapActive:"k-task-wrap-active",taskWrap:"k-task-wrap",taskDot:"k-task-dot",taskDotStart:"k-task-start",taskDotEnd:"k-task-end",hovered:"k-state-hover",selected:"k-state-selected",origin:"k-origin"},a=kendo.ui.GanttTimeline=o.extend({init:function(e,t){o.fn.init.call(this,e,t),this.options.views&&this.options.views.length||(this.options.views=["day","week","month"]),this._wrapper(),this._domTrees(),this._views(),this._selectable(),this._draggable(),this._resizable(),this._percentResizeDraggable(),this._createDependencyDraggable(),this._attachEvents()},options:{name:"GanttTimeline",messages:{views:{day:"Day",week:"Week",month:"Month"}},snap:!0,selectable:!0,editable:!0},destroy:function(){o.fn.destroy.call(this),this._unbindView(this._selectedView),this._moveDraggable&&this._moveDraggable.destroy(),this._resizeDraggable&&this._resizeDraggable.destroy(),this._percentDraggable&&this._percentDraggable.destroy(),this._dependencyDraggable&&this._dependencyDraggable.destroy(),this._headerTree=null,this._taskTree=null,this._dependencyTree=null,this.wrapper.off(h),kendo.destroy(this.wrapper)},_wrapper:function(){var e=a.styles;this.wrapper=this.element.addClass(e.wrapper).append("<div class='"+e.gridHeader+"'><div class='"+e.gridHeaderWrap+"'></div></div>").append("<div class='"+e.gridContentWrap+"'><div class='"+e.tasksWrapper+"'></div><div class='"+e.dependenciesWrapper+"'></div></div>")},_domTrees:function(){var e=a.styles,t=kendo.dom.Tree,n=this.wrapper;this._headerTree=new t(n.find(g+e.gridHeaderWrap)[0]),this._taskTree=new t(n.find(g+e.tasksWrapper)[0]),this._dependencyTree=new t(n.find(g+e.dependenciesWrapper)[0])},_views:function(){var e,t,n,i,r,a,o,s=this.options.views;for(this.views={},a=0,o=s.length;o>a;a++)e=s[a],t=d(e),t&&e.selectable===!1||(n=t?e.type:e,i=C[n],i&&(e=c({title:this.options.messages.views[n]},t?e:{},i),this.views[n]=e,(!r||e.selected)&&(r=n)));r&&(this._selectedViewName=r)},view:function(e){return e&&(this._selectView(e),this.trigger("navigate",{view:e,action:"changeView"})),this._selectedView},_selectView:function(e){e&&this.views[e]&&(this._selectedView&&this._unbindView(this._selectedView),this._selectedView=this._initializeView(e),this._selectedViewName=e)},_viewByIndex:function(e){var t,n=this.views;for(t in n){if(!e)return t;e--}},_initializeView:function(e){var n,i=this.views[e];if(i){if(n=i.type,"string"==typeof n&&(n=kendo.getter(i.type)(window)),!n)throw Error("There is no such view");i=new n(this.wrapper,t(c(!0,{headerTree:this._headerTree,taskTree:this._taskTree,dependencyTree:this._dependencyTree},i,this.options)))}return i},_unbindView:function(e){e&&e.destroy()},_range:function(e){var t,n,i={field:"start",dir:"asc"},r={field:"end",dir:"desc"};return e&&e.length?(t=new p(e).sort(i).toArray()[0].start||new Date,n=new p(e).sort(r).toArray()[0].end||new Date,{start:t,end:n}):{start:new Date,end:new Date}},_render:function(e){var t=this.view(),n=this._range(e);this._tasks=e,t.range(n),t.renderLayout(),t.render(e)},_renderDependencies:function(e){this.view()._renderDependencies(e)},_taskByUid:function(e){var t,n,i=this._tasks,r=i.length;for(n=0;r>n;n++)if(t=i[n],t.uid===e)return t},_draggable:function(){var e,t,n,r,o,s=this,l=this.options.snap,d=a.styles,c=function(){s.view()._removeDragHint(),e&&e.css("opacity",1),e=null,t=null,o=!1};this.options.editable===!0&&(this._moveDraggable=new kendo.ui.Draggable(this.wrapper,{distance:0,filter:g+d.task,holdToDrag:kendo.support.mobileOS,ignore:g+d.taskResizeHandle}),this._moveDraggable.bind("dragstart",function(i){var a=s.view();return e=i.currentTarget.parent(),t=s._taskByUid(i.currentTarget.attr("data-uid")),s.trigger("moveStart",{task:t})?void i.preventDefault():(n=t.start,r=a._timeByPosition(i.x.location,l)-n,a._createDragHint(e),e.css("opacity",.5),void(o=!0))}).bind("drag",kendo.throttle(function(e){var i,a;o&&(i=s.view(),a=new Date(i._timeByPosition(e.x.location,l)-r),s.trigger("move",{task:t,start:a})||(n=a,i._updateDragHint(n)))},15)).bind("dragend",function(){s.trigger("moveEnd",{task:t,start:n}),c()}).bind("dragcancel",function(){c()}).userEvents.bind("select",function(){i()}))},_resizable:function(){var e,t,n,r,o,s,l=this,d=this.options.snap,c=a.styles,u=function(){l.view()._removeResizeHint(),e=null,t=null,s=!1};this.options.editable===!0&&(this._resizeDraggable=new kendo.ui.Draggable(this.wrapper,{distance:0,filter:g+c.taskResizeHandle,holdToDrag:!1}),this._resizeDraggable.bind("dragstart",function(i){return o=i.currentTarget.hasClass(c.taskResizeHandleWest),e=i.currentTarget.closest(g+c.task),t=l._taskByUid(e.attr("data-uid")),l.trigger("resizeStart",{task:t})?void i.preventDefault():(n=t.start,r=t.end,l.view()._createResizeHint(t),void(s=!0))}).bind("drag",kendo.throttle(function(e){var i,a;s&&(i=l.view(),a=i._timeByPosition(e.x.location,d,!o),o?n=r>a?a:r:r=a>n?a:n,l.trigger("resize",{task:t,start:n,end:r})||i._updateResizeHint(n,r,o))},15)).bind("dragend",function(){l.trigger("resizeEnd",{task:t,resizeStart:o,start:n,end:r}),u()}).bind("dragcancel",function(){u()}).userEvents.bind("select",function(){i()}))},_percentResizeDraggable:function(){var e,t,n,r,o,s,l,d,c,u,p=this,h=a.styles,f=function(){p.view()._removePercentCompleteTooltip(),t=null,e=null,u=!1},m=function(e){t.find(g+h.taskComplete).width(e).end().siblings(g+h.taskDragHandle).css("left",e)};this.options.editable===!0&&(this._percentDraggable=new kendo.ui.Draggable(this.wrapper,{distance:0,filter:g+h.taskDragHandle,holdToDrag:!1}),this._percentDraggable.bind("dragstart",function(i){t=i.currentTarget.siblings(g+h.task),e=p._taskByUid(t.attr("data-uid")),l=e.percentComplete,n=t.offset(),r=this.element.offset(),o=t.find(g+h.taskComplete).width(),s=t.outerWidth(),u=!0}).bind("drag",kendo.throttle(function(e){if(u){var t=Math.max(0,Math.min(s,o+e.x.initialDelta));l=Math.round(t/s*100),m(t),d=n.top-r.top,c=n.left+t-r.left,p.view()._updatePercentCompleteTooltip(d,c,l)}},15)).bind("dragend",function(){p.trigger("percentResizeEnd",{task:e,percentComplete:l/100}),f()}).bind("dragcancel",function(){m(o),f()}).userEvents.bind("select",function(){i()}))},_createDependencyDraggable:function(){var t,n,r,o,s,l,d=this,c=e(),u=e(),p=kendo.support.browser.msie&&9>kendo.support.browser.version,h=a.styles,f=function(){t.css("display","").removeClass(h.hovered),t.parent().removeClass(h.origin),t=null,m(!1),u=e(),c=e(),d.view()._removeDependencyDragHint(),n=!1},m=function(e){u.hasClass(h.origin)||(u.find(g+h.taskDot).css("display",e?"block":""),c.toggleClass(h.hovered,e))};this.options.editable===!0&&(p&&document.namespaces&&document.namespaces.add("kvml","urn:schemas-microsoft-com:vml","#default#VML"),this._dependencyDraggable=new kendo.ui.Draggable(this.wrapper,{distance:0,filter:g+h.taskDot,holdToDrag:!1}),this._dependencyDraggable.bind("dragstart",function(e){t=e.currentTarget.css("display","block").addClass(h.hovered),t.parent().addClass(h.origin);var i=t.offset();s=d.view().content,l=s.offset(),r=Math.round(i.left+s.scrollLeft()-l.left+t.outerHeight()/2),o=Math.round(i.top+s.scrollTop()-l.top+t.outerWidth()/2),n=!0}).bind("drag",kendo.throttle(function(t){var i,a,f;n&&(i=e(kendo.elementUnderCursor(t)),a=t.x.location+s.scrollLeft()-l.left,f=t.y.location+s.scrollTop()-l.top,d.view()._updateDependencyDragHint({x:r,y:o},{x:a,y:f},p),m(!1),c=i.hasClass(h.taskDot)?i:e(),u=i.closest(g+h.taskWrap),m(!0))},15)).bind("dragend",function(){var e,n,i,r,a;c.length&&(e=t.hasClass(h.taskDotStart),n=c.hasClass(h.taskDotStart),i=e?n?3:2:n?1:0,r=d._taskByUid(t.siblings(g+h.task).attr("data-uid")),a=d._taskByUid(c.siblings(g+h.task).attr("data-uid")),r!==a&&d.trigger("dependencyDragEnd",{type:i,predecessor:r,successor:a})),f()}).bind("dragcancel",function(){f()}).userEvents.bind("select",function(){i()}))},_selectable:function(){var t=this,n=a.styles;this.options.selectable&&this.wrapper.on(f+h,g+n.task,function(n){n.stopPropagation(),n.ctrlKey?t.trigger("clear"):t.trigger("select",{uid:e(this).attr("data-uid")})}).on(f+h,g+n.tasksWrapper,function(){t.selectDependency().length>0?t.clearSelection():t.trigger("clear")}).on(f+h,g+n.line,function(e){e.stopPropagation(),t.selectDependency(this)})},select:function(e){var t=this.wrapper.find(e),n=a.styles;return t.length?(this.clearSelection(),t.addClass(n.selected),void(kendo.support.mobileOS&&t.parent().addClass(n.taskWrapActive))):this.wrapper.find(g+n.task+g+n.selected)},selectDependency:function(t){var n,i=this.wrapper.find(t),r=a.styles;return i.length?(this.trigger("clear"),n=e(i).attr("data-uid"),void this.wrapper.find(g+r.line+"[data-uid='"+n+"']").addClass(r.selected)):this.wrapper.find(g+r.line+g+r.selected)},clearSelection:function(){var e=a.styles;this.wrapper.find(g+e.selected).removeClass(e.selected),kendo.support.mobileOS&&this.wrapper.find(g+e.taskWrapActive).removeClass(e.taskWrapActive)},_attachEvents:function(){var t=this,n=a.styles;this.options.editable===!0&&(this._tabindex(),this.wrapper.on(f+h,g+n.taskDelete,function(i){t.trigger("removeTask",{uid:e(this).closest(g+n.task).attr("data-uid")}),i.stopPropagation(),i.preventDefault()}).on(m+h,function(e){var n;e.keyCode===u.DELETE&&(n=t.selectDependency(),n.length&&(t.trigger("removeDependency",{uid:n.attr("data-uid")}),t.clearSelection()))}))}}),c(!0,a,{styles:r})}(window.kendo.jQuery),window.kendo},"function"==typeof define&&define.amd?define:function(e,t){t()});