/*
* Kendo UI v2014.2.716 (http://www.telerik.com/kendo-ui)
* Copyright 2014 Telerik AD. All rights reserved.
*
* Kendo UI commercial licenses may be obtained at
* http://www.telerik.com/purchase/license-agreement/kendo-ui-complete
* If you do not own a commercial license, this file shall be governed by the trial license terms.
*/
!function(e,define){define(["./kendo.dom.min","./kendo.touch.min","./kendo.draganddrop.min","./kendo.columnsorter.min","./kendo.datetimepicker.min","./kendo.editable.min"],e)}(function(){return function(e){function t(e){var t,n,i=[],r=e.className;for(t=0,n=e.level;n>t;t++)i.push(a("span",{className:r}));return i}function n(){var t=i._activeElement();"body"!==t.nodeName.toLowerCase()&&e(t).blur()}var i=window.kendo,r=i.dom,a=r.element,o=r.text,s=i.support.mobileOS,l=i.ui,d=l.Widget,c=e.extend,u=e.map,p=e.isFunction,f=i.keys,h={title:"Title",start:"Start Time",end:"End Time",percentComplete:"% Done",parentId:"Predecessor ID",id:"ID",orderId:"Order ID"},m="string",g=".kendoGanttList",v="click",_=".",k={wrapper:"k-treelist k-grid k-widget",header:"k-header",alt:"k-alt",editCell:"k-edit-cell",group:"k-treelist-group",gridHeader:"k-grid-header",gridHeaderWrap:"k-grid-header-wrap",gridContent:"k-grid-content",gridContentWrap:"k-grid-content",selected:"k-state-selected",icon:"k-icon",iconCollapse:"k-i-collapse",iconExpand:"k-i-expand",iconHidden:"k-i-none",iconPlaceHolder:"k-icon k-i-none",input:"k-input",dropPositions:"k-insert-top k-insert-bottom k-add k-insert-middle",dropTop:"k-insert-top",dropBottom:"k-insert-bottom",dropAdd:"k-add",dropMiddle:"k-insert-middle",dropDenied:"k-denied",dragStatus:"k-drag-status",dragClue:"k-drag-clue",dragClueText:"k-clue-text"},b=l.GanttList=d.extend({init:function(e,t){d.fn.init.call(this,e,t),0===this.options.columns.length&&this.options.columns.push("title"),this.dataSource=this.options.dataSource,this._columns(),this._layout(),this._domTrees(),this._header(),this._sortable(),this._editable(),this._selectable(),this._draggable(),this._attachEvents(),this.content.height(this.element.height()-this.header.parent().outerHeight())},destroy:function(){d.fn.destroy.call(this),this._reorderDraggable&&this._reorderDraggable.destroy(),this._tableDropArea&&this._tableDropArea.destroy(),this._contentDropArea&&this._contentDropArea.destroy(),this.touch&&this.touch.destroy(),this.content.off(g),this.header=null,this.content=null,this.levels=null,i.destroy(this.element)},options:{name:"GanttList",selectable:!0,editable:!0},_attachEvents:function(){var t=this,n=b.styles;t.content.on(v+g,"td > span."+n.icon+":not(."+n.iconHidden+")",function(n){var i=e(this),r=t._modelFromElement(i);r.set("expanded",!r.get("expanded")),n.stopPropagation()})},_domTrees:function(){this.headerTree=new r.Tree(this.header[0]),this.contentTree=new r.Tree(this.content[0])},_columns:function(){var e=this.options.columns,t=function(){this.field="",this.title="",this.editable=!1,this.sortable=!1};this.columns=u(e,function(e){return e="string"==typeof e?{field:e,title:h[e]}:e,c(new t,e)})},_layout:function(){var e=this.element,t=b.styles;e.addClass(t.wrapper).append("<div class='"+t.gridHeader+"'><div class='"+t.gridHeaderWrap+"'></div></div>").append("<div class='"+t.gridContentWrap+"'></div>"),this.header=e.find(_+t.gridHeaderWrap),this.content=e.find(_+t.gridContent)},_header:function(){var e=this.headerTree,t=a("colgroup",null,this._cols()),n=a("thead",{role:"rowgroup"},[a("tr",{role:"row"},this._ths())]),i=a("table",{style:{"min-width":this.options.listWidth+"px"},role:"grid"},[t,n]);e.render([i])},_render:function(e){var t,n,i;this.levels=[{field:null,value:0}],t=a("colgroup",null,this._cols()),n=a("tbody",{role:"rowgroup"},this._trs(e)),i=a("table",{style:{"min-width":this.options.listWidth+"px"},tabIndex:0,role:"treegrid"},[t,n]),this.contentTree.render([i]),this.trigger("render")},_ths:function(){var e,t,n,i,r=this.columns,s=[];for(n=0,i=r.length;i>n;n++)e=r[n],t={"data-field":e.field,"data-title":e.title,className:b.styles.header,role:"columnheader"},s.push(a("th",t,[o(e.title)]));return s},_cols:function(){var e,t,n,i,r,o=this.columns,s=[];for(i=0,r=o.length;r>i;i++)e=o[i],n=e.width,t=n&&0!==parseInt(n,10)?{style:{width:typeof n===m?n:n+"px"}}:null,s.push(a("col",t,[]));return s},_trs:function(e){var t,n,i,r,a,o=[],s=[],l=b.styles;for(r=0,a=e.length;a>r;r++)t=e[r],i=this._levels({idx:t.parentId,id:t.id,summary:t.summary}),n={"data-uid":t.uid,"data-level":i,role:"row"},t.summary&&(n["aria-expanded"]=t.expanded),r%2!==0&&s.push(l.alt),t.summary&&s.push(l.group),s.length&&(n.className=s.join(" ")),o.push(this._tds({task:t,attr:n,level:i})),s=[];return o},_tds:function(e){var t,n,i,r=[],o=this.columns;for(n=0,i=o.length;i>n;n++)t=o[n],r.push(this._td({task:e.task,column:t,level:e.level}));return a("tr",e.attr,r)},_td:function(e){var n=[],r=b.styles,s=e.task,l=e.column,d=s.get(l.field),c=l.format?i.format(l.format,d):d;return"title"===l.field&&(n=t({level:e.level,className:r.iconPlaceHolder}),n.push(a("span",{className:r.icon+" "+(s.summary?s.expanded?r.iconCollapse:r.iconExpand:r.iconHidden)}))),n.push(a("span",null,[o(c)])),a("td",{role:"gridcell"},n)},_levels:function(e){var t,n,i,r=this.levels,a=e.summary,o=e.idx,s=e.id;for(n=0,i=r.length;i>n;n++)if(t=r[n],t.field==o)return a&&r.push({field:s,value:t.value+1}),t.value},_sortable:function(){var e,t,n,r,a,o=this.columns,s=this.header.find("th");for(r=0,a=s.length;a>r;r++)e=o[r],e.sortable&&(n=s.eq(r),t=n.data("kendoColumnSorter"),t&&t.destroy(),n.attr("data-"+i.ns+"field",e.field).kendoColumnSorter({dataSource:this.dataSource}));s=null},_selectable:function(){var t=this,n=this.options.selectable;n&&this.content.on(v+g,"tr",function(n){var i=e(this);n.ctrlKey?t.clearSelection():t.select(i)})},select:function(e){var t=this.content.find(e),n=b.styles.selected;return t.length?(t.siblings(_+n).removeClass(n).attr("aria-selected",!1).end().addClass(n).attr("aria-selected",!0),void this.trigger("change")):this.content.find(_+n)},clearSelection:function(){var e=this.select();e.length&&(e.removeClass(b.styles.selected),this.trigger("change"))},_setDataSource:function(e){this.dataSource=e},_editable:function(){var t=this,i=b.styles,r="span."+i.icon+":not("+i.iconHidden+")",a=function(){t.editable&&t.editable.end()&&t._closeCell()},o=function(t){var r=e(t.currentTarget);r.hasClass(i.editCell)||n()};this.options.editable===!0&&(this._startEditHandler=function(n){var i=n.currentTarget?e(n.currentTarget):n,r=t._columnFromElement(i);r.editable&&t._editCell({cell:i,column:r})},t.content.on("focusin"+g,function(){clearTimeout(t.timer),t.timer=null}).on("focusout"+g,function(){t.timer=setTimeout(a,1)}).on("keydown"+g,function(e){var i,r,o=e.keyCode;switch(o){case f.ENTER:n(),a();break;case f.ESC:i=t._editableContainer,r=t._modelFromElement(i),t.trigger("cancel",{model:r,cell:i})||t._closeCell(!0)}}),s?t.touch=t.content.kendoTouch({filter:"td",touchstart:function(e){o(e.touch)},doubletap:function(n){e(n.touch.initialTouch).is(r)||t._startEditHandler(n.touch)}}).data("kendoTouch"):t.content.on("mousedown"+g,"td",function(e){o(e)}).on("dblclick"+g,"td",function(n){e(n.target).is(r)||t._startEditHandler(n)}))},_editCell:function(t){var n,r=b.styles,a=t.cell,o=t.column,s=this._modelFromElement(a),l=this.dataSource._createNewModel(s.toJSON()),d=l.fields[o.field]||l[o.field],c=d.validation,u=i.attr("type"),f=i.attr("bind"),h={name:o.field,required:d.validation?d.validation.required===!0:!1};this._editableContent=a.children().detach(),this._editableContainer=a,a.data("modelCopy",l),"date"!==d.type&&"date"!==e.type(d)||!/H|m|s|F|g|u/.test(o.format)||(h[f]="value:"+o.field,h[u]="date",n=function(t,n){e('<input type="text"/>').attr(h).appendTo(t).kendoDateTimePicker({format:n.format})}),this.editable=a.addClass(r.editCell).kendoEditable({fields:{field:o.field,format:o.format,editor:o.editor||n},model:l,clearContainer:!1}).data("kendoEditable"),c&&c.dateCompare&&p(c.dateCompare)&&c.message&&a.find("[name="+o.field+"]").attr(i.attr("dateCompare-msg"),c.message),this.trigger("edit",{model:s,cell:a})&&this._closeCell(!0)},_closeCell:function(e){var t=b.styles,n=this._editableContainer,i=this._modelFromElement(n),r=this._columnFromElement(n),a=n.data("modelCopy"),o={};o[r.field]=a.get(r.field),n.empty().removeData("modelCopy").removeClass(t.editCell).append(this._editableContent),this.editable.destroy(),this.editable=null,this._editableContainer=null,this._editableContent=null,e||this.trigger("update",{task:i,updateInfo:o})},_draggable:function(){var t,n=this,r=null,a=!0,o=b.styles,l="tr["+i.attr("level")+" = 0]:last",d={},u=function(){r=null,t=null,a=!0,d={}},p=function(e){for(var t=e;t;){if(r.get("id")===t.get("id")){a=!1;break}t=n.dataSource.taskParent(t)}},f=function(){var n=e(t).height(),r=i.getOffset(t).top;c(t,{beforeLimit:r+.25*n,afterLimit:r+.75*n})},h=function(e){var n,r=e.location,a=o.dropAdd,s="add",l=parseInt(t.attr(i.attr("level")),10);t.beforeLimit>=r?(n=t.prev(),a=o.dropTop,s="insert-before"):r>=t.afterLimit&&(n=t.next(),a=o.dropBottom,s="insert-after"),n&&parseInt(n.attr(i.attr("level")),10)===l&&(a=o.dropMiddle),d.className=a,d.command=s},m=function(){return n._reorderDraggable.hint.children(_+o.dragStatus).removeClass(o.dropPositions)};this.options.editable===!0&&(this._reorderDraggable=this.content.kendoDraggable({distance:10,holdToDrag:s,group:"listGroup",filter:"tr[data-uid]",ignore:_+o.input,hint:function(t){return e('<div class="'+o.header+" "+o.dragClue+'"/>').css({width:300,paddingLeft:t.css("paddingLeft"),paddingRight:t.css("paddingRight"),lineHeight:t.height()+"px",paddingTop:t.css("paddingTop"),paddingBottom:t.css("paddingBottom")}).append('<span class="'+o.icon+" "+o.dragStatus+'" /><span class="'+o.dragClueText+'"/>')},cursorOffset:{top:-20,left:0},container:this.content,dragstart:function(e){n.editable&&e.preventDefault(),r=n._modelFromElement(e.currentTarget),this.hint.children(_+o.dragClueText).text(r.get("title"))},drag:function(e){a&&(h(e.y),m().addClass(d.className))},dragend:function(){u()},dragcancel:function(){u()}}).data("kendoDraggable"),this._tableDropArea=this.content.kendoDropTargetArea({distance:0,group:"listGroup",filter:"tr[data-uid]",dragenter:function(e){t=e.dropTarget,p(n._modelFromElement(t)),f(),m().toggleClass(o.dropDenied,!a)},dragleave:function(){a=!0,m()},drop:function(){var e=n._modelFromElement(t),i=e.orderId,o={parentId:e.parentId};if(a){switch(d.command){case"add":o.parentId=e.id;break;case"insert-before":o.orderId=e.parentId===r.parentId&&e.orderId>r.orderId?i-1:i;break;case"insert-after":o.orderId=e.parentId===r.parentId&&e.orderId>r.orderId?i:i+1}n.trigger("update",{task:r,updateInfo:o})}}}).data("kendoDropTargetArea"),this._contentDropArea=this.element.kendoDropTargetArea({distance:0,group:"listGroup",filter:_+o.gridContent,drop:function(){var e=n._modelFromElement(n.content.find(l)),t=e.orderId,i={parentId:null,orderId:null!==r.parentId?t+1:t};n.trigger("update",{task:r,updateInfo:i})}}).data("kendoDropTargetArea"))},_modelFromElement:function(e){var t=e.closest("tr"),n=this.dataSource.getByUid(t.attr(i.attr("uid")));return n},_columnFromElement:function(e){var t=e.closest("td"),n=t.parent(),i=n.children().index(t);return this.columns[i]}});c(!0,l.GanttList,{styles:k})}(window.kendo.jQuery),window.kendo},"function"==typeof define&&define.amd?define:function(e,t){t()});