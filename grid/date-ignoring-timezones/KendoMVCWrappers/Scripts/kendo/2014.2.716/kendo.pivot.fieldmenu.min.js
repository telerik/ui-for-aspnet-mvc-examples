/*
* Kendo UI v2014.2.716 (http://www.telerik.com/kendo-ui)
* Copyright 2014 Telerik AD. All rights reserved.
*
* Kendo UI commercial licenses may be obtained at
* http://www.telerik.com/purchase/license-agreement/kendo-ui-complete
* If you do not own a commercial license, this file shall be governed by the trial license terms.
*/
!function(e,define){define(["./kendo.pivotgrid.min","./kendo.menu.min","./kendo.window.min","./kendo.treeview.min","./kendo.dropdownlist.min"],e)}(function(){return function(e,t){function n(e,t,n){var i,r,o,a;if(!e)return[];for(e=e.filters,i=0,r=[],o=e.length;o>i;i++)a=e[i].operator,(n||"in"===a)&&a!==n||e[i].field!==t||r.push(e[i]);return r}function i(t,i,r){var o,a=0,s=r.length;if(t=n(t,i,"in")[0])for(o=t.value.split(",");s>a;a++)r[a].checked=e.inArray(r[a].uniqueName,o)>=0;else for(;s>a;a++)r[a].checked=!0}function r(e,t){var n,i=e.length;for(n=0;i>n;n++)e[n].checked&&0!==e[n].level()&&t.push(e[n].uniqueName),e[n].hasChildren&&r(e[n].children.view(),t)}var o=window.kendo,a=o.ui,s="kendoContextMenu",l=e.proxy,d=".kendoPivotFieldMenu",c=a.Widget,u=c.extend({init:function(e,t){c.fn.init.call(this,e,t),this._dataSource(),this._layout(),o.notify(this)},events:[],options:{name:"PivotFieldMenu",filter:null,messages:{info:"Show items with value that:",filterFields:"Fields Filter",filter:"Filter",include:"Include Fields...",title:"Fields to include",clear:"Clear",ok:"Ok",cancel:"Cancel",operators:{contains:"Contains",doesnotcontain:"Does not contain",startswith:"Starts with",endswith:"Ends with",eq:"Is equal to",neq:"Is not equal to"}}},_layout:function(){var t=this.options;this.wrapper=e(o.template(f)({ns:o.ns,messages:t.messages})),this.menu=this.wrapper[s]({filter:t.filter,target:this.element,orientation:"vertical",showOn:"click",closeOnClick:!1,open:l(this._menuOpen,this),select:l(this._select,this)}).data(s),this._createWindow(),this._initFilterForm()},_initFilterForm:function(){var e=this.menu.element.find(".k-filter-item");this._filterOperator=new o.ui.DropDownList(e.find("select")),this._filterValue=e.find(".k-textbox"),e.on("click"+d,".k-button-filter",l(this._filter,this)).on("click"+d,".k-button-clear",l(this._reset,this))},_setFilterForm:function(e){var t="",n="";e&&(t=e.operator,n=e.value),this._filterOperator.value(t),this._filterValue.val(n)},_clearFilters:function(e){var t,i,r=this.dataSource.filter()||{},o=0;for(r.filters=r.filters||[],t=n(r,e),i=t.length;i>o;o++)r.filters.splice(r.filters.indexOf(t[o]),1);return r},_filter:function(){var e,n,i=this,r=i._filterValue.val();return r?(e={field:i.currentMember,operator:i._filterOperator.value(),value:r},n=i._clearFilters(i.currentMember),n.filters.push(e),i.dataSource.filter(n),i.menu.close(),t):(i.menu.close(),t)},_reset:function(){var e=this,t=e._clearFilters(e.currentMember);t.filters[0]||(t={}),e.dataSource.filter(t),e._setFilterForm(null),e.menu.close()},setDataSource:function(e){this.options.dataSource=e,this._dataSource()},_dataSource:function(){this.dataSource=o.data.PivotDataSource.create(this.options.dataSource)},_createWindow:function(){var t=this.options.messages;this.includeWindow=e(o.template(h)({messages:t})).on("click"+d,".k-button-ok",l(this._applyIncludes,this)).on("click"+d,".k-button-cancel",l(this._closeWindow,this)),this.includeWindow=new a.Window(this.includeWindow,{title:t.title,visible:!1,resizable:!1,open:l(this._windowOpen,this)})},_applyIncludes:function(e){var t,i=[],o=this.treeView.dataSource.view(),a=o[0].checked,s=this.dataSource.filter(),l=n(s,this.currentMember,"in")[0];r(o,i),l&&(a?(s.filters.splice(s.filters.indexOf(l),1),s.filters.length||(s={})):l.value=i.join(","),t=s),i.length&&(t||a||(t={field:this.currentMember,operator:"in",value:i.join(",")},s&&(s.filters.push(t),t=s))),t&&this.dataSource.filter(t),this._closeWindow(e)},_closeWindow:function(e){e.preventDefault(),this.includeWindow.close()},_treeViewDataSource:function(){var e=this;return o.data.HierarchicalDataSource.create({schema:{model:{id:"uniqueName",hasChildren:function(e){return parseInt(e.childrenCardinality,10)>0}}},transport:{read:function(t){var n={},r=e.treeView.dataSource.get(t.data.uniqueName),o=t.data.uniqueName;o?(n.memberUniqueName=r.uniqueName.replace(/\&/g,"&amp;"),n.treeOp=1):n.levelUniqueName=e.currentMember+".[(ALL)]",e.dataSource.schemaMembers(n).done(function(n){i(e.dataSource.filter(),e.currentMember,n),t.success(n)}).fail(t.error)}}})},_createTreeView:function(e){var t=this;t.treeView=new a.TreeView(e,{autoBind:!1,dataSource:t._treeViewDataSource(),dataTextField:"name",checkboxes:{checkChildren:!0},dataBound:function(){a.progress(t.includeWindow.element,!1)}})},_menuOpen:function(t){var i;t.event&&(i=o.attr("name"),this.currentMember=e(t.event.target).closest("["+i+"]").attr(i),this._setFilterForm(n(this.dataSource.filter(),this.currentMember)[0]))},_select:function(t){var n=e(t.item);e(".k-pivot-filter-window").not(this.includeWindow.element).kendoWindow("close"),n.hasClass("k-include-item")&&this.includeWindow.center().open()},_windowOpen:function(){this.treeView||this._createTreeView(this.includeWindow.element.find(".k-treeview")),a.progress(this.includeWindow.element,!0),this.treeView.dataSource.read()},destroy:function(){c.fn.destroy.call(this),this.menu&&(this.menu.destroy(),this.menu=null),this.reeeView&&(this.treeView.destroy(),this.treeView=null),this.includeWindow&&(this.includeWindow.destroy(),this.includeWindow=null),this.wrapper=null,this.element=null}}),p='<div class="k-filterable k-content" tabindex="-1" data-role="fieldmenu"><form class="k-filter-menu"><div><div class="k-filter-help-text">#=messages.info#</div><select>#for(var op in messages.operators){#<option value="#=op#">#=messages.operators[op]#</option>#}#</select><input class="k-textbox" type="text" /><div><a class="k-button k-primary k-button-filter" href="\\#">#=messages.filter#</a><a class="k-button k-button-clear" href="\\#">#=messages.clear#</a></div></div></form></div>',f='<ul class="k-pivot-fieldmenu"><li class="k-item k-include-item"><span class="k-link"><span class="k-icon k-filter"></span>${messages.include}</span></li><li class="k-separator"></li><li class="k-item k-filter-item"><span class="k-link"><span class="k-icon k-filter"></span>${messages.filterFields}</span><ul><li>'+p+"</li></ul></li></ul>",h='<div class="k-popup-edit-form k-pivot-filter-window"><div class="k-edit-form-container"><div class="k-treeview"></div><div class="k-edit-buttons k-state-default"><a class="k-button k-primary k-button-ok" href="\\#">${messages.ok}</a><a class="k-button k-button-cancel" href="\\#">${messages.cancel}</a></div></div>';a.plugin(u)}(window.kendo.jQuery),window.kendo},"function"==typeof define&&define.amd?define:function(e,t){t()});